sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../model/formatter","sap/ui/model/Filter","sap/m/Label","sap/ui/commons/TextView","sap/ui/core/util/Export","sap/ui/core/util/ExportTypeCSV","sap/ui/table/TablePersoController","sap/ui/core+
/Fragment","sap/ui/model/FilterOperator","sap/ui/export/Spreadsheet","sap/m/Dialog","sap/viz/ui5/api/env/Format","sap/ui/core/format/NumberFormat","sap/viz/ui5/format/ChartFormatter","sap/m/Token"],function(e,t,a,r,s,i,o,l,n,g,u,d,p,m,h,B,c,f){"use stric+
t";return e.extend("Block_Orders.Block_Orders.controller.Worklist",{formatter:r,onInit:function(){var e;var a=new Promise(function(t,a){this.getOwnerComponent().getModel().read("/TimeSet",{success:function(a){e=a.results[0].times*1e3;t()},error:function(+
t){e="300000";a()}})}.bind(this));a.then(function(t){var a;function r(){clearTimeout(a);a=setTimeout(function(){sap.m.MessageBox.show("Click OK to Refresh",{icon:sap.m.MessageBox.Icon.Error,title:"Session Timeout",onClose:function(e){location.reload()}})+
},e)}document.onmousemove=r});this.ConstdataEH();this.ChartdataEH();this.getView().setBusy(true);var r=new sap.ui.model.odata.ODataModel("/sap/opu/odata/sap/ZQTC_VA_REP_SRV/");this.setModel(r,"SUMVA45");this.getView().setBusy(false);this.oJsonData=new t(+
[],true);this.getView().setModel(this.oJsonData,"Bsosel");this.oJsonData1=new t([],true);this.getView().setModel(this.oJsonData1,"BKsel");this.oJsonDataT=new t([],true);this.getView().setModel(this.oJsonDataT,"BTsel")},inputBso:"",fragmentBso:null,onBord+
erHelpRequest:function(e){this.inputBso=e.getSource().getId();if(this.fragmentBso===null){this.fragmentBso=new sap.ui.xmlfragment("Block_Orders.Block_Orders.view.fragmentOrder",this);this.fragmentBso.setTitle("Sales Orders ");this.getView().addDependent(+
this.fragmentBso)}this.fragmentBso.open()},cancelBSO:function(){this.fragmentBso.close()},rowSelectionBso:function(e){var t=sap.ui.getCore().byId("BSOTable");if(e.getParameter("listItems").length>1&&e.getParameter("selected")===true){for(var a=0;a<e.getP+
arameter("listItems").length;a++){var r=e.getParameter("listItems")[a].getBindingContext("Billing").getProperty("Vbeln");this.getView().getModel("Bsosel").getData().push({Vbeln:r});this.getView().getModel("Bsosel").updateBindings(true)}}else{var s=e.getP+
arameter("listItem").getBindingContext("Billing").getProperty("Vbeln");if(e.getParameter("listItem").getProperty("selected")===true){this.getView().getModel("Bsosel").getData().push({Vbeln:s});this.getView().getModel("Bsosel").updateBindings(true)}else{t+
his.getView().getModel("Bsosel").getData().pop({Vbeln:s});this.getView().getModel("Bsosel").updateBindings(true)}}if(e.getParameter("listItems").length>1&&e.getParameter("selected")===false){this.getView().getModel("Bsosel").setData([])}},acceptBSO:funct+
ion(e){this.getView().byId("Bso").removeAllTokens();var t=[];var a=sap.ui.getCore().byId("BSOselTable");var r=a.getItems();if(r.length>0){for(var s=0;s<r.length;s++){var i=r[s].getBindingContext("Bsosel").getProperty("Vbeln");var o=new sap.m.Token({text:+
i});this.getView().byId("Bso").addToken(o);sap.ui.getCore().Bso=i;t.push(i)}sap.ui.getCore().multiBso=t;sap.ui.getCore().byId("BSOTable").removeSelections(true)}else{sap.ui.getCore().Bso=null;sap.ui.getCore().multiBso=[]}this.fragmentBso.close()},clearBS+
O:function(){var e=sap.ui.getCore().byId("BSOTable");var t=e.getSelectedItems();if(t.length>0){e.removeSelections(true);var a=this.getView().byId("Bso").getTokens();this.getView().byId("Bso").destroyTokens([a]);sap.ui.getCore().multiBso=[]}this.getView()+
.getModel("Bsosel").setData([]);var r=sap.ui.getCore().byId("mySearch");r.setValue(null);this.getView().byId("Bso").removeAllTokens()},deleteSelectionBso:function(e){var t=e.getParameter("listItem");var a=sap.ui.getCore().byId("BSOselTable");a.removeItem+
(t)},searchEHO:function(e){var t=e.getParameter("query");var a=new sap.ui.model.Filter("Vbeln",sap.ui.model.FilterOperator.EQ,t);var r=sap.ui.getCore().byId("BSOTable");var s=r.getBinding("items");s.filter(a);r.removeSelections(true)},BsoChange:function(+
e){var t=e.getParameter("type");if(t==="removed"){var a=e.getParameter("token").getText();this.getView().getModel("Bsosel").getData().pop({Kunnr:a});this.getView().getModel("Bsosel").updateBindings(true);var r=[];var s=this.getView().byId("Kunnr").getTok+
ens();if(s.length>0){for(var i=0;i<s.length;i++){var o=s[i].getProperty("text");r.push(o)}sap.ui.getCore().multiMedia=r}else{sap.ui.getCore().multiMedia=[];sap.ui.getCore().media=null}this.BillRefreshEH(e)()}},inputBK:"",fragmentBK:null,onHelpRequestBK:f+
unction(e){this.inputBK=e.getSource().getId();if(this.fragmentBK===null){this.fragmentBK=new sap.ui.xmlfragment("Block_Orders.Block_Orders.view.fragmentCust",this);this.fragmentBK.setTitle("Sold to Party");this.getView().addDependent(this.fragmentBK)}thi+
s.fragmentBK.open()},cancelBK:function(){this.fragmentBK.close()},searchCEHK:function(e){var t=e.getParameter("query");var a=new sap.ui.model.Filter("Name1",sap.ui.model.FilterOperator.EQ,t);var r=sap.ui.getCore().byId("BKTable");var s=r.getBinding("item+
s");s.filter(a);r.removeSelections(true)},searchEHT:function(e){debugger;var t=e.getParameter("query").toUpperCase();t.toUpperCase();var a=new sap.ui.model.Filter("Auart",sap.ui.model.FilterOperator.EQ,t);var r=sap.ui.getCore().byId("BTTable");var s=r.ge+
tBinding("items");s.filter(a);r.removeSelections(true)},searchEHSold:function(e){var t=e.getParameter("query");var a=new sap.ui.model.Filter("Name1",sap.ui.model.FilterOperator.EQ,t);var r=sap.ui.getCore().byId("BKTable");var s=r.getBinding("items");s.fi+
lter(a)},rowSelectionBK:function(e){if(e.getParameter("listItems").length>1&&e.getParameter("selected")===true){for(var t=0;t<e.getParameter("listItems").length;t++){var a=e.getParameter("listItems")[t].getBindingContext().getProperty("Kunnr");this.getVi+
ew().getModel("BKsel").getData().push({Kunnr:a});this.getView().getModel("BKsel").updateBindings(true)}}else{var r=e.getParameter("listItem").getBindingContext().getProperty("Kunnr");if(e.getParameter("listItem").getProperty("selected")===true){this.getV+
iew().getModel("BKsel").getData().push({Kunnr:r});this.getView().getModel("BKsel").updateBindings(true)}else{this.getView().getModel("BKsel").getData().pop({Kunnr:r});this.getView().getModel("BKsel").updateBindings(true)}}if(e.getParameter("listItems").l+
ength>1&&e.getParameter("selected")===false){this.getView().getModel("BKsel").setData([])}},acceptBK:function(e){this.getView().byId("BK").removeAllTokens();var t=[];var a=sap.ui.getCore().byId("BKselTable");var r=a.getItems();if(r.length>0){for(var s=0;+
s<r.length;s++){var i=r[s].getBindingContext("BKsel").getProperty("Kunnr");var o=new sap.m.Token({text:i});this.getView().byId("BK").addToken(o);sap.ui.getCore().BK=i;t.push(i)}sap.ui.getCore().multiBK=t;sap.ui.getCore().byId("BKTable").removeSelections(+
true)}else{sap.ui.getCore().BK=null;sap.ui.getCore().multiBK=[]}this.fragmentBK.close()},clearBK:function(){var e=sap.ui.getCore().byId("BKTable");var t=e.getSelectedItems();if(t.length>0){e.removeSelections(true);var a=this.getView().byId("BK").getToken+
s();this.getView().byId("BK").destroyTokens([a]);sap.ui.getCore().multiBK=[]}this.getView().getModel("BKsel").setData([]);var r=sap.ui.getCore().byId("mySearch");r.setValue(null);this.getView().byId("BK").removeAllTokens()},deleteSelectionBK:function(e){+
var t=e.getParameter("listItem");var a=sap.ui.getCore().byId("BKselTable");a.removeItem(t)},BKChange:function(e){var t=e.getParameter("type");if(t==="removed"){var a=e.getParameter("token").getText();this.getView().getModel("BKsel").getData().pop({Kunnr:+
a});this.getView().getModel("BKsel").updateBindings(true);var r=[];var s=this.getView().byId("Kunnr").getTokens();if(s.length>0){for(var i=0;i<s.length;i++){var o=s[i].getProperty("text");r.push(o)}sap.ui.getCore().multiMedia=r}else{sap.ui.getCore().mult+
iMedia=[];sap.ui.getCore().media=null}this.BillRefreshEH(e)()}},inputBT:"",fragmentBT:null,onHelpRequestBT:function(e){this.inputBT=e.getSource().getId();if(this.fragmentBT===null){this.fragmentBT=new sap.ui.xmlfragment("Block_Orders.Block_Orders.view.fr+
agmentOrdType",this);this.fragmentBT.setTitle("Order Type");this.getView().addDependent(this.fragmentBT)}this.fragmentBT.open()},cancelBT:function(){this.fragmentBT.close()},rowSelectionBT:function(e){if(e.getParameter("listItems").length>1&&e.getParamet+
er("selected")===true){for(var t=0;t<e.getParameter("listItems").length;t++){var a=e.getParameter("listItems")[t].getBindingContext().getProperty("Auart");this.getView().getModel("BTsel").getData().push({Auart:a});this.getView().getModel("BTsel").updateB+
indings(true)}}else{var r=e.getParameter("listItem").getBindingContext().getProperty("Auart");if(e.getParameter("listItem").getProperty("selected")===true){this.getView().getModel("BTsel").getData().push({Auart:r});this.getView().getModel("BTsel").update+
Bindings(true)}else{this.getView().getModel("BTsel").getData().pop({Auart:r});this.getView().getModel("BTsel").updateBindings(true)}}if(e.getParameter("listItems").length>1&&e.getParameter("selected")===false){this.getView().getModel("BTsel").setData([])+
}},acceptBT:function(e){this.getView().byId("BT3").removeAllTokens();var t=[];var a=sap.ui.getCore().byId("BTselTable");var r=a.getItems();if(r.length>0){for(var s=0;s<r.length;s++){var i=r[s].getBindingContext("BTsel").getProperty("Auart");var o=new sap+
.m.Token({text:i});this.getView().byId("BT3").addToken(o);sap.ui.getCore().BT3=i;t.push(i)}sap.ui.getCore().multiBT=t;sap.ui.getCore().byId("BTTable").removeSelections(true)}else{sap.ui.getCore().BT3=null;sap.ui.getCore().multiBT=[]}this.fragmentBT.close+
()},clearBT:function(){var e=sap.ui.getCore().byId("BTTable");var t=e.getSelectedItems();if(t.length>0){e.removeSelections(true);var a=this.getView().byId("BT").getTokens();this.getView().byId("BT").destroyTokens([a]);sap.ui.getCore().multiBT=[]}this.get+
View().getModel("BTsel").setData([]);var r=sap.ui.getCore().byId("mytypSearch");r.setValue(null);this.getView().byId("BT").removeAllTokens()},deleteSelectionBT:function(e){var t=e.getParameter("listItem");var a=sap.ui.getCore().byId("BTselTable");a.remov+
eItem(t)},BTChange:function(e){var t=e.getParameter("type");if(t==="removed"){var a=e.getParameter("token").getText();this.getView().getModel("BTsel").getData().pop({Auart:a});this.getView().getModel("BTsel").updateBindings(true);var r=[];var s=this.getV+
iew().byId("Auart").getTokens();if(s.length>0){for(var i=0;i<s.length;i++){var o=s[i].getProperty("text");r.push(o)}sap.ui.getCore().multiMedia=r}else{sap.ui.getCore().multiMedia=[];sap.ui.getCore().media=null}this.BillRefreshEH(e)()}},onUpdateFinished:f+
unction(e){var t,a=e.getSource(),r=e.getParameter("total");if(r&&a.getBinding("items").isLengthFinal()){t=this.getResourceBundle().getText("worklistTableTitleCount",[r])}else{t=this.getResourceBundle().getText("worklistTableTitle")}this.getModel("worklis+
tView").setProperty("/worklistTableTitle",t)},onPress:function(e){this._showObject(e.getSource())},onNavBack:function(){history.go(-1)},onSearch:function(e){if(e.getParameters().refreshButtonPressed){this.onRefresh()}else{var t=[];var a=e.getParameter("q+
uery");if(a&&a.length>0){t=[new n("Arktx",g.Contains,a)]}this._applySearch(t)}},onRefresh:function(){var e=this.byId("table");e.getBinding("items").refresh()},setBillDefaultDates:function(){var e=sap.ui.getCore().NoDays;var t=new Date;var a=this.getView(+
).byId("Bedate");a.setDateValue(t);var r=t;r=r.setDate(r.getDate()-120);this.getView().byId("Bsdate").setDateValue(new Date(r));var s=new Date;var i=this.getView().byId("Bedate");i.setDateValue(s);var o=sap.ui.core.format.DateFormat.getInstance({pattern:+
"yyyy-MM-dd"});sap.ui.getCore().Bsdate=o.format(t);sap.ui.getCore().Bedate=o.format(s)},ConstdataEH:function(e){sap.ui.getCore().NoDays="";var t=new sap.ui.model.Filter({filters:[],and:true});var a=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap+
/ZQTC_BLOCKORDERS_E266_SRV/",{json:true,loadMetadataAsync:true});var r=this;a.read("/ZCACONSTSet",{filters:[t],success:function(e,t){var a=new sap.ui.model.json.JSONModel;a.setSizeLimit(e.results.length);a.setData(e);sap.ui.getCore().setModel(a);this.get+
View().setModel(a,"Const");sap.ui.getCore().NoDays=e.results[0].Low;this.setBillDefaultDates();this.BillRefreshEH()}.bind(this),error:function(e){sap.m.MessageToast.show("Error in Constant data refresh")}})},BillRefreshEH:function(e){var t={};var a=0;var+
 r=0;t.Vbeln=a;var s=this.getView().byId("Bsdate").getValue();var i=this.getView().byId("Bedate").getValue();sap.ui.getCore().bsdate=s;sap.ui.getCore().bedate=i;if(i<s){sap.m.MessageBox.warning("'Date-To'  earlier  than  'Date-From ', Please9 check! ");r+
eturn}t.Posnr=r;var o=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Posnr",sap.ui.model.FilterOperator.EQ,t.Posnr),new sap.ui.model.Filter("Faksk",sap.ui.model.FilterOperator.EQ,"RF"),new sap.ui.model.Filter("Stdate",sap.ui.model.FilterOpera+
tor.EQ,s),new sap.ui.model.Filter("Endate",sap.ui.model.FilterOperator.EQ,i)],and:true});var l=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZQTC_BLOCKORDERS_E266_SRV/",{json:true,loadMetadataAsync:true});var n=[];var g=this.getView().byId("BK+
").getTokens();for(var u=0;u<g.length;u++){var d=g[u].getText();n.push(new sap.ui.model.Filter("Kunnr",sap.ui.model.FilterOperator.EQ,d))}var p=this.getView().byId("Bso").getTokens();for(var m=0;m<p.length;m++){var h=p[m].getText();n.push(new sap.ui.mode+
l.Filter("Vbeln",sap.ui.model.FilterOperator.EQ,h))}var B=this.getView().byId("BT3").getTokens();for(var c=0;c<B.length;c++){var f=B[c].getText();n.push(new sap.ui.model.Filter("Auart",sap.ui.model.FilterOperator.EQ,f))}sap.ui.getCore().multiItype=n;o=o.+
aFilters.concat(n);l.read("/BillingBlockSet",{filters:[o],success:function(e,t){var a=new sap.ui.model.json.JSONModel;a.setSizeLimit(e.results.length);a.setData(e);sap.ui.getCore().setModel(a);this.getView().setModel(a,"Billing")}.bind(this),error:functi+
on(e){sap.m.MessageToast.show("Error in Billing data refresh")}})},ChartdataEH:function(e){var t={};var a=0;var r=0;t.Vbeln=a;var s=this.getView().byId("Bsdate").getValue();var i=this.getView().byId("Bedate").getValue();sap.ui.getCore().bsdate=s;sap.ui.g+
etCore().bedate=i;if(i<s){sap.m.MessageBox.warning("'Date-To'  earlier  than  'Date-From ', Please check! ");return}t.Posnr=r;var o=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Vbeln",sap.ui.model.FilterOperator.EQ,t.Vbeln)],and:true});var +
l=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZQTC_BLOCKED_SO_INFO_SRV/",{json:true,loadMetadataAsync:true})},downloadExcel:function(){var e=this.getView().byId("bill");var t=e.getColumns();var a=[];t.forEach(function(e){a.push({label:e.getN+
ame(),property:e.getSortProperty()})});var r={workbook:{columns:a,context:{application:"Blocked Orders",version:"1.87.0",title:"Billing Blocked Order",metaSheetName:"Custom metadata"}},dataSource:this.getView().getModel("Billing").getData().results,fileN+
ame:"BlockedOrders.xlsx"};var s=new sap.ui.export.Spreadsheet(r);s.build()},onMainSearch:function(e){var t=e.getParameter("query");t.toUpperCase();var a=new sap.ui.model.Filter("Auart",sap.ui.model.FilterOperator.Contains,t);var r=new sap.ui.model.Filter+
("Vbeln",sap.ui.model.FilterOperator.Contains,t);var s=new sap.ui.model.Filter("Kunnr",sap.ui.model.FilterOperator.Contains,t);var i=new sap.ui.model.Filter("Name1",sap.ui.model.FilterOperator.Contains,t);var o=new sap.ui.model.Filter("Faksk",sap.ui.mode+
l.FilterOperator.Contains,t);var l=new sap.ui.model.Filter("Faksd",sap.ui.model.FilterOperator.Contains,t);var n=new sap.ui.model.Filter("Ernam",sap.ui.model.FilterOperator.Contains,t);var g=new sap.ui.model.Filter("Vkorg",sap.ui.model.FilterOperator.Con+
tains,t);var u=this.getView().byId("bill");var d=u.getBinding("rows");var p=new sap.ui.model.Filter({filters:[a,r,s,i,o,l,n,g],and:false});var m=[p];d.filter(m)},VA45RefreshEH:function(e){var t={};var a=0;var r=0;t.Vbeln=a;var s=this.getView().byId("Bsda+
te").getValue();var i=this.getView().byId("Bedate").getValue();sap.ui.getCore().bsdate=s;sap.ui.getCore().bedate=i;if(i<s){sap.m.MessageBox.warning("'Date-To'  earlier  than  'Date-From ', Please check! ");return}t.Posnr=r;var o=new sap.ui.model.Filter({+
filters:[new sap.ui.model.Filter("FLAG",sap.ui.model.FilterOperator.EQ,sap.ui.getCore().oKey)],and:true});var l=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZQTC_VA_REP_SRV/",{json:true,loadMetadataAsync:true});debugger;l.read("/VA45_SumSet",+
{filters:[o],success:function(e,t){var a=new sap.ui.model.json.JSONModel;a.setSizeLimit(e.results.length);a.setData(e);sap.ui.getCore().setModel(a);this.getView().setModel(a,"SUMVA45")}.bind(this),error:function(e){sap.m.MessageToast.show("Error in VA45 +
data refresh")}})},TabSelectEH:function(e){var t=e.getParameter("selectedKey");var a=this.byId("va45");var r;switch(t){case"Key1":break;case"Key2":sap.ui.getCore().oKey=t;this.VA45RefreshEH();break;default:a.getBinding("items").filter()}a.getBinding("ite+
ms").filter(r)},fragmentRI:null,RitemsEH:function(e){debugger;sap.ui.getCore().Vbeln=this.getView().getModel("SUMVA45").getProperty("VBELN",e.getSource().getBindingContext("SUMVA45"));if(this.fragmentRI===null){this.fragmentRI=new sap.ui.xmlfragment("Blo+
ck_Orders.Block_Orders.view.FragmentRejList",this);this.getView().addDependent(this.fragmentRI)}this.fragmentRI.setTitle("Rejected Items of"+" "+sap.ui.getCore().Vbeln);this.fragmentRI.open()},cancelREJItem:function(){this.fragmentRI.close()},fragmentLI4+
5:null,va45itemsEH:function(e){debugger;sap.ui.getCore().Vbeln=this.getView().getModel("SUMVA45").getProperty("VBELN",e.getSource().getBindingContext("SUMVA45"));this.getVA45ItemDetails();if(this.fragmentLI45===null){this.fragmentLI45=new sap.ui.xmlfragm+
ent("Block_Orders.Block_Orders.view.FragmentVA45Items",this);this.getView().addDependent(this.fragmentLI45)}this.fragmentLI45.setTitle("Line Items of"+" "+sap.ui.getCore().Vbeln);this.fragmentLI45.open()},getVA45ItemDetails:function(){var e=new sap.ui.mo+
del.Filter("VBELN",sap.ui.model.FilterOperator.EQ,this.vbeln);var t=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("VBELN",sap.ui.model.FilterOperator.EQ,sap.ui.getCore().Vbeln)],and:true});var a="/sap/opu/odata/sap/ZQTC_VA_REP_SRV/";var r=new+
 sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZQTC_VA_REP_SRV/",{json:true,loadMetadataAsync:true});r.refresh(true);this.getView().setBusy(true);r.read("/VA45_AllItemsSet",{filters:[t],success:function(e,t){var a=new sap.ui.model.json.JSONModel;a+
.refresh(true);a.setData(e);sap.ui.getCore().setModel(a);this.getView().setModel(a,"va45Items");this.getView().setBusy(false);e.bindRows("/va45Items")}.bind(this),error:function(e){sap.m.MessageToast.show("Data Read error ")}})},cancelVA45Item:function()+
{this.fragmentLI45.close()},_showObject:function(e){this.getRouter().navTo("object",{objectId:e.getBindingContext().getProperty("Vbeln")})},_applySearch:function(e){var t=this.byId("table"),a=this.getModel("worklistView");t.getBinding("items").filter(e,"+
Application");if(e.length!==0){a.setProperty("/tableNoDataText",this.getResourceBundle().getText("worklistNoDataWithSearchText"))}}})});                                                                                                                       
sap.ui.define([                                                                                                                                                                                                                                                
	"./BaseController",                                                                                                                                                                                                                                           
	"sap/ui/model/json/JSONModel",                                                                                                                                                                                                                                
	"../model/formatter",                                                                                                                                                                                                                                         
	"sap/ui/model/Filter",                                                                                                                                                                                                                                        
	"sap/ui/model/FilterOperator",                                                                                                                                                                                                                                
	"sap/viz/ui5/format/ChartFormatter",                                                                                                                                                                                                                          
	"sap/viz/ui5/api/env/Format",                                                                                                                                                                                                                                 
	"sap/ui/core/format/NumberFormat"                                                                                                                                                                                                                             
], function (BaseController, JSONModel, formatter, Filter, FilterOperator, ChartFormatter, Format, NumberFormat) {                                                                                                                                             
	"use strict";                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
	return BaseController.extend("com.bso.Blocked_Sales_Orders.controller.Worklist", {                                                                                                                                                                            
                                                                                                                                                                                                                                                               
		formatter: formatter,                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
		/* =========================================================== */                                                                                                                                                                                            
		/* lifecycle methods                                           */                                                                                                                                                                                            
		/* =========================================================== */                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Called when the worklist controller is instantiated.                                                                                                                                                                                                      
		 * @public                                                                                                                                                                                                                                                   
		 */                                                                                                                                                                                                                                                          
		onInit: function () {                                                                                                                                                                                                                                        
			var oViewModel,                                                                                                                                                                                                                                             
				iOriginalBusyDelay,                                                                                                                                                                                                                                        
				oTable = this.byId("tblBlockedSoSet");                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
			// var oMessageManager;                                                                                                                                                                                                                                     
			// // set message model                                                                                                                                                                                                                                     
			// oMessageManager = sap.ui.getCore().getMessageManager();                                                                                                                                                                                                  
			// this.getView().setModel(oMessageManager.getMessageModel(), "message");                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
			// // activate automatic message generation for complete view                                                                                                                                                                                               
			// oMessageManager.registerObject(this.getView(), true);                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
			// Viz Chart Logic                                                                                                                                                                                                                                          
			Format.numericFormatter(ChartFormatter.getInstance());                                                                                                                                                                                                      
			var formatPattern = ChartFormatter.DefaultPattern;                                                                                                                                                                                                          
			var oVizFrame = this.getView().byId("idVizFrame");                                                                                                                                                                                                          
			oVizFrame.setVizProperties({                                                                                                                                                                                                                                
				plotArea: {                                                                                                                                                                                                                                                
					dataLabel: {                                                                                                                                                                                                                                              
						formatString: formatPattern.SHORTFLOAT,                                                                                                                                                                                                                  
						visible: true,                                                                                                                                                                                                                                           
						showTotal: true                                                                                                                                                                                                                                          
					},                                                                                                                                                                                                                                                        
					dataPointStyle: {                                                                                                                                                                                                                                         
						rules: [{                                                                                                                                                                                                                                                
							dataContext: {                                                                                                                                                                                                                                          
								Amount: {                                                                                                                                                                                                                                              
									min: 0,                                                                                                                                                                                                                                               
									max: 30999                                                                                                                                                                                                                                            
								}                                                                                                                                                                                                                                                      
							},                                                                                                                                                                                                                                                      
							properties: {                                                                                                                                                                                                                                           
								color: "sapUiChartPaletteQualitativeHue3"                                                                                                                                                                                                              
							},                                                                                                                                                                                                                                                      
							displayName: "0-30K"                                                                                                                                                                                                                                    
						}, {                                                                                                                                                                                                                                                     
							dataContext: {                                                                                                                                                                                                                                          
								Amount: {                                                                                                                                                                                                                                              
									min: 31000,                                                                                                                                                                                                                                           
									max: 60999                                                                                                                                                                                                                                            
								}                                                                                                                                                                                                                                                      
							},                                                                                                                                                                                                                                                      
							properties: {                                                                                                                                                                                                                                           
								color: "sapUiChartPaletteQualitativeHue4"                                                                                                                                                                                                              
							},                                                                                                                                                                                                                                                      
							displayName: "31K-60K"                                                                                                                                                                                                                                  
						}, {                                                                                                                                                                                                                                                     
							dataContext: {                                                                                                                                                                                                                                          
								Amount: {                                                                                                                                                                                                                                              
									min: 61000,                                                                                                                                                                                                                                           
									max: 89999                                                                                                                                                                                                                                            
								}                                                                                                                                                                                                                                                      
							},                                                                                                                                                                                                                                                      
							properties: {                                                                                                                                                                                                                                           
								color: "sapUiChartPaletteQualitativeHue5"                                                                                                                                                                                                              
							},                                                                                                                                                                                                                                                      
							displayName: "61K-90K"                                                                                                                                                                                                                                  
						}, {                                                                                                                                                                                                                                                     
							dataContext: {                                                                                                                                                                                                                                          
								Amount: {                                                                                                                                                                                                                                              
									min: 90000                                                                                                                                                                                                                                            
								}                                                                                                                                                                                                                                                      
							},                                                                                                                                                                                                                                                      
							properties: {                                                                                                                                                                                                                                           
								color: "sapUiChartPaletteQualitativeHue6"                                                                                                                                                                                                              
							},                                                                                                                                                                                                                                                      
							displayName: ">90K"                                                                                                                                                                                                                                     
						}]                                                                                                                                                                                                                                                       
					}                                                                                                                                                                                                                                                         
				},                                                                                                                                                                                                                                                         
				valueAxis: {                                                                                                                                                                                                                                               
					label: {                                                                                                                                                                                                                                                  
						formatString: formatPattern.SHORTFLOAT                                                                                                                                                                                                                   
					},                                                                                                                                                                                                                                                        
					title: {                                                                                                                                                                                                                                                  
						visible: false                                                                                                                                                                                                                                           
					}                                                                                                                                                                                                                                                         
				},                                                                                                                                                                                                                                                         
				categoryAxis: {                                                                                                                                                                                                                                            
					title: {                                                                                                                                                                                                                                                  
						visible: false                                                                                                                                                                                                                                           
					},                                                                                                                                                                                                                                                        
					label: {                                                                                                                                                                                                                                                  
						parentStyle: {                                                                                                                                                                                                                                           
							fontSize: "1rem",                                                                                                                                                                                                                                       
							fontStyle: "italic",                                                                                                                                                                                                                                    
							color : "tomato"                                                                                                                                                                                                                                        
						}                                                                                                                                                                                                                                                        
					}                                                                                                                                                                                                                                                         
					// labelRenderer: function (a) {                                                                                                                                                                                                                          
					// 	if (a.cell.text === "0-30" || a.cell.text === "30-60" || a.cell.text === "60-90" || a.cell.text === ">90") {                                                                                                                                          
					// 		var t = a.cell.isVisible = false;                                                                                                                                                                                                                    
					// 		return t;                                                                                                                                                                                                                                            
					// 	}                                                                                                                                                                                                                                                     
					// }                                                                                                                                                                                                                                                      
				},                                                                                                                                                                                                                                                         
				legend: {                                                                                                                                                                                                                                                  
					title: {                                                                                                                                                                                                                                                  
						text: "Amount",                                                                                                                                                                                                                                          
						visible: true,                                                                                                                                                                                                                                           
						style :{                                                                                                                                                                                                                                                 
							color : "tomato"                                                                                                                                                                                                                                        
						}                                                                                                                                                                                                                                                        
					}                                                                                                                                                                                                                                                         
				},                                                                                                                                                                                                                                                         
				title: {                                                                                                                                                                                                                                                   
					visible: false,                                                                                                                                                                                                                                           
					text: "Bar"                                                                                                                                                                                                                                               
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
			var oPopOver = this.getView().byId("idPopOver");                                                                                                                                                                                                            
			oPopOver.setActionItems([{                                                                                                                                                                                                                                  
				type: "action",                                                                                                                                                                                                                                            
				text: "Show Table",                                                                                                                                                                                                                                        
				press: function () {                                                                                                                                                                                                                                       
					this.getView().byId("tblBlockedSoSet").bindAggregation("rows", {                                                                                                                                                                                          
						path: this.oTblKey + "/ToBlockedSO",                                                                                                                                                                                                                     
						events: {                                                                                                                                                                                                                                                
							dataReceived: function (b) {                                                                                                                                                                                                                            
								this.getView().byId("idtblTitle").setText("Blocked Documents " + "(" + b.getParameter("data").results.length + ")");                                                                                                                                   
							}.bind(this)                                                                                                                                                                                                                                            
						}                                                                                                                                                                                                                                                        
					});                                                                                                                                                                                                                                                       
					this.getView().byId("chartContainer").switchChart(this.getView().byId("chartContainer").getContent()[1]);                                                                                                                                                 
					this.getView().byId("page").setShowFooter(true);                                                                                                                                                                                                          
					// this.getView().byId("pageHeader").setVisible(true);                                                                                                                                                                                                    
					this._dimSel(false);                                                                                                                                                                                                                                      
				}.bind(this)                                                                                                                                                                                                                                               
			}]);                                                                                                                                                                                                                                                        
			oPopOver.connect(oVizFrame.getVizUid());                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
			// oPopOver.setCustomDataControl(function (data) {                                                                                                                                                                                                          
			// 	debugger;                                                                                                                                                                                                                                               
			// 	return new sap.m.Text({                                                                                                                                                                                                                                 
			// 		text: "Testing"                                                                                                                                                                                                                                        
			// 	});                                                                                                                                                                                                                                                     
			// }.bind(this));                                                                                                                                                                                                                                           
			// oTable = this.byId("table");                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
			// Put down worklist table's original value for busy indicator delay,                                                                                                                                                                                       
			// so it can be restored later on. Busy handling on the table is                                                                                                                                                                                            
			// taken care of by the table itself.                                                                                                                                                                                                                       
			iOriginalBusyDelay = oTable.getBusyIndicatorDelay();                                                                                                                                                                                                        
			// keeps the search state                                                                                                                                                                                                                                   
			this._aTableSearchState = [];                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
			// Model used to manipulate control states                                                                                                                                                                                                                  
			oViewModel = new JSONModel({                                                                                                                                                                                                                                
				worklistTableTitle: this.getResourceBundle().getText("worklistTableTitle"),                                                                                                                                                                                
				shareOnJamTitle: this.getResourceBundle().getText("worklistTitle"),                                                                                                                                                                                        
				shareSendEmailSubject: this.getResourceBundle().getText("shareSendEmailWorklistSubject"),                                                                                                                                                                  
				shareSendEmailMessage: this.getResourceBundle().getText("shareSendEmailWorklistMessage", [location.href]),                                                                                                                                                 
				tableNoDataText: this.getResourceBundle().getText("tableNoDataText"),                                                                                                                                                                                      
				tableBusyDelay: 0                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
			this.setModel(oViewModel, "worklistView");                                                                                                                                                                                                                  
			// var that = this;                                                                                                                                                                                                                                         
			// oTable.addEventDelegate({                                                                                                                                                                                                                                
			// 	onAfterRendering: this.onAfterRenderingTbl                                                                                                                                                                                                              
			// }, that);                                                                                                                                                                                                                                                
			// Make sure, busy indication is showing immediately so there is no                                                                                                                                                                                         
			// break after the busy indication for loading the view's meta data is                                                                                                                                                                                      
			// ended (see promise 'oWhenMetadataIsLoaded' in AppController)                                                                                                                                                                                             
			// oTable.attachEventOnce("updateFinished", function(){                                                                                                                                                                                                     
			// 	// Restore original busy indicator delay for worklist's table                                                                                                                                                                                           
			// 	oViewModel.setProperty("/tableBusyDelay", iOriginalBusyDelay);                                                                                                                                                                                          
			// });                                                                                                                                                                                                                                                      
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onAfterRendering: function () {                                                                                                                                                                                                                              
			this._serviceCall();                                                                                                                                                                                                                                        
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/* =========================================================== */                                                                                                                                                                                            
		/* event handlers                                              */                                                                                                                                                                                            
		/* =========================================================== */                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
		//Message Popover Press                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
		onMessagePopoverPress: function (oEvent) {                                                                                                                                                                                                                   
			this._getMessagePopover().openBy(oEvent.getSource());                                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_getMessagePopover: function () {                                                                                                                                                                                                                            
			// create popover lazily (singleton)                                                                                                                                                                                                                        
			if (!this._oMessagePopover) {                                                                                                                                                                                                                               
				// create popover lazily (singleton)                                                                                                                                                                                                                       
				this._oMessagePopover = sap.ui.xmlfragment(this.getView().getId(),                                                                                                                                                                                         
					"com.bso.Blocked_Sales_Orders.Fragment.messagePopover", this);                                                                                                                                                                                            
				this.getView().addDependent(this._oMessagePopover);                                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
			return this._oMessagePopover;                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		// onAfterRenderingTbl: function (a) {                                                                                                                                                                                                                       
		// 	debugger;                                                                                                                                                                                                                                                
		// 	var oTable = this.byId("tblBlockedSoSet"); //Get hold of table                                                                                                                                                                                           
		// 	var oRowsBinding = oTable.getBinding("rows");                                                                                                                                                                                                            
		// 	oRowsBinding.attachChange(function () {                                                                                                                                                                                                                  
		// 		debugger;                                                                                                                                                                                                                                               
		// 		var oLength = oRowsBinding.getLength();                                                                                                                                                                                                                 
		// 		this.byId("chartContainer").setTitle("Blocked Documents" + "(" + oLength + ")");                                                                                                                                                                        
		// 	}.bind(this));                                                                                                                                                                                                                                           
		// },                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
		//on chart select data                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
		onChartContentChange: function (oEvent) {                                                                                                                                                                                                                    
			var gShowFot = this.getView().byId("page").getShowFooter();                                                                                                                                                                                                 
			if (gShowFot) {                                                                                                                                                                                                                                             
				this.getView().byId("page").setShowFooter(false);                                                                                                                                                                                                          
				// this.getView().byId("pageHeader").setVisible(false);                                                                                                                                                                                                    
				this._dimSel(true);                                                                                                                                                                                                                                        
				this._serviceCall();                                                                                                                                                                                                                                       
			} else {                                                                                                                                                                                                                                                    
				this.getView().byId("page").setShowFooter(true);                                                                                                                                                                                                           
				// this.getView().byId("pageHeader").setVisible(true);                                                                                                                                                                                                     
				this._dimSel(false);                                                                                                                                                                                                                                       
			}                                                                                                                                                                                                                                                           
			var dmSel1 = this.getView().byId("dimensionSelector1").getSelectedKey();                                                                                                                                                                                    
			var dmSel2 = this.getView().byId("dimensionSelector2").getSelectedKey();                                                                                                                                                                                    
			var dmSel3 = this.getView().byId("dimensionSelector3").getSelectedKey();                                                                                                                                                                                    
			if (dmSel1 !== "" && dmSel2 !== "" && dmSel3 !== "") {                                                                                                                                                                                                      
				var nArray = [new Filter("Vkorg", FilterOperator.EQ, dmSel1), new Filter("Waerk", FilterOperator.EQ, dmSel2),                                                                                                                                              
					new Filter("Agegrp", FilterOperator.EQ, dmSel3)                                                                                                                                                                                                           
				];                                                                                                                                                                                                                                                         
				this.getView().byId("tblBlockedSoSet").bindAggregation("rows", {                                                                                                                                                                                           
					path: "/BlockedSOSet",                                                                                                                                                                                                                                    
					filters: nArray,                                                                                                                                                                                                                                          
					events: {                                                                                                                                                                                                                                                 
						dataReceived: function (b) {                                                                                                                                                                                                                             
							this.getView().byId("idtblTitle").setText("Blocked Documents " + "(" + b.getParameter("data").results.length + ")");                                                                                                                                    
						}.bind(this)                                                                                                                                                                                                                                             
					}                                                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
			} else {                                                                                                                                                                                                                                                    
				this.getView().setBusy(true);                                                                                                                                                                                                                              
				this.getView().byId("tblBlockedSoSet").bindAggregation("rows", {                                                                                                                                                                                           
					path: "/BlockedSOSet",                                                                                                                                                                                                                                    
					events: {                                                                                                                                                                                                                                                 
						dataReceived: function (b) {                                                                                                                                                                                                                             
							this.getView().byId("idtblTitle").setText("Blocked Documents " + "(" + b.getParameter("data").results.length + ")");                                                                                                                                    
							this.getView().setBusy(false);                                                                                                                                                                                                                          
						}.bind(this)                                                                                                                                                                                                                                             
					}                                                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
		onSelectData: function (oEvent) {                                                                                                                                                                                                                            
			var vizCtx = this.getView().byId("idVizDataSet").getBinding("data").getContexts();                                                                                                                                                                          
			var rowCtx = oEvent.getParameter("data")[0].data._context_row_number;                                                                                                                                                                                       
			var dataObj = vizCtx[rowCtx].getObject();                                                                                                                                                                                                                   
			this.oTblKey = this.getView().getModel().createKey("/CreditBlockedSOSet", {                                                                                                                                                                                 
				Auart: dataObj.Auart,                                                                                                                                                                                                                                      
				Vkorg: dataObj.Vkorg,                                                                                                                                                                                                                                      
				Waerk: dataObj.Waerk,                                                                                                                                                                                                                                      
				Agegrp: dataObj.Agegrp                                                                                                                                                                                                                                     
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//on Relese datain table                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
		onRelease: function () {                                                                                                                                                                                                                                     
			var oTable = this.getView().byId("tblBlockedSoSet");                                                                                                                                                                                                        
			var oIndices = oTable.getSelectedIndices();                                                                                                                                                                                                                 
			var oString = "";                                                                                                                                                                                                                                           
			oIndices.forEach(function (data) {                                                                                                                                                                                                                          
				oString += oTable.getContextByIndex(data).getProperty("Vbeln") + ",";                                                                                                                                                                                      
			});                                                                                                                                                                                                                                                         
			this.getView().setBusy(true);                                                                                                                                                                                                                               
			this.getView().getModel().callFunction("/ReleaseCreditBlock", {                                                                                                                                                                                             
				method: "GET",                                                                                                                                                                                                                                             
				urlParameters: {                                                                                                                                                                                                                                           
					"Vbeln": oString                                                                                                                                                                                                                                          
				},                                                                                                                                                                                                                                                         
				success: function (data) {                                                                                                                                                                                                                                 
					if (data.results.length) {                                                                                                                                                                                                                                
						this.getView().getModel("messageModel").setData(data.results);                                                                                                                                                                                           
					}                                                                                                                                                                                                                                                         
					this.byId("btnMsg").firePress();                                                                                                                                                                                                                          
					oTable.clearSelection();                                                                                                                                                                                                                                  
					this.getView().getModel().refresh(true);                                                                                                                                                                                                                  
					this.getView().setBusy(false);                                                                                                                                                                                                                            
				}.bind(this),                                                                                                                                                                                                                                              
				error: function (err) {                                                                                                                                                                                                                                    
					this.getView().setBusy(false);                                                                                                                                                                                                                            
				}.bind(this)                                                                                                                                                                                                                                               
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Triggered by the table's 'updateFinished' event: after new table                                                                                                                                                                                          
		 * data is available, this handler method updates the table counter.                                                                                                                                                                                         
		 * This should only happen if the update was successful, which is                                                                                                                                                                                            
		 * why this handler is attached to 'updateFinished' and not to the                                                                                                                                                                                           
		 * table's list binding's 'dataReceived' method.                                                                                                                                                                                                             
		 * @param {sap.ui.base.Event} oEvent the update finished event                                                                                                                                                                                               
		 * @public                                                                                                                                                                                                                                                   
		 */                                                                                                                                                                                                                                                          
		onUpdateFinished: function (oEvent) {                                                                                                                                                                                                                        
			// update the worklist's object counter after the table update                                                                                                                                                                                              
			var sTitle,                                                                                                                                                                                                                                                 
				oTable = oEvent.getSource(),                                                                                                                                                                                                                               
				iTotalItems = oEvent.getParameter("total");                                                                                                                                                                                                                
			// only update the counter if the length is final and                                                                                                                                                                                                       
			// the table is not empty                                                                                                                                                                                                                                   
			if (iTotalItems && oTable.getBinding("items").isLengthFinal()) {                                                                                                                                                                                            
				sTitle = this.getResourceBundle().getText("worklistTableTitleCount", [iTotalItems]);                                                                                                                                                                       
			} else {                                                                                                                                                                                                                                                    
				sTitle = this.getResourceBundle().getText("worklistTableTitle");                                                                                                                                                                                           
			}                                                                                                                                                                                                                                                           
			this.getModel("worklistView").setProperty("/worklistTableTitle", sTitle);                                                                                                                                                                                   
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Event handler when a table item gets pressed                                                                                                                                                                                                              
		 * @param {sap.ui.base.Event} oEvent the table selectionChange event                                                                                                                                                                                         
		 * @public                                                                                                                                                                                                                                                   
		 */                                                                                                                                                                                                                                                          
		onPress: function (oEvent) {                                                                                                                                                                                                                                 
			// The source is the list item that got pressed                                                                                                                                                                                                             
			this._showObject(oEvent.getSource());                                                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Event handler for navigating back.                                                                                                                                                                                                                        
		 * We navigate back in the browser history                                                                                                                                                                                                                   
		 * @public                                                                                                                                                                                                                                                   
		 */                                                                                                                                                                                                                                                          
		onNavBack: function () {                                                                                                                                                                                                                                     
			// eslint-disable-next-line sap-no-history-manipulation                                                                                                                                                                                                     
			history.go(-1);                                                                                                                                                                                                                                             
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onSearch: function (oEvent) {                                                                                                                                                                                                                                
			if (oEvent.getParameters().refreshButtonPressed) {                                                                                                                                                                                                          
				// Search field's 'refresh' button has been pressed.                                                                                                                                                                                                       
				// This is visible if you select any master list item.                                                                                                                                                                                                     
				// In this case no new search is triggered, we only                                                                                                                                                                                                        
				// refresh the list binding.                                                                                                                                                                                                                               
				this.onRefresh();                                                                                                                                                                                                                                          
			} else {                                                                                                                                                                                                                                                    
				var aTableSearchState = [];                                                                                                                                                                                                                                
				var sQuery = oEvent.getParameter("query");                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
				if (sQuery && sQuery.length > 0) {                                                                                                                                                                                                                         
					aTableSearchState = [new Filter("Auart", FilterOperator.Contains, sQuery)];                                                                                                                                                                               
				}                                                                                                                                                                                                                                                          
				this._applySearch(aTableSearchState);                                                                                                                                                                                                                      
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Event handler for refresh event. Keeps filter, sort                                                                                                                                                                                                       
		 * and group settings and refreshes the list binding.                                                                                                                                                                                                        
		 * @public                                                                                                                                                                                                                                                   
		 */                                                                                                                                                                                                                                                          
		onRefresh: function () {                                                                                                                                                                                                                                     
			var oTable = this.byId("table");                                                                                                                                                                                                                            
			oTable.getBinding("items").refresh();                                                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//Customer F4 Help                                                                                                                                                                                                                                           
		onCustomerView: function (oEvent) {                                                                                                                                                                                                                          
			var oModel = this.getView().getModel("CompanyModel");                                                                                                                                                                                                       
			this.openQuickView(oEvent, oModel);                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		openQuickView: function (oEvent) {                                                                                                                                                                                                                           
			var oButton = oEvent.getSource();                                                                                                                                                                                                                           
			// create value help dialog                                                                                                                                                                                                                                 
			if (!this._customerQuickView) {                                                                                                                                                                                                                             
				this._customerQuickView = sap.ui.xmlfragment(                                                                                                                                                                                                              
					"com.bso.Blocked_Sales_Orders.Fragment.customerQuickView",                                                                                                                                                                                                
					this                                                                                                                                                                                                                                                      
				);                                                                                                                                                                                                                                                         
				this.getView().addDependent(this._customerQuickView);                                                                                                                                                                                                      
			}                                                                                                                                                                                                                                                           
			// open value help dialog filtered by the input value                                                                                                                                                                                                       
			this._customerQuickView.openBy(oButton);                                                                                                                                                                                                                    
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/* =========================================================== */                                                                                                                                                                                            
		/* internal methods                                            */                                                                                                                                                                                            
		/* =========================================================== */                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Shows the selected item on the object page                                                                                                                                                                                                                
		 * On phones a additional history entry is created                                                                                                                                                                                                           
		 * @param {sap.m.ObjectListItem} oItem selected Item                                                                                                                                                                                                         
		 * @private                                                                                                                                                                                                                                                  
		 */                                                                                                                                                                                                                                                          
		_showObject: function (oItem) {                                                                                                                                                                                                                              
			this.getRouter().navTo("object", {                                                                                                                                                                                                                          
				objectId: oItem.getBindingContext().getProperty("Vbeln")                                                                                                                                                                                                   
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Internal helper method to apply both filter and search state together on the list binding                                                                                                                                                                 
		 * @param {sap.ui.model.Filter[]} aTableSearchState An array of filters for the search                                                                                                                                                                       
		 * @private                                                                                                                                                                                                                                                  
		 */                                                                                                                                                                                                                                                          
		_applySearch: function (aTableSearchState) {                                                                                                                                                                                                                 
			var oTable = this.byId("table"),                                                                                                                                                                                                                            
				oViewModel = this.getModel("worklistView");                                                                                                                                                                                                                
			oTable.getBinding("items").filter(aTableSearchState, "Application");                                                                                                                                                                                        
			// changes the noDataText of the list in case there are no filter results                                                                                                                                                                                   
			if (aTableSearchState.length !== 0) {                                                                                                                                                                                                                       
				oViewModel.setProperty("/tableNoDataText", this.getResourceBundle().getText("worklistNoDataWithSearchText"));                                                                                                                                              
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_serviceCall: function () {                                                                                                                                                                                                                                  
			var that = this;                                                                                                                                                                                                                                            
			this.getView().setBusy(true);                                                                                                                                                                                                                               
			var dmSel1 = this.getView().byId("dimensionSelector1").getSelectedKey();                                                                                                                                                                                    
			var dmSel2 = this.getView().byId("dimensionSelector2").getSelectedKey();                                                                                                                                                                                    
			var dmSel3 = this.getView().byId("dimensionSelector3").getSelectedKey();                                                                                                                                                                                    
			this.getModel().read("/CreditBlockedSOSet", {                                                                                                                                                                                                               
				success: function (data) {                                                                                                                                                                                                                                 
					var a = [],                                                                                                                                                                                                                                               
						b = [],                                                                                                                                                                                                                                                  
						c = [],                                                                                                                                                                                                                                                  
						e = [];                                                                                                                                                                                                                                                  
					data.results.forEach(function (d) {                                                                                                                                                                                                                       
						a.push(d.Vkorg);                                                                                                                                                                                                                                         
						b.push(d.Waerk);                                                                                                                                                                                                                                         
						c.push(d.Netwr);                                                                                                                                                                                                                                         
						e.push(d.Agegrp);                                                                                                                                                                                                                                        
					});                                                                                                                                                                                                                                                       
					a = a.filter(function (value, index) {                                                                                                                                                                                                                    
						return a.indexOf(value) === index;                                                                                                                                                                                                                       
					});                                                                                                                                                                                                                                                       
					b = b.filter(function (value, index) {                                                                                                                                                                                                                    
						return b.indexOf(value) === index;                                                                                                                                                                                                                       
					});                                                                                                                                                                                                                                                       
					e = e.filter(function (value, index) {                                                                                                                                                                                                                    
						return e.indexOf(value) === index;                                                                                                                                                                                                                       
					});                                                                                                                                                                                                                                                       
					c = c.reduce(function (r, t) {                                                                                                                                                                                                                            
						return parseInt(r, 10) + parseInt(t, 10);                                                                                                                                                                                                                
					}, 0);                                                                                                                                                                                                                                                    
					var oCurrencyFormat = NumberFormat.getCurrencyInstance({                                                                                                                                                                                                  
						currencyCode: false                                                                                                                                                                                                                                      
					});                                                                                                                                                                                                                                                       
					// var oLocale = new sap.ui.core.Locale("en-US");                                                                                                                                                                                                         
					// var oFormatOptions = {                                                                                                                                                                                                                                 
					// 	minIntegerDigits: 0,                                                                                                                                                                                                                                  
					// 	maxIntegerDigits: 15,                                                                                                                                                                                                                                 
					// 	minFractionDigits: 0,                                                                                                                                                                                                                                 
					// 	maxFractionDigits: 5                                                                                                                                                                                                                                  
					// };                                                                                                                                                                                                                                                     
					// var oFloatFormat = NumberFormat.getFloatInstance(oFormatOptions, oLocale);                                                                                                                                                                             
					that.getView().getModel("g").setData({                                                                                                                                                                                                                    
						salesOrg: a.sort(),                                                                                                                                                                                                                                      
						currency: b,                                                                                                                                                                                                                                             
						ageGrp: e.sort(),                                                                                                                                                                                                                                        
						TotalRB: oCurrencyFormat.format(c, b[0]),                                                                                                                                                                                                                
						graph: data                                                                                                                                                                                                                                              
					});                                                                                                                                                                                                                                                       
					if ((dmSel1 && dmSel2 && dmSel3) === "") {                                                                                                                                                                                                                
						that._dataSetBind(a.sort()[0], b[0], e.sort()[0]);                                                                                                                                                                                                       
						that.getView().byId("dimensionSelector1").setSelectedKey(a.sort()[0]);                                                                                                                                                                                   
						that.getView().byId("dimensionSelector2").setSelectedKey(b[0]);                                                                                                                                                                                          
						that.getView().byId("dimensionSelector3").setSelectedKey(e.sort()[0]);                                                                                                                                                                                   
					} else {                                                                                                                                                                                                                                                  
						that._dataSetBind(dmSel1, dmSel2, dmSel3);                                                                                                                                                                                                               
						that.getView().byId("dimensionSelector1").setSelectedKey(dmSel1);                                                                                                                                                                                        
						that.getView().byId("dimensionSelector2").setSelectedKey(dmSel2);                                                                                                                                                                                        
						that.getView().byId("dimensionSelector3").setSelectedKey(dmSel3);                                                                                                                                                                                        
					}                                                                                                                                                                                                                                                         
					// that.onSalesOrgdrpChange();                                                                                                                                                                                                                            
					that.getView().setBusy(false);                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
				},                                                                                                                                                                                                                                                         
				error: function () {                                                                                                                                                                                                                                       
					that.getView().setBusy(false);                                                                                                                                                                                                                            
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_dimSel: function (a) {                                                                                                                                                                                                                                      
			var oDim = this.getView().byId("chartContainer").getDimensionSelectors();                                                                                                                                                                                   
			oDim.forEach(function (obj) {                                                                                                                                                                                                                               
				obj.setVisible(a);                                                                                                                                                                                                                                         
			});                                                                                                                                                                                                                                                         
			// this.getView().byId("customIcon1").setVisible(a);                                                                                                                                                                                                        
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_dataSetBind: function (a, b, c) {                                                                                                                                                                                                                           
			var oVizDataSet = this.getView().byId("idVizDataSet");                                                                                                                                                                                                      
			var nArray;                                                                                                                                                                                                                                                 
			if (a === "" && b === "" && c === "") {                                                                                                                                                                                                                     
				this.getView().byId("dimensionSelector1").setSelectedItem(null);                                                                                                                                                                                           
				this.getView().byId("dimensionSelector2").setSelectedItem(null);                                                                                                                                                                                           
				this.getView().byId("dimensionSelector3").setSelectedItem(null);                                                                                                                                                                                           
				nArray = [];                                                                                                                                                                                                                                               
			} else {                                                                                                                                                                                                                                                    
				nArray = [new Filter("Vkorg", FilterOperator.EQ, a), new Filter("Waerk", FilterOperator.EQ, b),                                                                                                                                                            
					new Filter("Agegrp", FilterOperator.EQ, c)                                                                                                                                                                                                                
				];                                                                                                                                                                                                                                                         
			}                                                                                                                                                                                                                                                           
			oVizDataSet.getBinding("data").filter(nArray, "Application");                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onDataChange: function (f) {                                                                                                                                                                                                                                 
			try {                                                                                                                                                                                                                                                       
				var oCurr = this.getView().getModel("g").getData().currency[0];                                                                                                                                                                                            
			} catch (e) {                                                                                                                                                                                                                                               
				oCurr = "";                                                                                                                                                                                                                                                
			}                                                                                                                                                                                                                                                           
			var oKey = this.getView().byId("dimensionSelector2").getSelectedKey();                                                                                                                                                                                      
			var dmSel2 = oKey === "" ? oCurr : oKey;                                                                                                                                                                                                                    
			if (f.getParameter("reason") === "filter") {                                                                                                                                                                                                                
				var arr = [];                                                                                                                                                                                                                                              
				f.getSource().getContexts().forEach(function (obj) {                                                                                                                                                                                                       
					arr.push(obj.getObject().Netwr);                                                                                                                                                                                                                          
				});                                                                                                                                                                                                                                                        
				arr = arr.reduce(function (r, t) {                                                                                                                                                                                                                         
					return parseInt(r, 10) + parseInt(t, 10);                                                                                                                                                                                                                 
				}, 0);                                                                                                                                                                                                                                                     
				var oCurrencyFormat = NumberFormat.getCurrencyInstance({                                                                                                                                                                                                   
					currencyCode: false                                                                                                                                                                                                                                       
				});                                                                                                                                                                                                                                                        
				// var oLocale = new sap.ui.core.Locale("en-US");                                                                                                                                                                                                          
				// var oFormatOptions = {                                                                                                                                                                                                                                  
				// 	minIntegerDigits: 0,                                                                                                                                                                                                                                   
				// 	maxIntegerDigits: 15,                                                                                                                                                                                                                                  
				// 	minFractionDigits: 0,                                                                                                                                                                                                                                  
				// 	maxFractionDigits: 7                                                                                                                                                                                                                                   
				// };                                                                                                                                                                                                                                                      
				// var oFloatFormat = NumberFormat.getFloatInstance(oFormatOptions, oLocale);                                                                                                                                                                              
				this.getView().getModel("g").setProperty("/TotalRB", oCurrencyFormat.format(arr, dmSel2));                                                                                                                                                                 
				if (!f.getSource().getFilterInfo()) {                                                                                                                                                                                                                      
					var oProp = this.getView().getModel("g").getProperty("/TotalRB");                                                                                                                                                                                         
					this.getView().getModel("g").setProperty("/TotalRB", oProp.slice(1));                                                                                                                                                                                     
				}                                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onSalesOrgdrpChange: function (oEvent) {                                                                                                                                                                                                                     
			try {                                                                                                                                                                                                                                                       
				var oItem = this.getView().byId("dimensionSelector1").getSelectedItem().getText();                                                                                                                                                                         
			} catch (er) {                                                                                                                                                                                                                                              
				oItem = "";                                                                                                                                                                                                                                                
			}                                                                                                                                                                                                                                                           
			try {                                                                                                                                                                                                                                                       
				var oItem2 = this.getView().byId("dimensionSelector2").getSelectedItem().getText();                                                                                                                                                                        
			} catch (ee) {                                                                                                                                                                                                                                              
				oItem = "";                                                                                                                                                                                                                                                
			}                                                                                                                                                                                                                                                           
			try {                                                                                                                                                                                                                                                       
				var oItem3 = this.getView().byId("dimensionSelector3").getSelectedItem().getText();                                                                                                                                                                        
			} catch (er) {                                                                                                                                                                                                                                              
				oItem = "";                                                                                                                                                                                                                                                
			}                                                                                                                                                                                                                                                           
			this._dataSetBind(oItem, oItem2, oItem3);                                                                                                                                                                                                                   
		}                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
		// handleResetChart: function () {                                                                                                                                                                                                                           
		// 	this._dataSetBind("", "", "");                                                                                                                                                                                                                           
		// }                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
	});                                                                                                                                                                                                                                                           
});                                                                                                                                                                                                                                                            
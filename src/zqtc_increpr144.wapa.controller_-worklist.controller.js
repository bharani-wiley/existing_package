sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/viz/ui5/controls/Popover","sap/ui/core/format/NumberFormat","sap/ui/core/Fragment","sap/m/Token","sap/m/MessageB+
ox"],function(e,t,a,i,r,s,o,n,l,d){"use strict";return e.extend("ir.ZE144_IncompletionReport.controller.Worklist",{formatter:a,onInit:function(){this.getView().setBusy(true);var e=new t;this.newFilters=[];this.getView().setModel(e,"f4HelpsModel");var a=t+
his.getView().byId("idVizFrame");a.setVizProperties({plotArea:{dataLabel:{visible:true,showTotal:true}},valueAxis:{title:{text:"Number of Orders",visible:true}},categoryAxis:{title:{text:"Business Model",visible:true},label:{hideSubLevels:false,style:{fo+
ntSize:"0.8rem",fontWeight:"bold"}}},legend:{title:{text:"Currency",visible:true,style:{color:"black"}}},title:{visible:false,text:"Bar"}});this._callF4Helps();var i=this.getView().byId("idPopOver");i.setActionItems([{type:"action",text:"Show Table",pres+
s:this.onPopoverPress.bind(this)}]);i.connect(a.getVizUid())},onRefreshGraph:function(){this._callDashBoardSet()},onFilterDialogPress:function(e){var t=e.getSource(),a=this.getView();if(!this._oFilterDialog){this._oFilterDialog=n.load({id:a.getId(),name:+
"ir.ZE144_IncompletionReport.Fragment.FilterDialog",controller:this}).then(function(e){debugger;a.addDependent(e);var t=new Date;t.setDate(t.getDate()-parseInt(this.getView().getModel("f4HelpsModel").getProperty("/ZCACONSTSet")[0].Low,10));var i=t.toISOS+
tring().split("T")[0];this.getView().byId("iddRCreatedDate").setDateValue(new Date(i));var r=new Date;t.setDate(r.getDate()-parseInt(this.getView().getModel("f4HelpsModel").getProperty("/ZCACONSTSet")[0].Low,10));var s=r.toISOString().split("T")[0];this.+
getView().byId("iddRCreatedDate").setSecondDateValue(new Date(s));return e}.bind(this))}this._oFilterDialog.then(function(e){e.open()}.bind(this))},onCreatedDateChange:function(e){var t=this.getView().byId("iddRCreatedDate").getFrom(),a=this.getView().by+
Id("iddRCreatedDate").getTo();var i=a-t;var r=Math.round(i/(1e3*3600*24));var s=this.getView().getModel("f4HelpsModel").getProperty("/ZCACONSTSet")[0].Low;if(r>30){d.error("Date Range should be within "+s+" days");this.getView().byId("iddRCreatedDate").s+
etValueState("Error")}else{this.getView().byId("iddRCreatedDate").setValueState("None")}},onFilterDialogClose:function(e){var t=this.getView().byId("iddRCreatedDate");var a=t.getValueState();if(a==="Error"){var i=sap.ui.core.format.DateFormat.getDateInst+
ance({pattern:"dd-MM-yyyy"});var r=new Date;r.setDate(r.getDate()-parseInt(this.getView().getModel("f4HelpsModel").getProperty("/ZCACONSTSet")[0].Low,10));var s=r.toISOString().split("T")[0];this.getView().byId("iddRCreatedDate").setDateValue(new Date(s)+
);var o=new Date;r.setDate(o.getDate()-parseInt(this.getView().getModel("f4HelpsModel").getProperty("/ZCACONSTSet")[0].Low,10));var n=o.toISOString().split("T")[0];this.getView().byId("iddRCreatedDate").setSecondDateValue(new Date(n));t.setValueState("No+
ne")}this._oFilterDialog.then(function(e){e.close()})},onFilterDialogGo:function(e){var t=this.onCreatedDateChange();if(this.getView().byId("iddRCreatedDate").getValueState()!=="Error"){this.onFilterDialogClose();this._callDashBoardSet()}},onFilterDialog+
Clear:function(e){var t=this.getView();var a=["idMISalesOrder","iddRCreatedDate","iddRBillingDate","idMISalesOrg","idMIOrderType","idMIPoType","idMIMatNum","idCBPayStat","idMIPayTerms","idMISldToBPID","idMIShpToBPID","idMIFFBPID","idMISocBPID","idMIMatGr+
p5","idMIPrcGrp","idMISalesDoc"];for(var i=0;i<a.length;i++){var r=t.byId(a[i]);var s=r.getName();if(r instanceof sap.m.MultiInput){r.setTokens([])}else if(r instanceof sap.m.ComboBox){r.setSelectedKey("")}else if(r instanceof sap.m.DateRangeSelection){i+
f(a[i]==="iddRBillingDate"){r.setValue("")}}}},_callDashBoardSet:function(){debugger;this.getView().setBusy(true);var e=this.getView();var t=this.getView().getModel("f4HelpsModel");var a=this.getView().getModel("globalFilters");var i=this.getView().getMo+
del();var r=["idMISalesOrder","iddRCreatedDate","iddRBillingDate","idMISalesOrg","idMIOrderType","idMIPoType","idMIMatNum","idCBPayStat","idMIPayTerms","idMISldToBPID","idMIShpToBPID","idMIFFBPID","idMISocBPID","idMIMatGrp5","idMIPrcGrp","idMISalesDoc"];+
try{for(var s=0;s<r.length;s++){var o=e.byId(r[s]);var n=o.getName();if(o instanceof sap.m.MultiInput&&o.getTokens().length){var l=o.getTokens().map(function(e){return e.getKey()});a.setProperty("/"+n,l)}else if(o instanceof sap.m.ComboBox&&o.getSelected+
Key().length){var g=o.getSelectedKey();a.setProperty("/"+n,[g])}else if(o instanceof sap.m.DateRangeSelection&&o.getValue().length){a.setProperty("/"+n,[o.getValue()])}else{a.setProperty("/"+n,[])}}}catch(e){}var u=this._createFilters();if(u.length>0){th+
is.getView().byId("idfilterIcon").setVisible(true)}else{this.getView().byId("idfilterIcon").setVisible(false)}i.read("/DashboardSet",{filters:u,success:function(e,a){t.setProperty("/DashboardSet",e.results);this.getView().setBusy(false)}.bind(this),error+
:function(e){debugger;if(e.statusCode===504){d.error("Please change selection criteria for filter DateRange")}this.getView().setBusy(false)}.bind(this)})},_createFilters:function(){var e=[];var t=this.getView().getModel("globalFilters").getData();for(var+
 a in t){if(t[a].length>1){e.push(new i(t[a].map(function(e){return new i(a,r.EQ,e)})))}else if(t[a].length===1){e.push(new i(a,r.EQ,t[a]))}}return e},clearAllFilters:function(){location.reload()},onPress:function(e){this._showObject(e.getSource())},onNa+
vBack:function(){history.go(-1)},onReset:function(){var e=this.getOwnerComponent().getModel();var t=this.getView().byId("idVizFrame");var a=this.getView().getModel("f4HelpsModel");var i=new Promise(function(t,i){e.read("/DashboardSet",{success:function(e+
,i){a.setProperty("/DashboardSet",e.results);t()},error:function(e){i()}})});i.then(function(e){t.getDataset().getBinding("data").filter([])})},_showObject:function(e){this.getRouter().navTo("object",{Model:this.MODEL,Waerk:this.WAERK});var t=this.getVie+
w().byId("idVizFrame");t.vizSelection([],{clearSelection:true})},_callF4Helps:function(){var e=this;var t=this.getOwnerComponent().getModel();var a=this.getModel("worklistView");var i=["DashboardSet","ZCACONSTSet"];for(var r=0;r<i.length;r++){var s=i[r];+
t.read("/"+s,{success:e._callF4HelpsSuccess.bind(e,s),error:e._callF4HelpsError})}},_callF4HelpsSuccess:function(e,t,a){var i=this.getView().getModel("f4HelpsModel");i.setData({[e]:t.results},true);this.getView().setBusy(false);if(e==="ZCACONSTSet"){debu+
gger;var r=sap.ui.core.format.DateFormat.getDateInstance({pattern:"dd-MM-yyyy"});var s=new Date;debugger;s.setDate(s.getDate()-parseInt(t.results[0].Low,10));var o=r.format(s);var n=r.format(new Date);var l=o+" , "+n;this.getView().getModel("globalFilter+
s").setProperty("/ERDAT",[l])}},_callF4HelpsError:function(e){var t},onPopoverPress:function(e){this._showObject(e.getSource())},onSelectData:function(e){var t=e.getParameter("data")[0].data.measureNames;var a=this.getView().byId("idVizDataSet").getBindi+
ng("data").getContexts();var i=e.getParameter("data")[0].data._context_row_number;var r=a[i].getObject();this.MODEL=r.MODEL;this.WAERK=r.WAERK;this._DisplayRevenue(t,r)},_DisplayRevenue:function(e,t){var a=this.getView().byId("idVizFrame");var i={customD+
ataControl:function(e){var a=new Intl.NumberFormat("en-US",{style:"currency",currency:e.data.val[0].value});var i=new sap.m.HBox({items:[new sap.m.Label({text:"Business Model:",design:"Bold"}).addStyleClass("sapUiTinyMarginEnd"),new sap.m.Text({text:t.MO+
DEL})]});var r=new sap.m.HBox({items:[new sap.m.Label({text:"Revenue:",design:"Bold"}).addStyleClass("sapUiTinyMarginEnd"),new sap.m.Text({text:a.format(t.NETWR)})]});var s=new sap.m.HBox({items:[new sap.m.Label({text:"Count:",design:"Bold"}).addStyleCla+
ss("sapUiTinyMarginEnd"),new sap.m.Text({text:t.COUNT})]});return new sap.m.VBox({items:[i,r,s]}).addStyleClass("sapUiTinyMargin")}};this.oPopOver=new s(i);this.oPopOver.setActionItems([{type:"action",text:"Show Table",press:this.onPopoverPress.bind(this+
)}]);this.oPopOver.connect(a.getVizUid())},handleSalesModel:function(e,t,a,i){debugger;var r=this;var s=e.getSource().getValue(),o=this.getView();this.currentObject=e.getSource();var l=new sap.m.StandardListItem({title:"{f4HelpsModel>"+a+"}",description:+
"{f4HelpsModel>"+i+"}"});if(!this[t]){this[t]=n.load({id:o.getId()+t,name:"ir.ZE144_IncompletionReport.Fragment.SalesModel",controller:this}).then(function(e){o.addDependent(e);r.f4ModelChangeServicesCall(t,e);return e})}this[t].then(function(e){e.bindAg+
gregation("items",{path:"/"+t,model:"f4HelpsModel",template:l,templateShareable:true});e.open()})},f4ModelChangeServicesCall:function(e,t){t.setBusy(true);var a=this.getView().getModel("f4HelpsModel");this.getView().getModel().read("/"+e,{success:functio+
n(i,r){a.setData({[e]:i.results},true);t.setBusy(false)}.bind(this),error:function(e){t.setBusy(false)}.bind(this)})},_handleValueHelpSearch:function(e){debugger;var t=e.getParameter("itemsBinding").getPath();var a=e.getParameter("itemsBinding").getModel+
();var s=a.getProperty(t)[0];var o=Object.keys(s);var n=o.filter(function(e){return e!=="__metadata"});var l=e.getParameter("value");var d=n.map(function(e){return new i(e,r.Contains,l)});var g=new i(d);e.getSource().getBinding("items").filter(g)},_handl+
eValueHelpClose:function(e){debugger;var t=e.getParameter("selectedItems"),a=this.currentObject;if(t&&t.length>0){t.forEach(function(e){a.addToken(new l({text:e.getDescription(),key:e.getTitle()}))})}}})});                                                 
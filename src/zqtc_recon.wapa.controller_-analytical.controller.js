sap.ui.define([                                                                                                                                                                                                                                                
	"sap/ui/core/mvc/Controller",                                                                                                                                                                                                                                 
	"sap/m/MessageToast",                                                                                                                                                                                                                                         
	"sap/ui/model/Filter",                                                                                                                                                                                                                                        
	"sap/ui/model/FilterOperator",                                                                                                                                                                                                                                
	"sap/ui/model/json/JSONModel",                                                                                                                                                                                                                                
	"sap/m/MessageBox"                                                                                                                                                                                                                                            
], function (Controller, MessageToast, Filter, FilterOperator, JSONModel, MessageBox) {                                                                                                                                                                        
	"use strict";                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
	return Controller.extend("recon.ZRECON_DASHBOARD.controller.Analytical", {                                                                                                                                                                                    
		onInit: function () {                                                                                                                                                                                                                                        
			                                                                                                                                                                                                                                                            
				//////Session Timeout implementation                                                                                                                                                                                                                       
				// document.onmousemove = timeOut;                                                                                                                                                                                                                         
				var osetTime;                                                                                                                                                                                                                                              
				var oPromise = new Promise(function (res, rej) {                                                                                                                                                                                                           
					this.getOwnerComponent().getModel().read("/daysSet", {                                                                                                                                                                                                    
						success: function (data) {                                                                                                                                                                                                                               
							osetTime = data.results[0].Time * 1000;                                                                                                                                                                                                                 
							res();                                                                                                                                                                                                                                                  
						},                                                                                                                                                                                                                                                       
						error: function (err) {                                                                                                                                                                                                                                  
							osetTime = "300000";                                                                                                                                                                                                                                    
							rej();                                                                                                                                                                                                                                                  
						}                                                                                                                                                                                                                                                        
					});                                                                                                                                                                                                                                                       
				}.bind(this));                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
				oPromise.then(function (val) {                                                                                                                                                                                                                             
					var timer;                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
					function timeOut() {                                                                                                                                                                                                                                      
						clearTimeout(timer);                                                                                                                                                                                                                                     
						timer = setTimeout(function () {                                                                                                                                                                                                                         
							MessageBox.show(                                                                                                                                                                                                                                        
								"Click OK to Refresh", {                                                                                                                                                                                                                               
									icon: MessageBox.Icon.Error,                                                                                                                                                                                                                          
									title: "Session Timeout",                                                                                                                                                                                                                             
									onClose: function (sAction) {                                                                                                                                                                                                                         
										location.reload(); // eslint-disable-line sap-no-location-reload                                                                                                                                                                                     
									}                                                                                                                                                                                                                                                     
								}                                                                                                                                                                                                                                                      
							);                                                                                                                                                                                                                                                      
						}, osetTime);                                                                                                                                                                                                                                            
					}                                                                                                                                                                                                                                                         
					document.onmousemove = timeOut;                                                                                                                                                                                                                           
					//document.onkeypress = timeOut;                                                                                                                                                                                                                          
				});                                                                                                                                                                                                                                                        
			//Table Seacrh&nbsp;                                                                                                                                                                                                                                        
			var oViewModel,                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
				oTable = this.byId("idProductsTable");                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
			// Put down worklist table's original value for busy indicator delay,                                                                                                                                                                                       
			// so it can be restored later on. Busy handling on the table is                                                                                                                                                                                            
			// taken care of by the table itself.                                                                                                                                                                                                                       
			this._oTable = oTable;                                                                                                                                                                                                                                      
			// keeps the search state                                                                                                                                                                                                                                   
			this._aTableSearchState = [];                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
			// Model used to manipulate control states                                                                                                                                                                                                                  
			oViewModel = new JSONModel({                                                                                                                                                                                                                                
				tableNoDataText: "No data"                                                                                                                                                                                                                                 
			});                                                                                                                                                                                                                                                         
			this.getView().setModel(oViewModel, "worklistView");                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
			//Viz Frame Data                                                                                                                                                                                                                                            
			var oVizFrame = this.getView().byId("idVizFrame");                                                                                                                                                                                                          
			oVizFrame.setVizProperties({                                                                                                                                                                                                                                
				plotArea: {                                                                                                                                                                                                                                                
					dataLabel: {                                                                                                                                                                                                                                              
						visible: true,                                                                                                                                                                                                                                           
						showTotal: true                                                                                                                                                                                                                                          
					}                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
			this.selectedItemsArray = new Filter("Devid", FilterOperator.EQ, "");                                                                                                                                                                                       
			////Set default dates for Claims Report                                                                                                                                                                                                                     
			this.getDays();                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
			//	this.refreshRpt();                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
			// 	var oRouter = this.getOwnerComponent().getRouter();                                                                                                                                                                                                     
			// oRouter.getRoute("target").attachMatched(this._onRouteMatched, this);                                                                                                                                                                                    
			this.oPopOver = this.getView().byId("idPopOver");                                                                                                                                                                                                           
			this.oPopOver.connect(oVizFrame.getVizUid());                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		// This code refers to routing or Navigation from Analytical view to transaxtional view                                                                                                                                                                      
		// onPress is the function which is written in Analytical view in sap.m.table - colums                                                                                                                                                                       
                                                                                                                                                                                                                                                               
		pressSource: function (oEvent) {                                                                                                                                                                                                                             
			var oSource = oEvent.getSource().getBindingContext().getObject().source;                                                                                                                                                                                    
			var oWricef = oEvent.getSource().getBindingContext().getPath();                                                                                                                                                                                             
			// var oWricef = oEvent.getSource().getBindingContextPath();                                                                                                                                                                                                
			if (oSource !== "3PL") {                                                                                                                                                                                                                                    
				this.getOwnerComponent().getRouter().navTo("transactional", {                                                                                                                                                                                              
					"wricef": encodeURIComponent(oWricef)                                                                                                                                                                                                                     
				});                                                                                                                                                                                                                                                        
			} else {                                                                                                                                                                                                                                                    
				MessageToast.show("No Data for " + oSource + " system", {                                                                                                                                                                                                  
					my: "CenterCenter",                                                                                                                                                                                                                                       
					at: "CenterCenter"                                                                                                                                                                                                                                        
				});                                                                                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		pressMiddleware: function (oEvent) {                                                                                                                                                                                                                         
			// var oSource = oEvent.getSource().getBindingContext().getObject().source;                                                                                                                                                                                 
			var oWricef = oEvent.getSource().getBindingContext().getPath();                                                                                                                                                                                             
			// var oWricef = oEvent.getSource().getBindingContextPath();                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
			this.getOwnerComponent().getRouter().navTo("middleware", {                                                                                                                                                                                                  
				"wricef": encodeURIComponent(oWricef)                                                                                                                                                                                                                      
			});                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		pressTarget: function (oEvent) {                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
			// var oSource = oEvent.getSource().getBindingContext().getObject().source;                                                                                                                                                                                 
			var oWricef = oEvent.getSource().getBindingContext("idocStat").getPath();                                                                                                                                                                                   
			// var oWricef = oEvent.getSource().getBindingContextPath();                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
			this.getOwnerComponent().getRouter().navTo("target", {                                                                                                                                                                                                      
				"wricef": encodeURIComponent(oWricef)                                                                                                                                                                                                                      
			});                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onSearch: function (oEvent) {                                                                                                                                                                                                                                
			if (oEvent.getParameters().refreshButtonPressed) {                                                                                                                                                                                                          
				// Search field's 'refresh' button has been pressed.                                                                                                                                                                                                       
				// This is visible if you select any master list item.                                                                                                                                                                                                     
				// In this case no new search is triggered, we only                                                                                                                                                                                                        
				// refresh the list binding.                                                                                                                                                                                                                               
				this.onRefresh();                                                                                                                                                                                                                                          
			} else {                                                                                                                                                                                                                                                    
				var aTableSearchState = [];                                                                                                                                                                                                                                
				var sQuery = oEvent.getParameter("query");                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
				if (sQuery && sQuery.length > 0) {                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
					aTableSearchState = [new Filter({                                                                                                                                                                                                                         
						filters: [                                                                                                                                                                                                                                               
							new Filter("wricef", FilterOperator.Contains, sQuery),                                                                                                                                                                                                  
							new Filter("source", FilterOperator.Contains, sQuery),                                                                                                                                                                                                  
							new Filter("middleware", FilterOperator.Contains, sQuery),                                                                                                                                                                                              
							new Filter("target", FilterOperator.Contains, sQuery),                                                                                                                                                                                                  
							new Filter("description", FilterOperator.Contains, sQuery)                                                                                                                                                                                              
						]                                                                                                                                                                                                                                                        
					})];                                                                                                                                                                                                                                                      
				}                                                                                                                                                                                                                                                          
				this._applySearch(aTableSearchState);                                                                                                                                                                                                                      
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onRefresh: function () {                                                                                                                                                                                                                                     
			var oTable = this.getView().byId("idProductsTable");                                                                                                                                                                                                        
			oTable.getBinding("items").refresh();                                                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_applySearch: function (aTableSearchState) {                                                                                                                                                                                                                 
			var oTable = this.getView().byId("idProductsTable"),                                                                                                                                                                                                        
				oViewModel = this.getView().getModel();                                                                                                                                                                                                                    
			oTable.getBinding("items").filter(aTableSearchState, "Application");                                                                                                                                                                                        
			// changes the noDataText of the list in case there are no filter results                                                                                                                                                                                   
			if (aTableSearchState.length !== 0) {                                                                                                                                                                                                                       
				oViewModel.setProperty("/tableNoDataText", this.getResourceBundle().getText("worklistNoDataWithSearchText"));                                                                                                                                              
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		handleSelectionFinish: function (oEvent) {                                                                                                                                                                                                                   
			var selectedItems = oEvent.getParameter("selectedItems");                                                                                                                                                                                                   
			var selectedItemsArray = [],                                                                                                                                                                                                                                
				selectedItemsText = [];                                                                                                                                                                                                                                    
			var i;                                                                                                                                                                                                                                                      
			for (i = 0; i < selectedItems.length; i++) {                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
				var selectedItem = selectedItems[i].getText();                                                                                                                                                                                                             
				selectedItemsText.push(selectedItem);                                                                                                                                                                                                                      
				selectedItemsArray.push(new Filter("Devid", FilterOperator.EQ, selectedItem));                                                                                                                                                                             
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			//	if(selectedItemsArray.length > 0){                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
			// var oFilter = new Filter({                                                                                                                                                                                                                               
			// 	filters: selectedItemsArray                                                                                                                                                                                                                             
			// });                                                                                                                                                                                                                                                      
			this.selectedItemsDev = selectedItemsText;                                                                                                                                                                                                                  
			this.selectedItemsArray = selectedItemsArray;                                                                                                                                                                                                               
			//	this.getView().byId("idVizFrame").getDataset().getBinding("data").filter([oFilter]);                                                                                                                                                                     
			//	this.getOwnerComponent().getModel().                                                                                                                                                                                                                     
			//	}                                                                                                                                                                                                                                                        
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		refreshRpt: function () {                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
			var DateFrom = this.getView().byId("IDatefrom").getValue();                                                                                                                                                                                                 
			if (!DateFrom) {                                                                                                                                                                                                                                            
				DateFrom = null;                                                                                                                                                                                                                                           
			} else {                                                                                                                                                                                                                                                    
				sap.ui.getCore().fromDate = DateFrom;                                                                                                                                                                                                                      
			}                                                                                                                                                                                                                                                           
			var DateTo = this.getView().byId("IDateto").getValue();                                                                                                                                                                                                     
			if (!DateTo) {                                                                                                                                                                                                                                              
				DateTo = null;                                                                                                                                                                                                                                             
			} else {                                                                                                                                                                                                                                                    
				sap.ui.getCore().toDate = DateTo;                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
			var oFilter1 = new Filter("Stdate", FilterOperator.EQ, DateFrom),                                                                                                                                                                                           
				oFilter2 = new Filter("Endate", FilterOperator.EQ, DateTo),                                                                                                                                                                                                
				//	oFilter3 = new Filter("Devid", FilterOperator.EQ, this.selectedItemsDev),                                                                                                                                                                               
				oFilter = new Filter({                                                                                                                                                                                                                                     
					filters: [oFilter1, oFilter2],                                                                                                                                                                                                                            
					and: true                                                                                                                                                                                                                                                 
				});                                                                                                                                                                                                                                                        
//get multiple dev id filters                                                                                                                                                                                                                                  
			var i;                                                                                                                                                                                                                                                      
			for (i = 0; i < this.selectedItemsArray.length; i++) {                                                                                                                                                                                                      
				oFilter.aFilters.push(this.selectedItemsArray[i]);                                                                                                                                                                                                         
			}                                                                                                                                                                                                                                                           
			//	oFilter.aFilters.push(this.selectedItemsArray);                                                                                                                                                                                                          
			var that = this;                                                                                                                                                                                                                                            
			that.getView().setBusy(true);                                                                                                                                                                                                                               
			this.getOwnerComponent().getModel().read("/DevStatSet", {                                                                                                                                                                                                   
				filters: [oFilter.aFilters],                                                                                                                                                                                                                               
				success: function (oData, response) {                                                                                                                                                                                                                      
					var oJSONModel = new JSONModel();                                                                                                                                                                                                                         
					oJSONModel.setData(oData);                                                                                                                                                                                                                                
					sap.ui.getCore().setModel(oJSONModel);                                                                                                                                                                                                                    
					that.getView().setModel(oJSONModel, "main");                                                                                                                                                                                                              
					that.getView().setBusy(false);                                                                                                                                                                                                                            
				},                                                                                                                                                                                                                                                         
				error: function (oError) {                                                                                                                                                                                                                                 
					that.getView().setBusy(false);                                                                                                                                                                                                                            
					sap.m.MessageToast.show("No Date For Given Selection");                                                                                                                                                                                                   
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
			that.getView().setBusy(true);                                                                                                                                                                                                                               
			this.getOwnerComponent().getModel().read("/IdocStatSet", {                                                                                                                                                                                                  
				filters: [oFilter.aFilters],                                                                                                                                                                                                                               
				success: function (oData, response) {                                                                                                                                                                                                                      
					var oJSONModel = new JSONModel();                                                                                                                                                                                                                         
					oJSONModel.setData(oData);                                                                                                                                                                                                                                
					sap.ui.getCore().setModel(oJSONModel);                                                                                                                                                                                                                    
					that.getView().setModel(oJSONModel, "idocStat");                                                                                                                                                                                                          
					that.getView().setBusy(false);                                                                                                                                                                                                                            
				},                                                                                                                                                                                                                                                         
				error: function (oError) {                                                                                                                                                                                                                                 
					that.getView().setBusy(false);                                                                                                                                                                                                                            
					sap.m.MessageToast.show("No Date For Given Selection");                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		getDays: function () {                                                                                                                                                                                                                                       
			var that = this;                                                                                                                                                                                                                                            
			this.getOwnerComponent().getModel().read("/daysSet", {                                                                                                                                                                                                      
				success: function (oData, response) {                                                                                                                                                                                                                      
					sap.ui.getCore().days = oData.results[0].Low;                                                                                                                                                                                                             
					that.setDate();                                                                                                                                                                                                                                           
				},                                                                                                                                                                                                                                                         
				error: function (oError) {                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		setDate: function () {                                                                                                                                                                                                                                       
			var oDate = new Date();                                                                                                                                                                                                                                     
			var date = oDate;                                                                                                                                                                                                                                           
			date = date.setDate(date.getDate() - sap.ui.getCore().days);                                                                                                                                                                                                
			this.getView().byId("IDatefrom").setDateValue(new Date(date));                                                                                                                                                                                              
			var oDate2 = new Date();                                                                                                                                                                                                                                    
			this.getView().byId("IDateto").setDateValue(oDate2);                                                                                                                                                                                                        
			//get data                                                                                                                                                                                                                                                  
			this.refreshRpt();                                                                                                                                                                                                                                          
		}                                                                                                                                                                                                                                                            
	});                                                                                                                                                                                                                                                           
});                                                                                                                                                                                                                                                            
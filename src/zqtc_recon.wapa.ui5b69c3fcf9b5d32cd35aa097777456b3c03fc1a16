sap.ui.define([                                                                                                                                                                                                                                                
	"sap/ui/core/mvc/Controller",                                                                                                                                                                                                                                 
	"sap/ui/model/Filter",                                                                                                                                                                                                                                        
	"sap/ui/model/FilterOperator",                                                                                                                                                                                                                                
	"sap/ui/model/json/JSONModel",                                                                                                                                                                                                                                
	"sap/ui/export/library",                                                                                                                                                                                                                                      
	"sap/ui/export/Spreadsheet"                                                                                                                                                                                                                                   
], function (Controller, Filter, FilterOperator, JSONModel, exportLibrary, Spreadsheet) {                                                                                                                                                                      
	"use strict";                                                                                                                                                                                                                                                 
	var EdmType = exportLibrary.EdmType;                                                                                                                                                                                                                          
	return Controller.extend("recon.ZRECON_DASHBOARD.controller.target", {                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Called when a controller is instantiated and its View controls (if available) are already created.                                                                                                                                                        
		 * Can be used to modify the View before it is displayed, to bind event handlers and do other one-time initialization.                                                                                                                                       
		 * @memberOf recon.ZRECON_DASHBOARD.view.target                                                                                                                                                                                                              
		 */                                                                                                                                                                                                                                                          
		onInit: function () {                                                                                                                                                                                                                                        
			var oRouter = this.getOwnerComponent().getRouter();                                                                                                                                                                                                         
			oRouter.getRoute("target").attachMatched(this._onRouteMatched, this);                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Similar to onAfterRendering, but this hook is invoked before the controller's View is re-rendered                                                                                                                                                         
		 * (NOT before the first rendering! onInit() is used for that one!).                                                                                                                                                                                         
		 * @memberOf recon.ZRECON_DASHBOARD.view.target                                                                                                                                                                                                              
		 */                                                                                                                                                                                                                                                          
		//	onBeforeRendering: function() {                                                                                                                                                                                                                           
		//                                                                                                                                                                                                                                                           
		//	},                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Called when the View has been rendered (so its HTML is part of the document). Post-rendering manipulations of the HTML could be done here.                                                                                                                
		 * This hook is the same one that SAPUI5 controls get after being rendered.                                                                                                                                                                                  
		 * @memberOf recon.ZRECON_DASHBOARD.view.target                                                                                                                                                                                                              
		 */                                                                                                                                                                                                                                                          
		//	onAfterRendering: function() {                                                                                                                                                                                                                            
		//                                                                                                                                                                                                                                                           
		//	},                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Called when the Controller is destroyed. Use this one to free resources and finalize activities.                                                                                                                                                          
		 * @memberOf recon.ZRECON_DASHBOARD.view.target                                                                                                                                                                                                              
		 */                                                                                                                                                                                                                                                          
		//	onExit: function() {                                                                                                                                                                                                                                      
		//                                                                                                                                                                                                                                                           
		//	}                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
		onPageBack: function () {                                                                                                                                                                                                                                    
			this.getOwnerComponent().getRouter().navTo("TargetAnalytical", true);                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_onRouteMatched: function (oEvent) {                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
			var oWricef = decodeURIComponent(oEvent.getParameter("arguments").wricef);                                                                                                                                                                                  
			var oView = this.getView();                                                                                                                                                                                                                                 
			oView.setModel(this.getView().getModel("idocStat"));                                                                                                                                                                                                        
			oView.bindElement({                                                                                                                                                                                                                                         
				path: oWricef                                                                                                                                                                                                                                              
			});                                                                                                                                                                                                                                                         
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                 
            oView.byId("IDatefrom2").setDateValue(new Date(sap.ui.getCore().fromDate));                                                                                                                                                                        
            oView.byId("IDateto2").setDateValue(new Date(sap.ui.getCore().toDate));                                                                                                                                                                            
			this.getTabdetails();                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onTabSearch: function (oEvent) {                                                                                                                                                                                                                             
			var aTableSearchState = [];                                                                                                                                                                                                                                 
			var sQuery = oEvent.getParameter("query");                                                                                                                                                                                                                  
			//           if (oEvent.getParameters().refreshButtonPressed) {                                                                                                                                                                                             
			//             this.getView().byId("targetTab").getBinding("items").refresh();                                                                                                                                                                              
                                                                                                                                                                                                                                                               
			//           }                                                                                                                                                                                                                                              
			// else if(sQuery && sQuery.length > 0) {                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
			aTableSearchState = [new Filter({                                                                                                                                                                                                                           
				filters: [                                                                                                                                                                                                                                                 
					new Filter("Docnum", FilterOperator.Contains, sQuery),                                                                                                                                                                                                    
					new Filter("Logdat", FilterOperator.Contains, sQuery),                                                                                                                                                                                                    
					new Filter("Message", FilterOperator.Contains, sQuery)                                                                                                                                                                                                    
					// new Filter("target", FilterOperator.Contains, sQuery),                                                                                                                                                                                                 
					// new Filter("description", FilterOperator.Contains, sQuery)                                                                                                                                                                                             
				]                                                                                                                                                                                                                                                          
			})];                                                                                                                                                                                                                                                        
			var oTable = this.getView().byId("targetTab");                                                                                                                                                                                                              
			oTable.getBinding("items").filter(aTableSearchState, "Application");                                                                                                                                                                                        
			// }                                                                                                                                                                                                                                                        
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		getTabdetails: function () {                                                                                                                                                                                                                                 
			// var dateText = sap.ui.getCore().fromDate + " " + "To" + " " + sap.ui.getCore().toDate;                                                                                                                                                                   
			// this.getView().byId("headerDate").setText(dateText);                                                                                                                                                                                                     
            var DateFrom = this.getView().byId("IDatefrom2").getValue();                                                                                                                                                                                       
			if (!DateFrom) {                                                                                                                                                                                                                                            
				DateFrom = null;                                                                                                                                                                                                                                           
			}                                                                                                                                                                                                                                                           
			else{                                                                                                                                                                                                                                                       
				sap.ui.getCore().fromDate2 = DateFrom;                                                                                                                                                                                                                     
			}                                                                                                                                                                                                                                                           
			var DateTo = this.getView().byId("IDateto2").getValue();                                                                                                                                                                                                    
			if (!DateTo) {                                                                                                                                                                                                                                              
				DateTo = null;                                                                                                                                                                                                                                             
			}                                                                                                                                                                                                                                                           
			else{                                                                                                                                                                                                                                                       
				sap.ui.getCore().toDate2 =  DateTo;                                                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
			var oDevid = this.getView().byId("objHead").getNumberUnit();                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
			var oFilter1 = new Filter("Devid", FilterOperator.EQ, oDevid),                                                                                                                                                                                              
				oFilter2 = new Filter("Stdate", FilterOperator.EQ, sap.ui.getCore().fromDate2),                                                                                                                                                                            
				oFilter3 = new Filter("Endate", FilterOperator.EQ, sap.ui.getCore().toDate2),                                                                                                                                                                              
                                                                                                                                                                                                                                                               
				oFilter = new Filter({                                                                                                                                                                                                                                     
					filters: [oFilter1, oFilter2, oFilter3],                                                                                                                                                                                                                  
					and: true                                                                                                                                                                                                                                                 
				});                                                                                                                                                                                                                                                        
			// this.getView().byId("targetTab").getBinding("items").filter(oFilter);                                                                                                                                                                                    
			var that = this;                                                                                                                                                                                                                                            
			that.getView().setBusy(true);                                                                                                                                                                                                                               
			this.getOwnerComponent().getModel().read("/IdocDetailsSet", {                                                                                                                                                                                               
				filters: [oFilter],                                                                                                                                                                                                                                        
				success: function (oData, response) {                                                                                                                                                                                                                      
					var oJSONModel = new JSONModel();                                                                                                                                                                                                                         
					oJSONModel.setData(oData);                                                                                                                                                                                                                                
					sap.ui.getCore().setModel(oJSONModel);                                                                                                                                                                                                                    
					that.getView().setModel(oJSONModel, "idoc");                                                                                                                                                                                                              
					that.getView().setBusy(false);                                                                                                                                                                                                                            
					sap.ui.getCore().refresh = "X";                                                                                                                                                                                                                           
				},                                                                                                                                                                                                                                                         
				error: function (oError) {                                                                                                                                                                                                                                 
					that.getView().setBusy(false);                                                                                                                                                                                                                            
					sap.m.MessageToast.show("No Date For Given Selection");                                                                                                                                                                                                   
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		refreshTarget: function () {                                                                                                                                                                                                                                 
			this.getTabdetails();                                                                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		createColumnConfig: function () {                                                                                                                                                                                                                            
			return [{                                                                                                                                                                                                                                                   
				label: "IDOC",                                                                                                                                                                                                                                             
				property: "Docnum",                                                                                                                                                                                                                                        
				type: EdmType.Number,                                                                                                                                                                                                                                      
				scale: 0                                                                                                                                                                                                                                                   
			}, {                                                                                                                                                                                                                                                        
				label: "Log Date",                                                                                                                                                                                                                                         
				property: "Logdat",                                                                                                                                                                                                                                        
				type: EdmType.String,                                                                                                                                                                                                                                      
				width: "10"                                                                                                                                                                                                                                                
			}, {                                                                                                                                                                                                                                                        
				label: "Error Message",                                                                                                                                                                                                                                    
				property: "Message",                                                                                                                                                                                                                                       
				type: EdmType.String,                                                                                                                                                                                                                                      
				width: "100"                                                                                                                                                                                                                                               
			}];                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		downloadIdocs: function () {                                                                                                                                                                                                                                 
		                                                                                                                                                                                                                                                             
			var aCols, aRpt, oSettings, oSheet;                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
			aCols = this.createColumnConfig();                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			aRpt = this.getView().getModel("idoc").getProperty("/results");                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
			oSettings = {                                                                                                                                                                                                                                               
				workbook: {                                                                                                                                                                                                                                                
					columns: aCols                                                                                                                                                                                                                                            
				},                                                                                                                                                                                                                                                         
				dataSource: aRpt                                                                                                                                                                                                                                           
			};                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			oSheet = new Spreadsheet(oSettings);                                                                                                                                                                                                                        
			oSheet.build()                                                                                                                                                                                                                                              
				.then(function () {                                                                                                                                                                                                                                        
					sap.m.MessageToast.show("Excel download has finished");                                                                                                                                                                                                   
				})                                                                                                                                                                                                                                                         
				.finally(oSheet.destroy);                                                                                                                                                                                                                                  
		}                                                                                                                                                                                                                                                            
	});                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
});                                                                                                                                                                                                                                                            
sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../model/formatter","sap/ui/model/Filter","sap/ui/model/odata/v2/ODataModel","sap/ui/model/FilterOperator","sap/m/Dialog","sap/m/ColumnListItem","sap/m/Label","sap/ui/commons/TextView","sap+
/m/Token"],function(e,t,a,s,i,r,o,l,n,d,u){"use strict";return e.extend("orders.ZSD_ORDERS.controller.Worklist",{onInit:function(){var e,a,s=this.byId("table");var i="/sap/opu/odata/sap/ZSD_ORDRS_SRV/";var r=new sap.ui.model.odata.ODataModel(i,true);sap.+
ui.getCore().setModel(r);this.ControldataEH();this.setDelvDefaultDates();this.setBillDefaultDates();this.setIncompleteDefDates();this.setCreditDefDates();this.getView().setBusy(true);this.oJsonData=new t([],true);this.getView().setModel(this.oJsonData,"D+
sosel");this.getOwnerComponent().getModel().read("/ZSD_ORDRSSet",{success:function(e,t){var a=new sap.ui.model.json.JSONModel;a.setSizeLimit(2e3);a.setData(e);this.getView().setModel(a,"Chartdata");this.getView().setBusy(false)}.bind(this)});this.BillRef+
reshEH();this.CreditRefreshEH();sap.ui.getCore().multiDso=[];this.DELVREFRESHWEH();this.IOREFRESHEH();this.getOwnerComponent().getModel().read("/OrderTypeSet",{success:function(e,t){var a=new sap.ui.model.json.JSONModel;a.setSizeLimit(500);a.setData(e);t+
his.getView().setModel(a,"Otypes")}.bind(this)});this._oInput=this.getView().byId("Iotype");a=s.getBusyIndicatorDelay();this._aTableSearchState=[];e=new t({worklistTableTitle:this.getResourceBundle().getText("worklistTableTitle"),shareOnJamTitle:this.get+
ResourceBundle().getText("worklistTitle"),shareSendEmailSubject:this.getResourceBundle().getText("shareSendEmailWorklistSubject"),shareSendEmailMessage:this.getResourceBundle().getText("shareSendEmailWorklistMessage",[location.href]),tableBusyDelay:0});t+
his.setModel(e,"worklistView");s.attachEventOnce("updateFinished",function(){e.setProperty("/tableBusyDelay",a)});var o=this.getView().byId("idVizFrame5");var l=new sap.viz.ui5.data.FlattenedDataset({dimensions:[{name:"OrderTypes",value:"{Auart}"},{name:+
"Period",value:"{Prodh}"}],measures:[{name:"Billing",value:"{Faksk}"},{name:"Delivery",value:"{Lifsk}"},{name:"Credit",value:"{Cmgst}"},{name:"Price",value:"{Netwr}"}],data:{path:"/ZSD_ORDRSSet"}});o.setDataset(l);o.setVizProperties({title:{text:"Block S+
tatus trend...",visible:"false"},plotArea:{colorPalette:d3.scale.category20().range(),drawingEffect:"glossy"},noData:"Loading.."})},inputDso:"",fragmentDso:null,onHelpRequestDSO:function(e){this.inputDso=e.getSource().getId();if(this.fragmentDso===null){+
this.fragmentDso=new sap.ui.xmlfragment("orders.ZSD_ORDERS.view.FrgmntDELVSO",this);this.fragmentDso.setTitle("Sales Orders with Delv Block");this.getView().addDependent(this.fragmentDso)}this.fragmentDso.open()},cancelDelvSO:function(){this.fragmentDso.+
close()},setDelvDefaultDates:function(){var e=new Date;var t=this.getView().byId("edated");t.setDateValue(e);var a=e;a=a.setDate(a.getDate()-210);this.getView().byId("sdated").setDateValue(new Date(a));var s=new Date;var i=this.getView().byId("edated");i+
.setDateValue(s);var r=sap.ui.core.format.DateFormat.getInstance({pattern:"yyyy-MM-dd"});sap.ui.getCore().sdated=r.format(e);sap.ui.getCore().edated=r.format(s)},setBillDefaultDates:function(){var e=new Date;var t=this.getView().byId("Bedate");t.setDateV+
alue(e);var a=e;a=a.setDate(a.getDate()-180);this.getView().byId("Bsdate").setDateValue(new Date(a));var s=new Date;var i=this.getView().byId("Bedate");i.setDateValue(s);var r=sap.ui.core.format.DateFormat.getInstance({pattern:"yyyy-MM-dd"});sap.ui.getCo+
re().Bsdate=r.format(e);sap.ui.getCore().Bedate=r.format(s)},setIncompleteDefDates:function(){var e=new Date;var t=this.getView().byId("Ioedate");t.setDateValue(e);var a=e;a=a.setDate(a.getDate()-120);this.getView().byId("Iosdate").setDateValue(new Date(+
a));var s=new Date;var i=this.getView().byId("Ioedate");i.setDateValue(s);var r=sap.ui.core.format.DateFormat.getInstance({pattern:"yyyy-MM-dd"});sap.ui.getCore().Iosdate=r.format(e);sap.ui.getCore().Ioedate=r.format(s)},setCreditDefDates:function(){var +
e=new Date;var t=this.getView().byId("Cedate");t.setDateValue(e);var a=e;a=a.setDate(a.getDate()-120);this.getView().byId("Csdate").setDateValue(new Date(a));var s=new Date;var i=this.getView().byId("Cedate");i.setDateValue(s);var r=sap.ui.core.format.Da+
teFormat.getInstance({pattern:"yyyy-MM-dd"});sap.ui.getCore().Iosdate=r.format(e);sap.ui.getCore().Ioedate=r.format(s)},onvalsearch:function(e){var t=e.getSource().getValue();this.inputId=e.getSource().getId();var a;var s;var i;this.oDialog=sap.ui.xmlfra+
gment("orders.ZSD_ORDERS.view.valuehelpsingle",this);a="/OrderTypeSet";s=new sap.m.StandardListItem({title:"{Auart}",description:"{Bezei}"});i=new sap.ui.model.Filter("Auart",sap.ui.model.FilterOperator.EQ,"");this.oDialog.unbindAggregation("items");this+
.oDialog.bindAggregation("items",{path:a,template:s,filters:[i]});this.oDialog.open(t)},handleTableValueHelpConfirm:function(e){var t=e.getParameter("selectedItem");if(t){this.byId(this.inputId).setValue(t.getBindingContext().getObject().Auart);this.read+
Refresh(e)}this.oDialog.destroy()},handleTableValueHelpSearch:function(e){var t=e.getParameter("value");var a=new l("Auart",n.Contains,t);var s=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZSD_ORDRS_SRV/",{json:true,loadMetadataAsync:true});v+
ar i=this.getView().byId("Iotyp").getSelectedItem();sap.ui.getCore().otyp2=i?i.getKey():null;var r={};r.Auart=t;var a=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Auart",sap.ui.model.FilterOperator.EQ,r.Auart)],and:true});s.read("/OrderType+
Set",{filters:[a],success:function(e,t){e.bindRows("items")},error:function(e){sap.m.MessageToast.show("Data Read error ")}})},typechange:function(e){var t=e.getParameter("value");sap.ui.getCore().media=t?t:null},fragment2:null,IitemsEH:function(e){sap.u+
i.getCore().Vbeln=this.getView().getModel("Incomplete").getProperty("Vbeln",e.getSource().getBindingContext("Incomplete"));sap.ui.getCore().Prodh="";this.vbeln=sap.ui.getCore().Vbeln.trimRight();this.Prodh=sap.ui.getCore().Prodh;this.getItemDetails();if(+
this.fragment2===null){this.fragment2=new sap.ui.xmlfragment("orders.ZSD_ORDERS.view.FragmentIncItems",this);this.getView().addDependent(this.fragment2)}this.fragment2.setTitle("Items of"+" "+sap.ui.getCore().Vbeln);this.fragment2.open()},getItemDetails:+
function(){var e=new sap.ui.model.Filter("Vbeln",sap.ui.model.FilterOperator.EQ,this.vbeln);var t=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Vbeln",sap.ui.model.FilterOperator.EQ,this.vbeln),new sap.ui.model.Filter("Prodh",sap.ui.model.Fi+
lterOperator.EQ,this.Prodh)],and:true});var a="/sap/opu/odata/sap/ZSD_ORDRS_SRV/";var s=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZSD_ORDRS_SRV/",{json:true,loadMetadataAsync:true});s.refresh(true);this.getView().setBusy(true);s.read("/Ite+
mINCSet",{filters:[t],success:function(e,t){var a=new sap.ui.model.json.JSONModel;a.refresh(true);a.setData(e);sap.ui.getCore().setModel(a);this.getView().setModel(a,"Iitems");this.getView().setBusy(false);e.bindRows("/Iitems")}.bind(this),error:function+
(e){sap.m.MessageToast.show("Data Read error ")}})},cancelItem:function(){this.fragment2.close()},fragmentIL:null,IitemlistEH:function(e){sap.ui.getCore().Vbeln=this.getView().getModel("Incomplete").getProperty("Vbeln",e.getSource().getBindingContext("In+
complete"));sap.ui.getCore().Prodh="INCL";this.vbeln=sap.ui.getCore().Vbeln.trimRight();this.Prodh=sap.ui.getCore().Prodh;this.getItemDetails();if(this.fragmentIL===null){this.fragmentIL=new sap.ui.xmlfragment("orders.ZSD_ORDERS.view.FragmentIncList",thi+
s);this.getView().addDependent(this.fragmentIL)}this.fragmentIL.setTitle("Incompletion List of Order: "+" "+sap.ui.getCore().Vbeln);this.fragmentIL.open()},cancelItemIL:function(){this.fragmentIL.close()},fragmentd:null,DitemsEH:function(e){sap.ui.getCor+
e().Vbeln=this.getView().getModel("Delivery").getProperty("Vbeln",e.getSource().getBindingContext("Delivery"));this.vbeln=sap.ui.getCore().Vbeln.trimRight();this.getDELVItemDetails();if(this.fragmentd===null){this.fragmentd=new sap.ui.xmlfragment("orders+
.ZSD_ORDERS.view.FragDELVItems",this);this.getView().addDependent(this.fragmentd)}this.fragmentd.setTitle("Items of"+" "+sap.ui.getCore().Vbeln);this.fragmentd.open()},getDELVItemDetails:function(){var e=new sap.ui.model.Filter("Vbeln",sap.ui.model.Filte+
rOperator.EQ,this.vbeln);var t=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Vbeln",sap.ui.model.FilterOperator.EQ,this.vbeln)],and:true});var a="/sap/opu/odata/sap/ZSD_ORDRS_SRV/";var s=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/s+
ap/ZSD_ORDRS_SRV/",{json:true,loadMetadataAsync:true});s.read("/ItemDELVSet",{filters:[t],success:function(e,t){var a=new sap.ui.model.json.JSONModel;a.setData(e);sap.ui.getCore().setModel(a);this.getView().setModel(a,"Ditems");e.bindRows("/Ditems")}.bin+
d(this),error:function(e){sap.m.MessageToast.show("Data Read error ")}})},DcancelItem:function(){this.fragmentd.close()},fragmentb:null,BitemsEH:function(e){sap.ui.getCore().Vbeln=this.getView().getModel("Billing").getProperty("Vbeln",e.getSource().getBi+
ndingContext("Billing"));this.vbeln=sap.ui.getCore().Vbeln.trimRight();this.getBILLItemDetails();if(this.fragmentb===null){this.fragmentb=new sap.ui.xmlfragment("orders.ZSD_ORDERS.view.FragBILLItems",this);this.getView().addDependent(this.fragmentb)}this+
.fragmentb.setTitle("Items of"+" "+sap.ui.getCore().Vbeln);this.fragmentb.open()},getBILLItemDetails:function(){var e=new sap.ui.model.Filter("Vbeln",sap.ui.model.FilterOperator.EQ,this.vbeln);var t=new sap.ui.model.Filter({filters:[new sap.ui.model.Filt+
er("Vbeln",sap.ui.model.FilterOperator.EQ,this.vbeln)],and:true});var a="/sap/opu/odata/sap/ZSD_ORDRS_SRV/";var s=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZSD_ORDRS_SRV/",{json:true,loadMetadataAsync:true});s.read("/ItemBILLSet",{filters:+
[t],success:function(e,t){var a=new sap.ui.model.json.JSONModel;a.setData(e);sap.ui.getCore().setModel(a);this.getView().setModel(a,"Bitems");e.bindRows("/Bitems")}.bind(this),error:function(e){sap.m.MessageToast.show("Data Read error ")}})},BcancelItem:+
function(){this.fragmentb.close()},fragmentc:null,CitemsEH:function(e){sap.ui.getCore().Vbeln=this.getView().getModel("Credit").getProperty("Vbeln",e.getSource().getBindingContext("Credit"));this.vbeln=sap.ui.getCore().Vbeln.trimRight();this.getCreditIte+
mDetails();if(this.fragmentc===null){this.fragmentc=new sap.ui.xmlfragment("orders.ZSD_ORDERS.view.FragCItems",this);this.getView().addDependent(this.fragmentc)}this.fragmentc.setTitle("Items of"+" "+sap.ui.getCore().Vbeln);this.fragmentc.open()},getCred+
itItemDetails:function(){var e=new sap.ui.model.Filter("Vbeln",sap.ui.model.FilterOperator.EQ,this.vbeln);var t=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Vbeln",sap.ui.model.FilterOperator.EQ,this.vbeln)],and:true});var a="/sap/opu/odata+
/sap/ZSD_ORDRS_SRV/";var s=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZSD_ORDRS_SRV/",{json:true,loadMetadataAsync:true});s.read("/ItemCreditSet",{filters:[t],success:function(e,t){var a=new sap.ui.model.json.JSONModel;a.setData(e);sap.ui.g+
etCore().setModel(a);this.getView().setModel(a,"Citems");e.bindRows("/Citems")}.bind(this),error:function(e){sap.m.MessageToast.show("Data Read error ")}})},CcancelItem:function(){this.fragmentc.close()},IOREFRESHEH:function(e){var t=new sap.ui.model.oda+
ta.v2.ODataModel("/sap/opu/odata/sap/ZSD_ORDRS_SRV/",{json:true,loadMetadataAsync:true});var a=[];var s=this.getView().byId("Inctype").getSelectedKeys();for(var i=0;i<s.length;i++){var r=s[i];a.push(new sap.ui.model.Filter("Fdnam",sap.ui.model.FilterOper+
ator.EQ,r))}sap.ui.getCore().multiItype=a;var o=this.getView().byId("Iotyp").getSelectedItem();sap.ui.getCore().otyp2=o?o.getKey():null;var l={};l.Vbeln=sap.ui.getCore().so2;l.Auart=sap.ui.getCore().otyp2;var n=this.getView().byId("Iosdate").getValue();v+
ar d=this.getView().byId("Ioedate").getValue();sap.ui.getCore().bsdate=n;sap.ui.getCore().bedate=d;if(d<n){sap.m.MessageBox.warning("'Date-To'  earlier  than  'Date-From ', Pleasei check! ");return}var u=new sap.ui.model.Filter({filters:[new sap.ui.model+
.Filter("Vbeln",sap.ui.model.FilterOperator.EQ,l.Vbeln),new sap.ui.model.Filter("Auart",sap.ui.model.FilterOperator.EQ,l.Auart),new sap.ui.model.Filter("Stdate",sap.ui.model.FilterOperator.EQ,n),new sap.ui.model.Filter("Endate",sap.ui.model.FilterOperato+
r.EQ,d)],and:true});u=u.aFilters.concat(a);t.read("/IncompleteSet",{filters:[u],success:function(e,t){var a=new sap.ui.model.json.JSONModel;a.setData(e);sap.ui.getCore().setModel(a);this.getView().setModel(a,"Incomplete");var s=this.getView().byId("Tab2"+
);s.setCount(e.results.length);e.bindRows("/Incomplete")}.bind(this),error:function(e){sap.m.MessageToast.show("Data Read error ")}})},DsoEH:function(e){var t=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZSD_ORDRS_SRV/",{json:true,loadMetadat+
aAsync:true});var a=this.getView().byId("Dso").getSelectedItem();sap.ui.getCore().so2=a?a.getKey():null;var s=this.getView().byId("Dotyp").getSelectedItem();sap.ui.getCore().otyp2=s?s.getKey():null;var i={};i.Vbeln=sap.ui.getCore().so2;i.Auart=sap.ui.get+
Core().otyp2;var r=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Vbeln",sap.ui.model.FilterOperator.EQ,i.Vbeln),new sap.ui.model.Filter("Auart",sap.ui.model.FilterOperator.EQ,i.Auart)],and:true});t.read("/DeliveryBlockSet",{filters:[r],succe+
ss:function(e,t){var a=new sap.ui.model.json.JSONModel;a.setData(e);sap.ui.getCore().setModel(a);this.getView().setModel(a,"Delivery");e.bindRows("/Delivery")}.bind(this),error:function(e){sap.m.MessageToast.show("Data Read error ")}})},CsoEH:function(e)+
{var t=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZSD_ORDRS_SRV/",{json:true,loadMetadataAsync:true});var a=this.getView().byId("cso").getSelectedItem();sap.ui.getCore().so2=a?a.getKey():null;var s=this.getView().byId("cotyp").getSelectedIt+
em();sap.ui.getCore().otyp2=s?s.getKey():null;var i={};i.Vbeln=sap.ui.getCore().so2;i.Auart=sap.ui.getCore().otyp2;var r=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Vbeln",sap.ui.model.FilterOperator.EQ,i.Vbeln),new sap.ui.model.Filter("Au+
art",sap.ui.model.FilterOperator.EQ,i.Auart)],and:true});t.read("/CreditSet",{filters:[r],success:function(e,t){var a=new sap.ui.model.json.JSONModel;a.setData(e);sap.ui.getCore().setModel(a);this.getView().setModel(a,"Credit");e.bindRows("/Credit")}.bin+
d(this),error:function(e){sap.m.MessageToast.show("Data Read error ")}})},BILLGEH:function(){var e={};e.billt1=this.getView().byId("billt1").getSelected();e.delvt1=this.getView().byId("delvt1").getSelected();e.overt1=this.getView().byId("overt1").getSele+
cted();e.credt1=this.getView().byId("credt1").getSelected();e.incot1=this.getView().byId("incot1").getSelected();e.sele1=this.getView().byId("selblock").getSelectedItem().getKey();var t=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Faksk",sa+
p.ui.model.FilterOperator.EQ,e.billt1),new sap.ui.model.Filter("Lifsk",sap.ui.model.FilterOperator.EQ,e.delvt1),new sap.ui.model.Filter("Gbsta",sap.ui.model.FilterOperator.EQ,e.overt1),new sap.ui.model.Filter("Cmgst",sap.ui.model.FilterOperator.EQ,e.cred+
t1),new sap.ui.model.Filter("Huvall",sap.ui.model.FilterOperator.EQ,e.incot1),new sap.ui.model.Filter("Blocktype",sap.ui.model.FilterOperator.EQ,e.sele1)],and:true});var a=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZSD_ORDRS_SRV/",{json:tru+
e,loadMetadataAsync:true});var s=this.getView().getModel();var i=new sap.ui.model.json.JSONModel;a.read("/ZSD_ORDRSSet",{filters:[t],success:function(e,t){var a=new sap.ui.model.json.JSONModel;a.setData(e);sap.ui.getCore().setModel(a);this.getView().setM+
odel(a,"Chartdata");e.bindRows("/Chartdata")}.bind(this),error:function(e){sap.m.MessageToast.show("Data Read error ")}})},UnblockBBWEH:function(e){var t=this.getView().byId("bill");var a=t.getModel();var s=a.getData();var i=[];sap.ui.getCore().cItem=[];+
sap.ui.getCore().cReq=[];var r=[];var o;var l=this.getView().byId("bill");var n=l.getSelectedIndices();var d=this.getView().getModel("Billing");var u={};if(n.length==0){sap.m.MessageToast.show("Please select Order to Release ");return}for(var g=0;g<n.len+
gth;g++){var p=this.getView().byId("bill").getContextByIndex(n[g]).getProperty().Vbeln;u.Vbeln=p;var m=this.getView().byId("bill").getContextByIndex(n[g]).getProperty().Posnr;u.Posnr=m;var h=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Vbel+
n",sap.ui.model.FilterOperator.EQ,u.Vbeln,"REL"),new sap.ui.model.Filter("Posnr",sap.ui.model.FilterOperator.EQ,u.Posnr),new sap.ui.model.Filter("Faksk",sap.ui.model.FilterOperator.EQ,"REL")],and:true});var c=new sap.ui.model.odata.v2.ODataModel("/sap/op+
u/odata/sap/ZSD_ORDRS_SRV/",{json:true,loadMetadataAsync:true});var w=this.getView().getModel();var v=new sap.ui.model.json.JSONModel;c.read("/BillingBlockSet",{filters:[h],success:function(e,t){var a=new sap.ui.model.json.JSONModel;a.setData(e);sap.ui.g+
etCore().setModel(a);this.getView().setModel(a,"Billing");sap.m.MessageToast.show("Order Billing Block Released Successfully");e.bindRows("/Billing")}.bind(this),error:function(e){sap.m.MessageToast.show("Error in Release Billing Block")}})}sap.ui.getCor+
e().items=null},UnblockCBWEH:function(e){var t=this.getView().byId("credit");var a=t.getModel();var s=a.getData();var i=t.getSelectedContexts();sap.m.MessageToast.show(i.length+" "+"row(s) selected.");var r=[];sap.ui.getCore().cItem=[];sap.ui.getCore().c+
Req=[];var o=[];var l=this.getView().byId("credit");var n=l.getSelectedContextPaths();var d=this.getView().getModel("Credit");var u={};var g=[];if(n.length==0){sap.m.MessageToast.show("Please select record to process1 ");return}for(var p=0;p<n.length;p+++
){var m=d.getProperty(n[p]).Vbeln;u.Vbeln=m;var h=d.getProperty(n[p]).Posnr;u.Posnr=h;var c=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Vbeln",sap.ui.model.FilterOperator.EQ,u.Vbeln,"REL"),new sap.ui.model.Filter("Posnr",sap.ui.model.Filte+
rOperator.EQ,u.Posnr),new sap.ui.model.Filter("Cmgst",sap.ui.model.FilterOperator.EQ,"REL")],and:true});var w=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZSD_ORDRS_SRV/",{json:true,loadMetadataAsync:true});w.read("/CreditSet",{filters:[c],su+
ccess:function(e,t){var a=new sap.ui.model.json.JSONModel;a.setData(e);sap.ui.getCore().setModel(a);this.getView().setModel(a,"Credit");sap.m.MessageToast.show("Order Credit Block Released Successfully");e.bindRows("/Credit")}.bind(this),error:function(e+
){sap.m.MessageToast.show("Error in Release Credit Block")}})}},fragmentDI:null,UpdateDLWEH:function(e){this.btnSource=e.getSource();var a=this.getView().byId("delv");var s=a.getSelectedIndices();sap.ui.getCore().count=s.length;var i=[];var r={};var o,l;+
this.ebtnSourc=e.getSource();if(s.length==0){sap.m.MessageToast.show("Please select Order to Release ");return}for(var n=0;n<s.length;n++){o=this.getView().byId("delv").getContextByIndex(s[n]).getProperty().Vbeln;r.Vbeln=o;r.Message="";l=this.getView().b+
yId("delv").getContextByIndex(s[n]).getProperty().Posnr;i.push({Vbeln:o,Posnr:l});r.NP_VBELN=i}var d=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZSD_ORDRS_SRV/");var u=this;d.create("/DelvHeadSet",r,{success:function(e,a){u.getView().setBusy+
(false);var s=new t;s.setData(e);u.getView().setModel(s,"Dmsg");sap.ui.getCore().setModel(s);if(u.fragmentDI===null){u.fragmentDI=new sap.ui.xmlfragment("orders.ZSD_ORDERS.view.FrgmntDELVERR",u);u.getView().addDependent(u.fragmentDI)}u.fragmentDI.setTitl+
e("Delivery block Release status");u.fragmentDI.open();u.DELVREFRESHWEH()},error:function(e){sap.m.MessageBox.error("Error in Delivery Block release");u.getView().setBusy(false)}})},cancelItemDI:function(){this.fragmentDI.close()},_getMessagePopover:func+
tion(){if(!this._oMessagePopover){this._oMessagePopover=sap.ui.xmlfragment(this.getView().getId(),"com.bso.Fragment.messagePopover",this);this.getView().addDependent(this._oMessagePopover)}return this._oMessagePopover},DELVREFRESHWEH:function(e){var t=th+
is.getView().byId("delv");sap.ui.getCore().cItem=[];sap.ui.getCore().cReq=[];var a={};var s=0;var i=0;a.Vbeln=s;var r=this.getView().byId("Dotyp").getSelectedItem();sap.ui.getCore().otyp2=r?r.getKey():null;var o=this.getView().byId("sdated").getValue();v+
ar l=this.getView().byId("edated").getValue();sap.ui.getCore().bsdate=o;sap.ui.getCore().bedate=l;if(l<o){sap.m.MessageBox.warning("'Date-To'  earlier  than  'Date-From ', Please5 check! ");return}a.Posnr=i;var n=new sap.ui.model.Filter({filters:[new sap+
.ui.model.Filter("Vbeln",sap.ui.model.FilterOperator.EQ,a.Vbeln),new sap.ui.model.Filter("Posnr",sap.ui.model.FilterOperator.EQ,a.Posnr),new sap.ui.model.Filter("Lifsk",sap.ui.model.FilterOperator.EQ,"RF"),new sap.ui.model.Filter("Auart",sap.ui.model.Fil+
terOperator.EQ,sap.ui.getCore().otyp2),new sap.ui.model.Filter("Stdate",sap.ui.model.FilterOperator.EQ,o),new sap.ui.model.Filter("Endate",sap.ui.model.FilterOperator.EQ,l)],and:true});var d=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZSD_OR+
DRS_SRV/",{json:true,loadMetadataAsync:true});var u=[];var g=this.getView().byId("Dso").getTokens();for(var p=0;p<g.length;p++){var m=g[p].getText();u.push(new sap.ui.model.Filter("Kunnr",sap.ui.model.FilterOperator.EQ,m))}sap.ui.getCore().multiItype=u;n+
=n.aFilters.concat(u);d.read("/DeliveryBlockSet",{filters:[n],success:function(e,t){var a=new sap.ui.model.json.JSONModel;a.setData(e);sap.ui.getCore().setModel(a);this.getView().setModel(a,"Delivery");var s=this.getView().byId("Tab3");s.setCount(e.resul+
ts.length);e.bindRows("/Delivery")}.bind(this),error:function(e){sap.m.MessageToast.show("Error in Page refresh")}});this.getView().byId("Dso").removeAllTokens();this.getView().getModel("Dsosel").setData([])},CreditRefreshEH:function(e){var t=this.getVie+
w().byId("credit");sap.ui.getCore().cItem=[];sap.ui.getCore().cReq=[];var a={};var s=0;var i=0;a.Vbeln=s;var r=this.getView().byId("cotyp").getSelectedItem();sap.ui.getCore().otyp2=r?r.getKey():null;var o=this.getView().byId("Csdate").getValue();var l=th+
is.getView().byId("Cedate").getValue();sap.ui.getCore().csdate=o;sap.ui.getCore().cedate=l;if(l<o){sap.m.MessageBox.warning("'Date-To'  earlier  than  'Date-From ', Please7 check! ");return}a.Posnr=i;var n=new sap.ui.model.Filter({filters:[new sap.ui.mod+
el.Filter("Vbeln",sap.ui.model.FilterOperator.EQ,a.Vbeln),new sap.ui.model.Filter("Posnr",sap.ui.model.FilterOperator.EQ,a.Posnr),new sap.ui.model.Filter("Cmgst",sap.ui.model.FilterOperator.EQ,"RF"),new sap.ui.model.Filter("Auart",sap.ui.model.FilterOper+
ator.EQ,sap.ui.getCore().otyp2),new sap.ui.model.Filter("Stdate",sap.ui.model.FilterOperator.EQ,o),new sap.ui.model.Filter("Endate",sap.ui.model.FilterOperator.EQ,l)],and:true});var d=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZSD_ORDRS_SRV+
/",{json:true,loadMetadataAsync:true});d.read("/CreditSet",{filters:[n],success:function(e,t){var a=new sap.ui.model.json.JSONModel;a.setData(e);sap.ui.getCore().setModel(a);this.getView().setModel(a,"Credit");var s=this.getView().byId("Tab5");s.setCount+
(e.results.length);e.bindRows("/Credit")}.bind(this),error:function(e){sap.m.MessageToast.show("Error in Data refresh")}})},fragmentBI:null,UpdateBBWEH:function(e){this.btnSourceb=e.getSource();var a;var s=this.getView().byId("bill");var i=s.getSelectedI+
ndices();var r=this.getView().getModel("Billing");sap.ui.getCore().count=i.length;var o=[];var l={};var n,d;this.ebtnSourc=e.getSource();if(i.length==0){sap.m.MessageToast.show("Please select Order to Release ");return}for(var u=0;u<i.length;u++){n=this.+
getView().byId("bill").getContextByIndex(i[u]).getProperty().Vbeln;l.Vbeln=n;l.Message="";d=this.getView().byId("bill").getContextByIndex(i[u]).getProperty().Posnr;o.push({Vbeln:n,Posnr:d});l.NP_VBELN=o}var g=new sap.ui.model.odata.v2.ODataModel("/sap/op+
u/odata/sap/ZSD_ORDRS_SRV/");var p=this;g.create("/BillHeadSet",l,{success:function(e,a){p.getView().setBusy(false);var s=new t;s.setData(e);p.getView().setModel(s,"Bmsg");sap.ui.getCore().setModel(s);if(p.fragmentBI===null){p.fragmentBI=new sap.ui.xmlfr+
agment("orders.ZSD_ORDERS.view.FrgmntBILLERR",p);p.getView().addDependent(p.fragmentBI)}p.fragmentBI.setTitle("Billing block Release status");p.fragmentBI.open();p.BillRefreshEH()},error:function(e){sap.m.MessageBox.error("Error in Billing Block release"+
);p.getView().setBusy(false)}})},cancelItemBI:function(){this.fragmentBI.close()},BillRefreshEH:function(e){var t=this.getView().byId("bill");var a={};var s=0;var i=0;a.Vbeln=s;var r=this.getView().byId("Botyp").getSelectedItem();sap.ui.getCore().otypb2=+
r?r.getKey():null;var o=this.getView().byId("Bsdate").getValue();var l=this.getView().byId("Bedate").getValue();sap.ui.getCore().bsdate=o;sap.ui.getCore().bedate=l;if(l<o){sap.m.MessageBox.warning("'Date-To'  earlier  than  'Date-From ', Please9 check! "+
);return}a.Posnr=i;var n=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Vbeln",sap.ui.model.FilterOperator.EQ,a.Vbeln),new sap.ui.model.Filter("Posnr",sap.ui.model.FilterOperator.EQ,a.Posnr),new sap.ui.model.Filter("Faksk",sap.ui.model.Filter+
Operator.EQ,"RF"),new sap.ui.model.Filter("Auart",sap.ui.model.FilterOperator.EQ,sap.ui.getCore().otypb2),new sap.ui.model.Filter("Stdate",sap.ui.model.FilterOperator.EQ,o),new sap.ui.model.Filter("Endate",sap.ui.model.FilterOperator.EQ,l)],and:true});va+
r d=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZSD_ORDRS_SRV/",{json:true,loadMetadataAsync:true});d.read("/BillingBlockSet",{filters:[n],success:function(e,t){var a=new sap.ui.model.json.JSONModel;a.setData(e);sap.ui.getCore().setModel(a);+
this.getView().setModel(a,"Billing");var s=this.getView().byId("Tab4");s.setCount(e.results.length);e.bindRows("/Billing")}.bind(this),error:function(e){sap.m.MessageToast.show("Error in Billing data refresh")}})},UpdateCBWEH:function(e){var t=this.getVi+
ew().byId("credit");var a=t.getSelectedIndices();var s={};if(a.length==0){sap.m.MessageToast.show("Please select Order to Release ");return}for(var i=0;i<a.length;i++){var r=this.getView().byId("credit").getContextByIndex(a[i]).getProperty().Vbeln;s.Vbel+
n=r;var o=this.getView().byId("credit").getContextByIndex(a[i]).getProperty().Posnr;s.Posnr=o;var l=this.getView().getModel().createKey("/CreditSet",{Vbeln:s.Vbeln});var n=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZSD_ORDRS_SRV/");var d=th+
is;n.update(l,s,{success:function(e,t){sap.m.MessageBox.show(+s.Vbeln+" : "+"Credit block released successfully");d.CreditRefreshEH()},error:function(e){sap.m.MessageBox.error("Failed to release Credit Block Block")}})}},rowSelectionDso:function(e){if(e.+
getParameter("listItems").length>1&&e.getParameter("selected")===true){for(var t=0;t<e.getParameter("listItems").length;t++){var a=e.getParameter("listItems")[t].getBindingContext().getProperty("Kunnr");this.getView().getModel("Dsosel").getData().push({K+
unnr:a});this.getView().getModel("Dsosel").updateBindings(true)}}else{var s=e.getParameter("listItem").getBindingContext().getProperty("Kunnr");if(e.getParameter("listItem").getProperty("selected")===true){this.getView().getModel("Dsosel").getData().push+
({Kunnr:s});this.getView().getModel("Dsosel").updateBindings(true)}else{this.getView().getModel("Dsosel").getData().pop({Kunnr:s});this.getView().getModel("Dsosel").updateBindings(true)}}if(e.getParameter("listItems").length>1&&e.getParameter("selected")+
===false){this.getView().getModel("Dsosel").setData([])}},acceptDelvSO:function(e){this.getView().byId("Dso").removeAllTokens();var t=[];var a=sap.ui.getCore().byId("DSOselTable");var s=a.getItems();if(s.length>0){for(var i=0;i<s.length;i++){var r=s[i].g+
etBindingContext("Dsosel").getProperty("Kunnr");var o=new sap.m.Token({text:r});this.getView().byId("Dso").addToken(o);sap.ui.getCore().dso=r;t.push(r)}sap.ui.getCore().multiDso=t;sap.ui.getCore().byId("DelvSOTable").removeSelections(true)}else{sap.ui.ge+
tCore().dso=null;sap.ui.getCore().multiDso=[]}this.fragmentDso.close()},clearDelvSO:function(){var e=sap.ui.getCore().byId("DelvSOTable");var t=e.getSelectedItems();if(t.length>0){e.removeSelections(true);var a=this.getView().byId("Dso").getTokens();this+
.getView().byId("Dso").destroyTokens([a]);sap.ui.getCore().multiDso=[]}this.getView().getModel("Dsosel").setData([]);var s=sap.ui.getCore().byId("mySearch");s.setValue(null);this.getView().byId("Dso").removeAllTokens()},deleteSelectionDso:function(e){var+
 t=e.getParameter("listItem");var a=sap.ui.getCore().byId("DSOselTable");a.removeItem(t)},DsoChange:function(e){var t=e.getParameter("type");if(t==="removed"){var a=e.getParameter("token").getText();this.getView().getModel("Dsosel").getData().pop({Kunnr:+
a});this.getView().getModel("Dsosel").updateBindings(true);var s=[];var i=this.getView().byId("Kunnr").getTokens();if(i.length>0){for(var r=0;r<i.length;r++){var o=i[r].getProperty("text");s.push(o)}sap.ui.getCore().multiMedia=s}else{sap.ui.getCore().mul+
tiMedia=[];sap.ui.getCore().media=null}this.DELVREFRESHWEH(e)()}},ControldataEH:function(e){sap.ui.getCore().BB="";sap.ui.getCore().DB="";sap.ui.getCore().IC="";sap.ui.getCore().CB="";var t=new sap.ui.model.Filter({filters:[],and:true});var a=new sap.ui.+
model.odata.v2.ODataModel("/sap/opu/odata/sap/ZSD_ORDRS_SRV/",{json:true,loadMetadataAsync:true});var s=this;a.read("/UserAccessSet",{filters:[t],success:function(e,t){var a=new sap.ui.model.json.JSONModel;a.setSizeLimit(e.results.length);a.setData(e);sa+
p.ui.getCore().setModel(a);this.getView().setModel(a,"UAccess");sap.ui.getCore().BB=e.results[0].BillingBlock;sap.ui.getCore().DB=e.results[0].DelvBlock;sap.ui.getCore().IC=e.results[0].IncompleteBlock;if(sap.ui.getCore().BB==="X"){this.getView().byId("T+
ab4").setVisible(true)}else{this.getView().byId("Tab4").setVisible(false)}if(sap.ui.getCore().DB==="X"){this.getView().byId("Tab3").setVisible(true)}else{this.getView().byId("Tab3").setVisible(false)}if(sap.ui.getCore().IC==="X"){this.getView().byId("Tab+
2").setVisible(true)}else{this.getView().byId("Tab2").setVisible(false)}this.getView().byId("Tab1").setVisible(false);this.setBillDefaultDates();this.BillRefreshEH()}.bind(this),error:function(e){sap.m.MessageToast.show("Error in Constant data refresh")}+
})},onUpdateFinished:function(e){var t,a=e.getSource(),s=e.getParameter("total");if(s&&a.getBinding("items").isLengthFinal()){t=this.getResourceBundle().getText("worklistTableTitleCount",[s])}else{t=this.getResourceBundle().getText("worklistTableTitle")}+
this.getModel("worklistView").setProperty("/worklistTableTitle",t)},onPress:function(e){this._showObject(e.getSource())},onNavBack:function(){history.go(-1)},onSearch:function(e){if(e.getParameters().refreshButtonPressed){this.onRefresh()}else{var t=[];v+
ar a=e.getParameter("query");if(a&&a.length>0){t=[new l("Arktx",n.Contains,a)]}this._applySearch(t)}},onRefresh:function(){var e=this.byId("table");e.getBinding("items").refresh()},_showObject:function(e){this.getRouter().navTo("object",{objectId:e.getBi+
ndingContext().getProperty("Vbeln")})},_applySearch:function(e){var t=this.byId("table"),a=this.getModel("worklistView");t.getBinding("items").filter(e,"Application");if(e.length!==0){a.setProperty("/tableNoDataText",this.getResourceBundle().getText("wor+
klistNoDataWithSearchText"))}}})});                                                                                                                                                                                                                            
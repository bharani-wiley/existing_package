sap.ui.define([                                                                                                                                                                                                                                                
	"./BaseController",                                                                                                                                                                                                                                           
	"sap/ui/model/json/JSONModel",                                                                                                                                                                                                                                
	"sap/ui/core/routing/History",                                                                                                                                                                                                                                
	"../model/formatter",                                                                                                                                                                                                                                         
	"sap/ui/model/Filter",                                                                                                                                                                                                                                        
	"sap/ui/model/FilterOperator",                                                                                                                                                                                                                                
	"sap/ui/core/Fragment",                                                                                                                                                                                                                                       
	"sap/m/Token",                                                                                                                                                                                                                                                
	"sap/ui/export/Spreadsheet",                                                                                                                                                                                                                                  
	"sap/ui/export/library",                                                                                                                                                                                                                                      
	"sap/ui/util/Storage"                                                                                                                                                                                                                                         
], function (BaseController, JSONModel, History, formatter, Filter, FilterOperator, Fragment, Token, Spreadsheet, exportLibrary, Storage) {                                                                                                                    
	"use strict";                                                                                                                                                                                                                                                 
	                                                                                                                                                                                                                                                              
	var EdmType = exportLibrary.EdmType;                                                                                                                                                                                                                          
	return BaseController.extend("ir.ZE144_IncompletionReport.controller.Object", {                                                                                                                                                                               
                                                                                                                                                                                                                                                               
		formatter: formatter,                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
		/* =========================================================== */                                                                                                                                                                                            
		/* lifecycle methods                                           */                                                                                                                                                                                            
		/* =========================================================== */                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Called when the worklist controller is instantiated.                                                                                                                                                                                                      
		 * @public                                                                                                                                                                                                                                                   
		 */                                                                                                                                                                                                                                                          
		onInit: function () {                                                                                                                                                                                                                                        
			// Model used to manipulate control states. The chosen values make sure,                                                                                                                                                                                    
			// detail page is busy indication immediately so there is no break in                                                                                                                                                                                       
			// between the busy indication for loading the view's meta data                                                                                                                                                                                             
			var iOriginalBusyDelay,                                                                                                                                                                                                                                     
				oViewModel = new JSONModel({                                                                                                                                                                                                                               
					busy: true,                                                                                                                                                                                                                                               
					delay: 0                                                                                                                                                                                                                                                  
				});                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
			this.getRouter().getRoute("object").attachPatternMatched(this._onObjectMatched, this);                                                                                                                                                                      
                                                                                                                                                                                                                                                               
			// // Store original busy indicator delay, so it can be restored later on                                                                                                                                                                                   
			iOriginalBusyDelay = this.getView().getBusyIndicatorDelay();                                                                                                                                                                                                
			this.setModel(oViewModel, "objectView");                                                                                                                                                                                                                    
			this.getOwnerComponent().getModel().metadataLoaded().then(function () {                                                                                                                                                                                     
				// Restore original busy indicator delay for the object view                                                                                                                                                                                               
				oViewModel.setProperty("/delay", iOriginalBusyDelay);                                                                                                                                                                                                      
			});                                                                                                                                                                                                                                                         
			// this._incompletionLogCall();                                                                                                                                                                                                                             
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/* =========================================================== */                                                                                                                                                                                            
		/* event handlers                                              */                                                                                                                                                                                            
		/* =========================================================== */                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Event handler  for navigating back.                                                                                                                                                                                                                       
		 * It there is a history entry we go one step back in the browser history                                                                                                                                                                                    
		 * If not, it will replace the current entry of the browser history with the worklist route.                                                                                                                                                                 
		 * @public                                                                                                                                                                                                                                                   
		 */                                                                                                                                                                                                                                                          
		onNavBack: function () {                                                                                                                                                                                                                                     
			var sPreviousHash = History.getInstance().getPreviousHash();                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
			if (sPreviousHash !== undefined) {                                                                                                                                                                                                                          
				history.go(-1);                                                                                                                                                                                                                                            
			} else {                                                                                                                                                                                                                                                    
				this.getRouter().navTo("worklist", {}, true);                                                                                                                                                                                                              
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onExcelDownlaod: function () {                                                                                                                                                                                                                               
			var oTable = this.getView().byId("tblIncompReport");                                                                                                                                                                                                        
			var oMap = oTable.getBinding("rows").getContexts().map(function (a) {                                                                                                                                                                                       
				return a.getObject();                                                                                                                                                                                                                                      
			});                                                                                                                                                                                                                                                         
			var oTblCloums = oTable.getColumns();                                                                                                                                                                                                                       
			var aColumns = [];                                                                                                                                                                                                                                          
			oTblCloums.forEach(function (obj) {                                                                                                                                                                                                                         
				var objText = obj.getAggregation("label").getText();                                                                                                                                                                                                       
				if (objText !== "Items" && objText !== "Incompleted Items") {                                                                                                                                                                                              
					aColumns.push({                                                                                                                                                                                                                                           
						label: obj.getAggregation("label").getText(),                                                                                                                                                                                                            
						property: obj.getSortProperty()                                                                                                                                                                                                                          
					});                                                                                                                                                                                                                                                       
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
			var mSettings = {                                                                                                                                                                                                                                           
				workbook: {                                                                                                                                                                                                                                                
					columns: aColumns                                                                                                                                                                                                                                         
				},                                                                                                                                                                                                                                                         
				dataSource: oMap,                                                                                                                                                                                                                                          
				fileName: "IncompleteOrders.xlsx"                                                                                                                                                                                                                          
			};                                                                                                                                                                                                                                                          
			var oSpreadsheet = new sap.ui.export.Spreadsheet(mSettings);                                                                                                                                                                                                
			oSpreadsheet.build();                                                                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//Search bar                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
		filterGlobally: function (oEvent) {                                                                                                                                                                                                                          
			var sQuery = oEvent.getParameter("query");                                                                                                                                                                                                                  
			var oTitle = this.getView().byId("tbltitle");                                                                                                                                                                                                               
			this._oGlobalFilter = null;                                                                                                                                                                                                                                 
			var oFilterValues = ["VBELN", "SMODEL", "BSTNK", "AUART", "PSTAT", "VKORG", "VKBUR", "KUNNR", "NAME", "AUGRU", "ZMENG", "MWSBP",                                                                                                                            
				"NETWR", "WAERK", "VBBK0004", "MVGR5", "ZZVYP", "BSARK", "KDKG2", "KONDA", "FAKSK", "FAKSKT", "LIFSK", "LIFSKT", "GBSTK", "GBSTA",                                                                                                                         
				"ZLSCH", "ZTERM", "ZZSUBTYP", "ERDAT", "ERNAM", "AGADDR", "AGEMAIL", "AGSTREET", "AGCITY", "AGSTATE", "AGPOSTAL", "AGCOUNTRY",                                                                                                                             
				"WEBP", "WENAME", "WEEMAIL", "WESTREET", "WECITY", "WESTATE", "WEPOSTAL", "WECOUNTRY", "ZABP", "ZANAME", "MODEL", "FDNAM"                                                                                                                                  
			];                                                                                                                                                                                                                                                          
			if (sQuery) {                                                                                                                                                                                                                                               
				var oMapFilter = oFilterValues.map(function (val) {                                                                                                                                                                                                        
					return new Filter(val, FilterOperator.Contains, sQuery);                                                                                                                                                                                                  
				});                                                                                                                                                                                                                                                        
				this._oGlobalFilter = new Filter(oMapFilter, false);                                                                                                                                                                                                       
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			this.getView().byId("tblIncompReport").getBinding().filter(this._oGlobalFilter, "Application");                                                                                                                                                             
			var currentLength = this.getView().byId("tblIncompReport").getBinding().iLength;                                                                                                                                                                            
			oTitle.setText("Incompletion Orders " + "(" + currentLength + ")");                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onGO: function (oEvent) {                                                                                                                                                                                                                                    
			var oIncompLog = this.getView().byId("idMIIncompLog");                                                                                                                                                                                                      
			var oTokens = oIncompLog.getTokens();                                                                                                                                                                                                                       
			if (oTokens.length) {                                                                                                                                                                                                                                       
				var oFilter = this._addCreateFilters();                                                                                                                                                                                                                    
				var tokemMapFilters = oTokens.map(function (obj) {                                                                                                                                                                                                         
					return new Filter("FDNAM", FilterOperator.EQ, obj.getKey());                                                                                                                                                                                              
				});                                                                                                                                                                                                                                                        
				var tokenFilter = new Filter(tokemMapFilters);                                                                                                                                                                                                             
				oFilter.push(tokenFilter);                                                                                                                                                                                                                                 
				this.getView().getModel().read("/HeaderSet", {                                                                                                                                                                                                             
					filters: oFilter,                                                                                                                                                                                                                                         
					success: function (data, sResponse) {                                                                                                                                                                                                                     
						this.getView().getModel("tableModel").setData(data.results);                                                                                                                                                                                             
					}.bind(this),                                                                                                                                                                                                                                             
					error: function (eResponse) {}                                                                                                                                                                                                                            
				});                                                                                                                                                                                                                                                        
			} else {                                                                                                                                                                                                                                                    
				this.getView().getModel().read("/HeaderSet", {                                                                                                                                                                                                             
					filters: this._addCreateFilters(),                                                                                                                                                                                                                        
					success: function (data, sResponse) {                                                                                                                                                                                                                     
						this.getView().getModel("tableModel").setData(data.results);                                                                                                                                                                                             
					}.bind(this),                                                                                                                                                                                                                                             
					error: function (eResponse) {}                                                                                                                                                                                                                            
				});                                                                                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onShowItems: function (oEvent, isComp) {                                                                                                                                                                                                                     
			this.oBtnSrc = oEvent.getSource();                                                                                                                                                                                                                          
			var that = this;                                                                                                                                                                                                                                            
			that.getView().setBusy(true);                                                                                                                                                                                                                               
			// var oViewModel = this.getView().getModel("oViewModel");                                                                                                                                                                                                  
			var nFilter;                                                                                                                                                                                                                                                
			var oView = this.getView();                                                                                                                                                                                                                                 
			var oDataModel = this.getView().getModel();                                                                                                                                                                                                                 
			// oViewModel.setProperty("/busy", true);                                                                                                                                                                                                                   
			this.oVBELN = oEvent.getSource().getBindingContext("tableModel").getProperty("VBELN");                                                                                                                                                                      
			var oFilter = new Filter("VBELN", FilterOperator.EQ, this.oVBELN);                                                                                                                                                                                          
			if (isComp === "C") {                                                                                                                                                                                                                                       
				nFilter = new Filter([oFilter, new Filter("VAR", FilterOperator.EQ, isComp)], true);                                                                                                                                                                       
			} else {                                                                                                                                                                                                                                                    
				nFilter = new Filter([oFilter, new Filter("VAR", FilterOperator.EQ, isComp)], true);                                                                                                                                                                       
			}                                                                                                                                                                                                                                                           
			var oPromise = new Promise(function (res, rej) {                                                                                                                                                                                                            
				oDataModel.read("/ItemsSet", {                                                                                                                                                                                                                             
					filters: [nFilter],                                                                                                                                                                                                                                       
					success: function (data, sResponse) {                                                                                                                                                                                                                     
						that.getView().getModel("objectView").setProperty("/showItems", data.results);                                                                                                                                                                           
						res();                                                                                                                                                                                                                                                   
					}.bind(that),                                                                                                                                                                                                                                             
					error: function (eResponse) {                                                                                                                                                                                                                             
						rej();                                                                                                                                                                                                                                                   
					}                                                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
			});                                                                                                                                                                                                                                                         
			oPromise.then(function (val) {                                                                                                                                                                                                                              
				if (!that._pDialog) {                                                                                                                                                                                                                                      
					that._pDialog = Fragment.load({                                                                                                                                                                                                                           
						id: oView.getId(),                                                                                                                                                                                                                                       
						name: "ir.ZE144_IncompletionReport.Fragment.tableSelect",                                                                                                                                                                                                
						controller: that                                                                                                                                                                                                                                         
					}).then(function (oDialog) {                                                                                                                                                                                                                              
						oView.addDependent(oDialog);                                                                                                                                                                                                                             
						return oDialog;                                                                                                                                                                                                                                          
					});                                                                                                                                                                                                                                                       
				}                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
				that._pDialog.then(function (oDialog) {                                                                                                                                                                                                                    
					that.getView().setBusy(false);                                                                                                                                                                                                                            
					oDialog.open();                                                                                                                                                                                                                                           
				}.bind(that));                                                                                                                                                                                                                                             
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onCheckBoxSelect: function (oEvent) {                                                                                                                                                                                                                        
			var oDataModel = this.getView().getModel();                                                                                                                                                                                                                 
			var isSelected = oEvent.getParameter("selected");                                                                                                                                                                                                           
			// var Order = this.getView().getModel("objectView").getProperty("/showItems")[0].VBELN;                                                                                                                                                                    
			var oFilter = new Filter("VBELN", FilterOperator.EQ, this.oVBELN);                                                                                                                                                                                          
			var nFilter;                                                                                                                                                                                                                                                
			if (isSelected) {                                                                                                                                                                                                                                           
				nFilter = new Filter([oFilter, new Filter("VAR", FilterOperator.BT, this.oBtnSrc.getCustomData()[0].getKey(), "R")], true);                                                                                                                                
			} else {                                                                                                                                                                                                                                                    
				nFilter = new Filter([oFilter, new Filter("VAR", FilterOperator.EQ, this.oBtnSrc.getCustomData()[0].getKey())], true);                                                                                                                                     
			}                                                                                                                                                                                                                                                           
			oDataModel.read("/ItemsSet", {                                                                                                                                                                                                                              
				filters: [nFilter],                                                                                                                                                                                                                                        
				success: function (data, sResponse) {                                                                                                                                                                                                                      
					this.getView().getModel("objectView").setProperty("/showItems", data.results);                                                                                                                                                                            
				}.bind(this),                                                                                                                                                                                                                                              
				error: function (eResponse) {}                                                                                                                                                                                                                             
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onClosetblItems: function () {                                                                                                                                                                                                                               
			this.getView().byId("chktableSelect").setSelected(false);                                                                                                                                                                                                   
			this._pDialog.then(function (oDialog) {                                                                                                                                                                                                                     
				oDialog.close();                                                                                                                                                                                                                                           
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onRefreshTable: function () {                                                                                                                                                                                                                                
			this.getView().getModel().read("/HeaderSet", {                                                                                                                                                                                                              
				filters: this._addCreateFilters(),                                                                                                                                                                                                                         
				success: function (data, sResponse) {                                                                                                                                                                                                                      
					this.getView().getModel("tableModel").setData(data.results);                                                                                                                                                                                              
				}.bind(this),                                                                                                                                                                                                                                              
				error: function (eResponse) {}                                                                                                                                                                                                                             
			});                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//F4 Help                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
		handleIncomLog: function (oEvt) {                                                                                                                                                                                                                            
			this._incompletionLogCall();                                                                                                                                                                                                                                
			var oView = this.getView();                                                                                                                                                                                                                                 
			// create value help dialog                                                                                                                                                                                                                                 
			if (!this._pValueHelpDialog) {                                                                                                                                                                                                                              
				this._pValueHelpDialog = Fragment.load({                                                                                                                                                                                                                   
					id: oView.getId(),                                                                                                                                                                                                                                        
					name: "ir.ZE144_IncompletionReport.Fragment.incompletionlog",                                                                                                                                                                                             
					controller: this                                                                                                                                                                                                                                          
				}).then(function (oValueHelpDialog) {                                                                                                                                                                                                                      
					oView.addDependent(oValueHelpDialog);                                                                                                                                                                                                                     
					return oValueHelpDialog;                                                                                                                                                                                                                                  
				});                                                                                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			this._pValueHelpDialog.then(function (oValueHelpDialog) {                                                                                                                                                                                                   
				oValueHelpDialog.open();                                                                                                                                                                                                                                   
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_handleValueHelpSearch: function (evt) {                                                                                                                                                                                                                     
			var sValue = evt.getParameter("value");                                                                                                                                                                                                                     
			var oFilter = new Filter(                                                                                                                                                                                                                                   
				"DESC",                                                                                                                                                                                                                                                    
				FilterOperator.Contains,                                                                                                                                                                                                                                   
				sValue                                                                                                                                                                                                                                                     
			);                                                                                                                                                                                                                                                          
			evt.getSource().getBinding("items").filter([oFilter]);                                                                                                                                                                                                      
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_handleValueHelpClose: function (evt) {                                                                                                                                                                                                                      
			var aSelectedItems = evt.getParameter("selectedItems"),                                                                                                                                                                                                     
				oMultiInput = this.getView().byId("idMIIncompLog");                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
			if (aSelectedItems && aSelectedItems.length > 0) {                                                                                                                                                                                                          
				aSelectedItems.forEach(function (oItem) {                                                                                                                                                                                                                  
					oMultiInput.addToken(new Token({                                                                                                                                                                                                                          
						text: oItem.getTitle(),                                                                                                                                                                                                                                  
						key: oItem.getCustomData()[0].getKey()                                                                                                                                                                                                                   
					}));                                                                                                                                                                                                                                                      
				});                                                                                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//Customer F4 Help                                                                                                                                                                                                                                           
		onSoldtoPartyPress: function (oEvent, par) {                                                                                                                                                                                                                 
			this.openQuickView(oEvent, par);                                                                                                                                                                                                                            
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		openQuickView: function (oEvent, par) {                                                                                                                                                                                                                      
			var oModel = this.getView().getModel("quickView");                                                                                                                                                                                                          
			var oButton = oEvent.getSource(),                                                                                                                                                                                                                           
				oView = this.getView();                                                                                                                                                                                                                                    
			var oCurrentObject = oButton.getBindingContext("tableModel").getObject();                                                                                                                                                                                   
			var data;                                                                                                                                                                                                                                                   
			if (par === "so") {                                                                                                                                                                                                                                         
				data = {                                                                                                                                                                                                                                                   
					"pages": [{                                                                                                                                                                                                                                               
						"pageId": "genericPageId",                                                                                                                                                                                                                               
						"header": "Sold to Party",                                                                                                                                                                                                                               
						"title": "Sold to Party",                                                                                                                                                                                                                                
						"groups": [{                                                                                                                                                                                                                                             
							"elements": [{                                                                                                                                                                                                                                          
								"label": "Address",                                                                                                                                                                                                                                    
								"value": oCurrentObject.AGSTREET                                                                                                                                                                                                                       
							}, {                                                                                                                                                                                                                                                    
								"label": "City",                                                                                                                                                                                                                                       
								"value": oCurrentObject.AGCITY                                                                                                                                                                                                                         
							}, {                                                                                                                                                                                                                                                    
								"label": "Country",                                                                                                                                                                                                                                    
								"value": oCurrentObject.AGCOUNTRY                                                                                                                                                                                                                      
							}, {                                                                                                                                                                                                                                                    
								"label": "Mail",                                                                                                                                                                                                                                       
								"value": oCurrentObject.AGEMAIL                                                                                                                                                                                                                        
							}, {                                                                                                                                                                                                                                                    
								"label": "Postal",                                                                                                                                                                                                                                     
								"value": oCurrentObject.AGPOSTAL                                                                                                                                                                                                                       
							}, {                                                                                                                                                                                                                                                    
								"label": "State",                                                                                                                                                                                                                                      
								"value": oCurrentObject.AGSTATE                                                                                                                                                                                                                        
							}]                                                                                                                                                                                                                                                      
						}]                                                                                                                                                                                                                                                       
					}]                                                                                                                                                                                                                                                        
				};                                                                                                                                                                                                                                                         
			} else {                                                                                                                                                                                                                                                    
				data = {                                                                                                                                                                                                                                                   
					"pages": [{                                                                                                                                                                                                                                               
						"pageId": "genericPageId",                                                                                                                                                                                                                               
						"header": "Ship to Party",                                                                                                                                                                                                                               
						"title": "Ship to Party",                                                                                                                                                                                                                                
						"groups": [{                                                                                                                                                                                                                                             
							"elements": [{                                                                                                                                                                                                                                          
								"label": "Name",                                                                                                                                                                                                                                       
								"value": oCurrentObject.WENAME                                                                                                                                                                                                                         
							}, {                                                                                                                                                                                                                                                    
								"label": "Address",                                                                                                                                                                                                                                    
								"value": oCurrentObject.WESTREET                                                                                                                                                                                                                       
							}, {                                                                                                                                                                                                                                                    
								"label": "City",                                                                                                                                                                                                                                       
								"value": oCurrentObject.WECITY                                                                                                                                                                                                                         
							}, {                                                                                                                                                                                                                                                    
								"label": "Country",                                                                                                                                                                                                                                    
								"value": oCurrentObject.WECOUNTRY                                                                                                                                                                                                                      
							}, {                                                                                                                                                                                                                                                    
								"label": "Mail",                                                                                                                                                                                                                                       
								"value": oCurrentObject.WEEMAIL                                                                                                                                                                                                                        
							}, {                                                                                                                                                                                                                                                    
								"label": "Postal",                                                                                                                                                                                                                                     
								"value": oCurrentObject.WEPOSTAL                                                                                                                                                                                                                       
							}, {                                                                                                                                                                                                                                                    
								"label": "State",                                                                                                                                                                                                                                      
								"value": oCurrentObject.WESTATE                                                                                                                                                                                                                        
							}]                                                                                                                                                                                                                                                      
						}]                                                                                                                                                                                                                                                       
					}]                                                                                                                                                                                                                                                        
				};                                                                                                                                                                                                                                                         
			}                                                                                                                                                                                                                                                           
			oModel.setData(data);                                                                                                                                                                                                                                       
			if (!this._pQuickView) {                                                                                                                                                                                                                                    
				this._pQuickView = Fragment.load({                                                                                                                                                                                                                         
					id: oView.getId(),                                                                                                                                                                                                                                        
					name: "ir.ZE144_IncompletionReport.Fragment.customerQuickView",                                                                                                                                                                                           
					controller: this                                                                                                                                                                                                                                          
				}).then(function (oQuickView) {                                                                                                                                                                                                                            
					oView.addDependent(oQuickView);                                                                                                                                                                                                                           
					return oQuickView;                                                                                                                                                                                                                                        
				});                                                                                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
			this._pQuickView.then(function (oQuickView) {                                                                                                                                                                                                               
				// oQuickView.setModel(oModel);                                                                                                                                                                                                                            
				oQuickView.openBy(oButton);                                                                                                                                                                                                                                
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/* =========================================================== */                                                                                                                                                                                            
		/* internal methods                                            */                                                                                                                                                                                            
		/* =========================================================== */                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
		_incompletionLogCall: function () {                                                                                                                                                                                                                          
			var oModel = new JSONModel();                                                                                                                                                                                                                               
			this.getView().setModel(oModel, "IncompLogSet");                                                                                                                                                                                                            
			var oFilter = this._addCreateFilters();                                                                                                                                                                                                                     
			var oDataModel = this.getOwnerComponent().getModel();                                                                                                                                                                                                       
			oDataModel.read("/IncompLogSet", {                                                                                                                                                                                                                          
				filters: oFilter,                                                                                                                                                                                                                                          
				success: function (data, sResponse) {                                                                                                                                                                                                                      
					oModel.setData(data.results);                                                                                                                                                                                                                             
				},                                                                                                                                                                                                                                                         
				error: function (eResponse) {                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Binds the view to the object path.                                                                                                                                                                                                                        
		 * @function                                                                                                                                                                                                                                                 
		 * @param {sap.ui.base.Event} oEvent pattern match event in route 'object'                                                                                                                                                                                   
		 * @private                                                                                                                                                                                                                                                  
		 */                                                                                                                                                                                                                                                          
		_onObjectMatched: function (oEvent) {                                                                                                                                                                                                                        
			this.Model = oEvent.getParameter("arguments").Model;                                                                                                                                                                                                        
			this.Waerk = oEvent.getParameter("arguments").Waerk;                                                                                                                                                                                                        
			var oFilter = this._addCreateFilters();                                                                                                                                                                                                                     
			this.getModel().metadataLoaded().then(function () {                                                                                                                                                                                                         
				this._bindView("/HeaderSet", oFilter);                                                                                                                                                                                                                     
			}.bind(this));                                                                                                                                                                                                                                              
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_addCreateFilters: function () {                                                                                                                                                                                                                             
			var oFilter = this._createFilters();                                                                                                                                                                                                                        
			var oFilter1 = new Filter("MODEL", FilterOperator.EQ, this.Model);                                                                                                                                                                                          
			var oFilter2 = new Filter("WAERK", FilterOperator.EQ, this.Waerk);                                                                                                                                                                                          
			oFilter.push(oFilter1);                                                                                                                                                                                                                                     
			oFilter.push(oFilter2);                                                                                                                                                                                                                                     
			return oFilter;                                                                                                                                                                                                                                             
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_createFilters: function () {                                                                                                                                                                                                                                
			var cFilterArray = [];                                                                                                                                                                                                                                      
			var oModelData = this.getView().getModel("globalFilters").getData();                                                                                                                                                                                        
			for (var i in oModelData) {                                                                                                                                                                                                                                 
				if (i !== "MODEL") {                                                                                                                                                                                                                                       
					if (oModelData[i].length > 1) {                                                                                                                                                                                                                           
						cFilterArray.push(new Filter(oModelData[i].map(function (arg) {                                                                                                                                                                                          
							return new Filter(i, FilterOperator.EQ, arg);                                                                                                                                                                                                           
						})));                                                                                                                                                                                                                                                    
					} else if (oModelData[i].length === 1) {                                                                                                                                                                                                                  
						cFilterArray.push(new Filter(i, FilterOperator.EQ, oModelData[i]));                                                                                                                                                                                      
					}                                                                                                                                                                                                                                                         
				}                                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
			return cFilterArray;                                                                                                                                                                                                                                        
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Binds the view to the object path.                                                                                                                                                                                                                        
		 * @function                                                                                                                                                                                                                                                 
		 * @param {string} sObjectPath path to the object to be bound                                                                                                                                                                                                
		 * @private                                                                                                                                                                                                                                                  
		 */                                                                                                                                                                                                                                                          
		_bindView: function (sObjectPath, filters) {                                                                                                                                                                                                                 
			var oViewModel = this.getModel("objectView"),                                                                                                                                                                                                               
				oDataModel = this.getModel();                                                                                                                                                                                                                              
			var oModel = new JSONModel();                                                                                                                                                                                                                               
			this.getView().setModel(oModel, "tableModel");                                                                                                                                                                                                              
			oDataModel.read("/HeaderSet", {                                                                                                                                                                                                                             
				filters: filters,                                                                                                                                                                                                                                          
				success: function (data, sucResponse) {                                                                                                                                                                                                                    
					this.getView().getModel("tableModel").setData(data.results);                                                                                                                                                                                              
					oViewModel.setProperty("/busy", false);                                                                                                                                                                                                                   
				}.bind(this),                                                                                                                                                                                                                                              
				error: function (errResponse) {                                                                                                                                                                                                                            
					oViewModel.setProperty("/busy", false);                                                                                                                                                                                                                   
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_onBindingChange: function () {                                                                                                                                                                                                                              
			var oView = this.getView(),                                                                                                                                                                                                                                 
				oViewModel = this.getModel("objectView"),                                                                                                                                                                                                                  
				oElementBinding = oView.getElementBinding();                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
			// No data for the binding                                                                                                                                                                                                                                  
			if (!oElementBinding.getBoundContext()) {                                                                                                                                                                                                                   
				this.getRouter().getTargets().display("objectNotFound");                                                                                                                                                                                                   
				return;                                                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			var oResourceBundle = this.getResourceBundle(),                                                                                                                                                                                                             
				oObject = oView.getBindingContext().getObject(),                                                                                                                                                                                                           
				sObjectId = oObject.Vbeln,                                                                                                                                                                                                                                 
				sObjectName = oObject.Agegrp;                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
			oViewModel.setProperty("/busy", false);                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
			oViewModel.setProperty("/shareSendEmailSubject",                                                                                                                                                                                                            
				oResourceBundle.getText("shareSendEmailObjectSubject", [sObjectId]));                                                                                                                                                                                      
			oViewModel.setProperty("/shareSendEmailMessage",                                                                                                                                                                                                            
				oResourceBundle.getText("shareSendEmailObjectMessage", [sObjectName, sObjectId, location.href]));                                                                                                                                                          
		}                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
	});                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
});                                                                                                                                                                                                                                                            
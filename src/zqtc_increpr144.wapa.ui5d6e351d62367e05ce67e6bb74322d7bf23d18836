sap.ui.define([                                                                                                                                                                                                                                                
	"./BaseController",                                                                                                                                                                                                                                           
	"sap/ui/model/json/JSONModel",                                                                                                                                                                                                                                
	"../model/formatter",                                                                                                                                                                                                                                         
	"sap/ui/model/Filter",                                                                                                                                                                                                                                        
	"sap/ui/model/FilterOperator",                                                                                                                                                                                                                                
	"sap/viz/ui5/controls/Popover",                                                                                                                                                                                                                               
	"sap/ui/core/format/NumberFormat",                                                                                                                                                                                                                            
	"sap/ui/core/Fragment",                                                                                                                                                                                                                                       
	"sap/m/Token",                                                                                                                                                                                                                                                
	"sap/m/MessageBox"                                                                                                                                                                                                                                            
], function (BaseController, JSONModel, formatter, Filter, FilterOperator, Popover, NumberFormat, Fragment, Token, MessageBox) {                                                                                                                               
	"use strict";                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
	return BaseController.extend("ir.ZE144_IncompletionReport.controller.Worklist", {                                                                                                                                                                             
                                                                                                                                                                                                                                                               
		formatter: formatter,                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
		/* =========================================================== */                                                                                                                                                                                            
		/* lifecycle methods                                           */                                                                                                                                                                                            
		/* =========================================================== */                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Called when the worklist controller is instantiated.                                                                                                                                                                                                      
		 * @public                                                                                                                                                                                                                                                   
		 */                                                                                                                                                                                                                                                          
		onInit: function () {                                                                                                                                                                                                                                        
			this.getView().setBusy(true);                                                                                                                                                                                                                               
			var oModel = new JSONModel();                                                                                                                                                                                                                               
			this.newFilters = [];                                                                                                                                                                                                                                       
			this.getView().setModel(oModel, "f4HelpsModel");                                                                                                                                                                                                            
			var oVizFrame = this.getView().byId("idVizFrame");                                                                                                                                                                                                          
			oVizFrame.setVizProperties({                                                                                                                                                                                                                                
				plotArea: {                                                                                                                                                                                                                                                
					dataLabel: {                                                                                                                                                                                                                                              
						visible: true,                                                                                                                                                                                                                                           
						showTotal: true                                                                                                                                                                                                                                          
					}                                                                                                                                                                                                                                                         
				},                                                                                                                                                                                                                                                         
				valueAxis: {                                                                                                                                                                                                                                               
					title: {                                                                                                                                                                                                                                                  
						text: "Number of Orders",                                                                                                                                                                                                                                
						visible: true                                                                                                                                                                                                                                            
					}                                                                                                                                                                                                                                                         
				},                                                                                                                                                                                                                                                         
				categoryAxis: {                                                                                                                                                                                                                                            
					title: {                                                                                                                                                                                                                                                  
						text: "Business Model",                                                                                                                                                                                                                                  
						visible: true                                                                                                                                                                                                                                            
					},                                                                                                                                                                                                                                                        
					label: {                                                                                                                                                                                                                                                  
						hideSubLevels: false,                                                                                                                                                                                                                                    
						style: {                                                                                                                                                                                                                                                 
							fontSize: "0.8rem",                                                                                                                                                                                                                                     
							fontWeight: "bold",                                                                                                                                                                                                                                     
						}                                                                                                                                                                                                                                                        
					}                                                                                                                                                                                                                                                         
				},                                                                                                                                                                                                                                                         
				legend: {                                                                                                                                                                                                                                                  
					title: {                                                                                                                                                                                                                                                  
						text: "Currency",                                                                                                                                                                                                                                        
						visible: true,                                                                                                                                                                                                                                           
						style: {                                                                                                                                                                                                                                                 
							color: "black"                                                                                                                                                                                                                                          
						}                                                                                                                                                                                                                                                        
					}                                                                                                                                                                                                                                                         
				},                                                                                                                                                                                                                                                         
				title: {                                                                                                                                                                                                                                                   
					visible: false,                                                                                                                                                                                                                                           
					text: "Bar"                                                                                                                                                                                                                                               
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
			// this._serviceCall();                                                                                                                                                                                                                                     
			this._callF4Helps();                                                                                                                                                                                                                                        
			var oPopOver = this.getView().byId("idPopOver");                                                                                                                                                                                                            
			oPopOver.setActionItems([{                                                                                                                                                                                                                                  
				type: "action",                                                                                                                                                                                                                                            
				text: "Show Table",                                                                                                                                                                                                                                        
				press: this.onPopoverPress.bind(this)                                                                                                                                                                                                                      
			}]);                                                                                                                                                                                                                                                        
			oPopOver.connect(oVizFrame.getVizUid());                                                                                                                                                                                                                    
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		// onChartRenderComp: function (oEvent) {                                                                                                                                                                                                                    
		// 	debugger;                                                                                                                                                                                                                                                
		// 	var a;                                                                                                                                                                                                                                                   
		// },                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
		onRefreshGraph: function () {                                                                                                                                                                                                                                
			this._callDashBoardSet();                                                                                                                                                                                                                                   
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//New Changes Suggested on 15-01-2022 Start                                                                                                                                                                                                                  
		onFilterDialogPress: function (oEvent) {                                                                                                                                                                                                                     
			var oButton = oEvent.getSource(),                                                                                                                                                                                                                           
				oView = this.getView();                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
			if (!this._oFilterDialog) {                                                                                                                                                                                                                                 
				this._oFilterDialog = Fragment.load({                                                                                                                                                                                                                      
					id: oView.getId(),                                                                                                                                                                                                                                        
					name: "ir.ZE144_IncompletionReport.Fragment.FilterDialog",                                                                                                                                                                                                
					controller: this                                                                                                                                                                                                                                          
				}).then(function (oDialog) {                                                                                                                                                                                                                               
					debugger;                                                                                                                                                                                                                                                 
					oView.addDependent(oDialog);                                                                                                                                                                                                                              
					var date = new Date();                                                                                                                                                                                                                                    
					date.setDate(date.getDate() - parseInt(this.getView().getModel("f4HelpsModel").getProperty("/ZCACONSTSet")[0].Low, 10));                                                                                                                                  
					var dateString = date.toISOString().split('T')[0];                                                                                                                                                                                                        
					this.getView().byId("iddRCreatedDate").setDateValue(new Date(dateString));                                                                                                                                                                                
					var date1 = new Date();                                                                                                                                                                                                                                   
					date.setDate(date1.getDate() - parseInt(this.getView().getModel("f4HelpsModel").getProperty("/ZCACONSTSet")[0].Low, 10));                                                                                                                                 
					var date1String = date1.toISOString().split('T')[0];                                                                                                                                                                                                      
					this.getView().byId("iddRCreatedDate").setSecondDateValue(new Date(date1String));                                                                                                                                                                         
					return oDialog;                                                                                                                                                                                                                                           
				}.bind(this));                                                                                                                                                                                                                                             
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			this._oFilterDialog.then(function (oDialog) {                                                                                                                                                                                                               
				oDialog.open();                                                                                                                                                                                                                                            
			}.bind(this));                                                                                                                                                                                                                                              
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onCreatedDateChange: function (oEvent) {                                                                                                                                                                                                                     
			var oFirstDate = this.getView().byId("iddRCreatedDate").getFrom(),                                                                                                                                                                                          
				oSecondDate = this.getView().byId("iddRCreatedDate").getTo();                                                                                                                                                                                              
			var timeDifferce = oSecondDate - oFirstDate;                                                                                                                                                                                                                
			var totalDays = Math.round(timeDifferce / (1000 * 3600 * 24));                                                                                                                                                                                              
			var oModelDays = this.getView().getModel("f4HelpsModel").getProperty("/ZCACONSTSet")[0].Low;                                                                                                                                                                
			if (totalDays > 30) {                                                                                                                                                                                                                                       
				MessageBox.error("Date Range should be within " + oModelDays + " days");                                                                                                                                                                                   
				this.getView().byId("iddRCreatedDate").setValueState("Error");                                                                                                                                                                                             
			} else {                                                                                                                                                                                                                                                    
				this.getView().byId("iddRCreatedDate").setValueState("None");                                                                                                                                                                                              
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onFilterDialogClose: function (oEvent) {                                                                                                                                                                                                                     
			var cDate = this.getView().byId("iddRCreatedDate");                                                                                                                                                                                                         
			var currentState = cDate.getValueState();                                                                                                                                                                                                                   
			if (currentState === "Error") {                                                                                                                                                                                                                             
				var oDateFormat = sap.ui.core.format.DateFormat.getDateInstance({                                                                                                                                                                                          
					pattern: "dd-MM-yyyy"                                                                                                                                                                                                                                     
				});                                                                                                                                                                                                                                                        
				var date = new Date();                                                                                                                                                                                                                                     
				date.setDate(date.getDate() - parseInt(this.getView().getModel("f4HelpsModel").getProperty("/ZCACONSTSet")[0].Low, 10));                                                                                                                                   
				var dateString = date.toISOString().split('T')[0];                                                                                                                                                                                                         
				this.getView().byId("iddRCreatedDate").setDateValue(new Date(dateString));                                                                                                                                                                                 
				var date1 = new Date();                                                                                                                                                                                                                                    
				date.setDate(date1.getDate() - parseInt(this.getView().getModel("f4HelpsModel").getProperty("/ZCACONSTSet")[0].Low, 10));                                                                                                                                  
				var date1String = date1.toISOString().split('T')[0];                                                                                                                                                                                                       
				this.getView().byId("iddRCreatedDate").setSecondDateValue(new Date(date1String));                                                                                                                                                                          
				cDate.setValueState("None");                                                                                                                                                                                                                               
			}                                                                                                                                                                                                                                                           
			this._oFilterDialog.then(function (oDialog) {                                                                                                                                                                                                               
				oDialog.close();                                                                                                                                                                                                                                           
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onFilterDialogGo: function (oEvent) {                                                                                                                                                                                                                        
			var isDateValid = this.onCreatedDateChange();                                                                                                                                                                                                               
			if (this.getView().byId("iddRCreatedDate").getValueState() !== "Error") {                                                                                                                                                                                   
				this.onFilterDialogClose();                                                                                                                                                                                                                                
				this._callDashBoardSet();                                                                                                                                                                                                                                  
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onFilterDialogClear: function (oEvent) {                                                                                                                                                                                                                     
			var oView = this.getView();                                                                                                                                                                                                                                 
			var controlIDs = ["idMISalesOrder", "iddRCreatedDate", "iddRBillingDate", "idMISalesOrg", "idMIOrderType",                                                                                                                                                  
				"idMIPoType", "idMIMatNum", "idCBPayStat", "idMIPayTerms", "idMISldToBPID", "idMIShpToBPID", "idMIFFBPID", "idMISocBPID",                                                                                                                                  
				"idMIMatGrp5", "idMIPrcGrp", "idMISalesDoc"                                                                                                                                                                                                                
			];                                                                                                                                                                                                                                                          
			for (var i = 0; i < controlIDs.length; i++) {                                                                                                                                                                                                               
				var ctrlInst = oView.byId(controlIDs[i]);                                                                                                                                                                                                                  
				var name = ctrlInst.getName();                                                                                                                                                                                                                             
				if (ctrlInst instanceof sap.m.MultiInput) {                                                                                                                                                                                                                
					ctrlInst.setTokens([]);                                                                                                                                                                                                                                   
				} else if (ctrlInst instanceof sap.m.ComboBox) {                                                                                                                                                                                                           
					ctrlInst.setSelectedKey("");                                                                                                                                                                                                                              
				} else if (ctrlInst instanceof sap.m.DateRangeSelection) {                                                                                                                                                                                                 
					if (controlIDs[i] === "iddRBillingDate") {                                                                                                                                                                                                                
						ctrlInst.setValue("");                                                                                                                                                                                                                                   
					}                                                                                                                                                                                                                                                         
				}                                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_callDashBoardSet: function () {                                                                                                                                                                                                                             
			debugger;                                                                                                                                                                                                                                                   
			this.getView().setBusy(true);                                                                                                                                                                                                                               
			var oView = this.getView();                                                                                                                                                                                                                                 
			var oJSModel = this.getView().getModel("f4HelpsModel");                                                                                                                                                                                                     
			var oModel = this.getView().getModel("globalFilters");                                                                                                                                                                                                      
			var oDataModel = this.getView().getModel();                                                                                                                                                                                                                 
			var controlIDs = ["idMISalesOrder", "iddRCreatedDate", "iddRBillingDate", "idMISalesOrg", "idMIOrderType",                                                                                                                                                  
				"idMIPoType", "idMIMatNum", "idCBPayStat", "idMIPayTerms", "idMISldToBPID", "idMIShpToBPID", "idMIFFBPID", "idMISocBPID",                                                                                                                                  
				"idMIMatGrp5", "idMIPrcGrp", "idMISalesDoc"                                                                                                                                                                                                                
			];                                                                                                                                                                                                                                                          
			try {                                                                                                                                                                                                                                                       
				for (var i = 0; i < controlIDs.length; i++) {                                                                                                                                                                                                              
					var ctrlInst = oView.byId(controlIDs[i]);                                                                                                                                                                                                                 
					var name = ctrlInst.getName();                                                                                                                                                                                                                            
					if (ctrlInst instanceof sap.m.MultiInput && ctrlInst.getTokens().length) {                                                                                                                                                                                
						var oValues = ctrlInst.getTokens().map(function (arg) {                                                                                                                                                                                                  
							return arg.getKey();                                                                                                                                                                                                                                    
						});                                                                                                                                                                                                                                                      
						oModel.setProperty("/" + name, oValues);                                                                                                                                                                                                                 
					} else if (ctrlInst instanceof sap.m.ComboBox && ctrlInst.getSelectedKey().length) {                                                                                                                                                                      
						var oKey = ctrlInst.getSelectedKey();                                                                                                                                                                                                                    
						oModel.setProperty("/" + name, [oKey]);                                                                                                                                                                                                                  
					} else if (ctrlInst instanceof sap.m.DateRangeSelection && ctrlInst.getValue().length) {                                                                                                                                                                  
						oModel.setProperty("/" + name, [ctrlInst.getValue()]);                                                                                                                                                                                                   
					} else {                                                                                                                                                                                                                                                  
						oModel.setProperty("/" + name, []);                                                                                                                                                                                                                      
					}                                                                                                                                                                                                                                                         
				}                                                                                                                                                                                                                                                          
			} catch (oError) {                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			}                                                                                                                                                                                                                                                           
			var oFilter = this._createFilters();                                                                                                                                                                                                                        
			if (oFilter.length > 0) {                                                                                                                                                                                                                                   
				this.getView().byId("idfilterIcon").setVisible(true);                                                                                                                                                                                                      
			} else {                                                                                                                                                                                                                                                    
				this.getView().byId("idfilterIcon").setVisible(false);                                                                                                                                                                                                     
			}                                                                                                                                                                                                                                                           
			oDataModel.read("/DashboardSet", {                                                                                                                                                                                                                          
				filters: oFilter,                                                                                                                                                                                                                                          
				success: function (data, sResponse) {                                                                                                                                                                                                                      
					oJSModel.setProperty("/DashboardSet", data.results);                                                                                                                                                                                                      
					this.getView().setBusy(false);                                                                                                                                                                                                                            
				}.bind(this),                                                                                                                                                                                                                                              
				error: function (eResponse) {                                                                                                                                                                                                                              
					debugger;                                                                                                                                                                                                                                                 
					if (eResponse.statusCode === 504) {                                                                                                                                                                                                                       
						MessageBox.error("Please change selection criteria for filter DateRange");                                                                                                                                                                               
					}                                                                                                                                                                                                                                                         
					this.getView().setBusy(false);                                                                                                                                                                                                                            
				}.bind(this)                                                                                                                                                                                                                                               
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_createFilters: function () {                                                                                                                                                                                                                                
			var cFilterArray = [];                                                                                                                                                                                                                                      
			var oModelData = this.getView().getModel("globalFilters").getData();                                                                                                                                                                                        
			for (var i in oModelData) {                                                                                                                                                                                                                                 
				if (oModelData[i].length > 1) {                                                                                                                                                                                                                            
					cFilterArray.push(new Filter(oModelData[i].map(function (arg) {                                                                                                                                                                                           
						return new Filter(i, FilterOperator.EQ, arg);                                                                                                                                                                                                            
					})));                                                                                                                                                                                                                                                     
				} else if (oModelData[i].length === 1) {                                                                                                                                                                                                                   
					cFilterArray.push(new Filter(i, FilterOperator.EQ, oModelData[i]));                                                                                                                                                                                       
				}                                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
			return cFilterArray;                                                                                                                                                                                                                                        
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		clearAllFilters: function () {                                                                                                                                                                                                                               
			location.reload();                                                                                                                                                                                                                                          
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		//New Changes Suggested on 15-01-2022 End                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
		/* =========================================================== */                                                                                                                                                                                            
		/* event handlers                                              */                                                                                                                                                                                            
		/* =========================================================== */                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Event handler when a table item gets pressed                                                                                                                                                                                                              
		 * @param {sap.ui.base.Event} oEvent the table selectionChange event                                                                                                                                                                                         
		 * @public                                                                                                                                                                                                                                                   
		 */                                                                                                                                                                                                                                                          
		onPress: function (oEvent) {                                                                                                                                                                                                                                 
			// The source is the list item that got pressed                                                                                                                                                                                                             
			this._showObject(oEvent.getSource());                                                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Event handler for navigating back.                                                                                                                                                                                                                        
		 * We navigate back in the browser history                                                                                                                                                                                                                   
		 * @public                                                                                                                                                                                                                                                   
		 */                                                                                                                                                                                                                                                          
		onNavBack: function () {                                                                                                                                                                                                                                     
			// eslint-disable-next-line sap-no-history-manipulation                                                                                                                                                                                                     
			history.go(-1);                                                                                                                                                                                                                                             
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onReset: function () {                                                                                                                                                                                                                                       
			var oModel = this.getOwnerComponent().getModel();                                                                                                                                                                                                           
			var oVizFrame = this.getView().byId("idVizFrame");                                                                                                                                                                                                          
			var oJSModel = this.getView().getModel("f4HelpsModel")                                                                                                                                                                                                      
			var oPromise = new Promise(function (res, rej) {                                                                                                                                                                                                            
				oModel.read("/DashboardSet", {                                                                                                                                                                                                                             
					success: function (data, sResponse) {                                                                                                                                                                                                                     
						oJSModel.setProperty("/DashboardSet", data.results);                                                                                                                                                                                                     
						res();                                                                                                                                                                                                                                                   
					},                                                                                                                                                                                                                                                        
					error: function (eResponse) {                                                                                                                                                                                                                             
						rej();                                                                                                                                                                                                                                                   
					}                                                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
			});                                                                                                                                                                                                                                                         
			oPromise.then(function (val) {                                                                                                                                                                                                                              
				oVizFrame.getDataset().getBinding("data").filter([]);                                                                                                                                                                                                      
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/* =========================================================== */                                                                                                                                                                                            
		/* internal methods                                            */                                                                                                                                                                                            
		/* =========================================================== */                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Shows the selected item on the object page                                                                                                                                                                                                                
		 * On phones a additional history entry is created                                                                                                                                                                                                           
		 * @param {sap.m.ObjectListItem} oItem selected Item                                                                                                                                                                                                         
		 * @private                                                                                                                                                                                                                                                  
		 */                                                                                                                                                                                                                                                          
		_showObject: function (oItem) {                                                                                                                                                                                                                              
			this.getRouter().navTo("object", {                                                                                                                                                                                                                          
				Model: this.MODEL,                                                                                                                                                                                                                                         
				Waerk: this.WAERK,                                                                                                                                                                                                                                         
			});                                                                                                                                                                                                                                                         
			var oVizFrame = this.getView().byId("idVizFrame");                                                                                                                                                                                                          
			oVizFrame.vizSelection([], {                                                                                                                                                                                                                                
				"clearSelection": true                                                                                                                                                                                                                                     
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_callF4Helps: function () {                                                                                                                                                                                                                                  
			var that = this;                                                                                                                                                                                                                                            
			var oModel = this.getOwnerComponent().getModel();                                                                                                                                                                                                           
			var oViewModel = this.getModel("worklistView");                                                                                                                                                                                                             
			// var entitySets = ["SMODELSet", "SalesOrgSet", "OrderTypeSet", "POTypeSet", "MaterialSet",                                                                                                                                                                
			// 	"PaymentTermSet", "SoldtoSet", "ShiptoSet", "FreightForwarderSet", "SocietyPartnerSet",                                                                                                                                                                 
			// 	"MaterialGroup5Set", "PriceGroupSet", "IOrderSet", "DashboardSet", "ZCACONSTSet"                                                                                                                                                                        
			// ];                                                                                                                                                                                                                                                       
			var entitySets = ["DashboardSet", "ZCACONSTSet"];                                                                                                                                                                                                           
			for (var i = 0; i < entitySets.length; i++) {                                                                                                                                                                                                               
				var currentSet = entitySets[i];                                                                                                                                                                                                                            
				oModel.read("/" + currentSet, {                                                                                                                                                                                                                            
					success: that._callF4HelpsSuccess.bind(that, currentSet),                                                                                                                                                                                                 
					error: that._callF4HelpsError                                                                                                                                                                                                                             
				});                                                                                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
		_callF4HelpsSuccess: function (currentSet, data, res) {                                                                                                                                                                                                      
			var oModel = this.getView().getModel("f4HelpsModel");                                                                                                                                                                                                       
			oModel.setData({                                                                                                                                                                                                                                            
				[currentSet]: data.results                                                                                                                                                                                                                                 
			}, true);                                                                                                                                                                                                                                                   
			this.getView().setBusy(false);                                                                                                                                                                                                                              
			if (currentSet === "ZCACONSTSet") {                                                                                                                                                                                                                         
				debugger;                                                                                                                                                                                                                                                  
				var oDateFormat = sap.ui.core.format.DateFormat.getDateInstance({                                                                                                                                                                                          
					pattern: "dd-MM-yyyy"                                                                                                                                                                                                                                     
				});                                                                                                                                                                                                                                                        
				var date = new Date();                                                                                                                                                                                                                                     
				debugger;                                                                                                                                                                                                                                                  
				date.setDate(date.getDate() - parseInt(data.results[0].Low,10));                                                                                                                                                                                           
				var oDate1 = oDateFormat.format(date);                                                                                                                                                                                                                     
				var oDate2 = oDateFormat.format(new Date());                                                                                                                                                                                                               
				var cFormatDate = oDate1 + " , " + oDate2;                                                                                                                                                                                                                 
				this.getView().getModel("globalFilters").setProperty("/ERDAT", [cFormatDate]);                                                                                                                                                                             
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_callF4HelpsError: function (error) {                                                                                                                                                                                                                        
			var a;                                                                                                                                                                                                                                                      
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onPopoverPress: function (oEvent) {                                                                                                                                                                                                                          
			this._showObject(oEvent.getSource());                                                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onSelectData: function (oEvent) {                                                                                                                                                                                                                            
			var oMeasureName = oEvent.getParameter("data")[0].data.measureNames;                                                                                                                                                                                        
			var vizCtx = this.getView().byId("idVizDataSet").getBinding("data").getContexts();                                                                                                                                                                          
			var rowCtx = oEvent.getParameter("data")[0].data._context_row_number;                                                                                                                                                                                       
			var dataObj = vizCtx[rowCtx].getObject();                                                                                                                                                                                                                   
			this.MODEL = dataObj.MODEL;                                                                                                                                                                                                                                 
			this.WAERK = dataObj.WAERK;                                                                                                                                                                                                                                 
			this._DisplayRevenue(oMeasureName, dataObj);                                                                                                                                                                                                                
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_DisplayRevenue: function (value, obj) {                                                                                                                                                                                                                     
			var oVizFrame = this.getView().byId("idVizFrame");                                                                                                                                                                                                          
			var popoverProps = {                                                                                                                                                                                                                                        
				"customDataControl": function (data) {                                                                                                                                                                                                                     
					var oCurrency = new Intl.NumberFormat("en-US", {                                                                                                                                                                                                          
						style: "currency",                                                                                                                                                                                                                                       
						currency: data.data.val[0].value                                                                                                                                                                                                                         
					});                                                                                                                                                                                                                                                       
					var oHBox1 = new sap.m.HBox({                                                                                                                                                                                                                             
						items: [                                                                                                                                                                                                                                                 
							new sap.m.Label({                                                                                                                                                                                                                                       
								text: "Business Model:",                                                                                                                                                                                                                               
								design: "Bold"                                                                                                                                                                                                                                         
							}).addStyleClass("sapUiTinyMarginEnd"),                                                                                                                                                                                                                 
							new sap.m.Text({                                                                                                                                                                                                                                        
								text: obj.MODEL                                                                                                                                                                                                                                        
							})                                                                                                                                                                                                                                                      
						]                                                                                                                                                                                                                                                        
					});                                                                                                                                                                                                                                                       
					var oHBox2 = new sap.m.HBox({                                                                                                                                                                                                                             
						items: [                                                                                                                                                                                                                                                 
							new sap.m.Label({                                                                                                                                                                                                                                       
								text: "Revenue:",                                                                                                                                                                                                                                      
								design: "Bold"                                                                                                                                                                                                                                         
							}).addStyleClass("sapUiTinyMarginEnd"),                                                                                                                                                                                                                 
							new sap.m.Text({                                                                                                                                                                                                                                        
								text: oCurrency.format(obj.NETWR)                                                                                                                                                                                                                      
							})                                                                                                                                                                                                                                                      
						]                                                                                                                                                                                                                                                        
					});                                                                                                                                                                                                                                                       
					var oHBox3 = new sap.m.HBox({                                                                                                                                                                                                                             
						items: [                                                                                                                                                                                                                                                 
							new sap.m.Label({                                                                                                                                                                                                                                       
								text: "Count:",                                                                                                                                                                                                                                        
								design: "Bold"                                                                                                                                                                                                                                         
							}).addStyleClass("sapUiTinyMarginEnd"),                                                                                                                                                                                                                 
							new sap.m.Text({                                                                                                                                                                                                                                        
								text: obj.COUNT                                                                                                                                                                                                                                        
							})                                                                                                                                                                                                                                                      
						]                                                                                                                                                                                                                                                        
					});                                                                                                                                                                                                                                                       
					return new sap.m.VBox({                                                                                                                                                                                                                                   
						items: [oHBox1, oHBox2, oHBox3]                                                                                                                                                                                                                          
					}).addStyleClass("sapUiTinyMargin");                                                                                                                                                                                                                      
				}                                                                                                                                                                                                                                                          
			};                                                                                                                                                                                                                                                          
			this.oPopOver = new Popover(popoverProps);                                                                                                                                                                                                                  
			this.oPopOver.setActionItems([{                                                                                                                                                                                                                             
				type: "action",                                                                                                                                                                                                                                            
				text: "Show Table",                                                                                                                                                                                                                                        
				press: this.onPopoverPress.bind(this)                                                                                                                                                                                                                      
			}]);                                                                                                                                                                                                                                                        
			this.oPopOver.connect(oVizFrame.getVizUid());                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
		///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////                                                                                                                      
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////                                                                                                                       
		///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////                                                                                                                      
		///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////                                                                                                                      
		//All F4 Helps Code Starts Here                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
		handleSalesModel: function (oEvent, f4Name, key, text) {                                                                                                                                                                                                     
			debugger;                                                                                                                                                                                                                                                   
			var that = this;                                                                                                                                                                                                                                            
			var sInputValue = oEvent.getSource().getValue(),                                                                                                                                                                                                            
				oView = this.getView();                                                                                                                                                                                                                                    
			this.currentObject = oEvent.getSource();                                                                                                                                                                                                                    
			var oTemplate = new sap.m.StandardListItem({                                                                                                                                                                                                                
				title: "{f4HelpsModel>" + key + "}",                                                                                                                                                                                                                       
				description: "{f4HelpsModel>" + text + "}"                                                                                                                                                                                                                 
			});                                                                                                                                                                                                                                                         
			if (!this[f4Name]) {                                                                                                                                                                                                                                        
				this[f4Name] = Fragment.load({                                                                                                                                                                                                                             
					id: oView.getId() + f4Name,                                                                                                                                                                                                                               
					name: "ir.ZE144_IncompletionReport.Fragment.SalesModel",                                                                                                                                                                                                  
					controller: this                                                                                                                                                                                                                                          
				}).then(function (oValueHelpDialog) {                                                                                                                                                                                                                      
					oView.addDependent(oValueHelpDialog);                                                                                                                                                                                                                     
					that.f4ModelChangeServicesCall(f4Name, oValueHelpDialog);                                                                                                                                                                                                 
					return oValueHelpDialog;                                                                                                                                                                                                                                  
				});                                                                                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
			this[f4Name].then(function (oValueHelpDialog) {                                                                                                                                                                                                             
				oValueHelpDialog.bindAggregation("items", {                                                                                                                                                                                                                
					path: "/" + f4Name,                                                                                                                                                                                                                                       
					model: "f4HelpsModel",                                                                                                                                                                                                                                    
					template: oTemplate,                                                                                                                                                                                                                                      
					templateShareable: true                                                                                                                                                                                                                                   
				});                                                                                                                                                                                                                                                        
				oValueHelpDialog.open();                                                                                                                                                                                                                                   
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		f4ModelChangeServicesCall: function (f4Name, Dialog) {                                                                                                                                                                                                       
			Dialog.setBusy(true);                                                                                                                                                                                                                                       
			var oModel = this.getView().getModel("f4HelpsModel");                                                                                                                                                                                                       
			this.getView().getModel().read("/" + f4Name, {                                                                                                                                                                                                              
				success: function (data, res) {                                                                                                                                                                                                                            
					oModel.setData({                                                                                                                                                                                                                                          
						[f4Name]: data.results                                                                                                                                                                                                                                   
					}, true);                                                                                                                                                                                                                                                 
					Dialog.setBusy(false);                                                                                                                                                                                                                                    
				}.bind(this),                                                                                                                                                                                                                                              
				error: function (error) {                                                                                                                                                                                                                                  
					Dialog.setBusy(false);                                                                                                                                                                                                                                    
				}.bind(this)                                                                                                                                                                                                                                               
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_handleValueHelpSearch: function (evt) {                                                                                                                                                                                                                     
			debugger;                                                                                                                                                                                                                                                   
			var sPath = evt.getParameter("itemsBinding").getPath();                                                                                                                                                                                                     
			var oModel = evt.getParameter("itemsBinding").getModel();                                                                                                                                                                                                   
			var obj = oModel.getProperty(sPath)[0];                                                                                                                                                                                                                     
			var keys = Object.keys(obj);                                                                                                                                                                                                                                
			var newKeys = keys.filter(function (k) {                                                                                                                                                                                                                    
				return k !== '__metadata';                                                                                                                                                                                                                                 
			});                                                                                                                                                                                                                                                         
			var sValue = evt.getParameter("value");                                                                                                                                                                                                                     
			var qFilter = newKeys.map(function (m) {                                                                                                                                                                                                                    
				return new Filter(m, FilterOperator.Contains, sValue)                                                                                                                                                                                                      
			});                                                                                                                                                                                                                                                         
			var passFilter = new Filter(qFilter);                                                                                                                                                                                                                       
			evt.getSource().getBinding("items").filter(passFilter);                                                                                                                                                                                                     
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_handleValueHelpClose: function (evt) {                                                                                                                                                                                                                      
			debugger;                                                                                                                                                                                                                                                   
			var aSelectedItems = evt.getParameter("selectedItems"),                                                                                                                                                                                                     
				oMultiInput = this.currentObject;                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			if (aSelectedItems && aSelectedItems.length > 0) {                                                                                                                                                                                                          
				aSelectedItems.forEach(function (oItem) {                                                                                                                                                                                                                  
					oMultiInput.addToken(new Token({                                                                                                                                                                                                                          
						text: oItem.getDescription(),                                                                                                                                                                                                                            
						key: oItem.getTitle()                                                                                                                                                                                                                                    
					}));                                                                                                                                                                                                                                                      
				});                                                                                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
		}                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
	});                                                                                                                                                                                                                                                           
});                                                                                                                                                                                                                                                            
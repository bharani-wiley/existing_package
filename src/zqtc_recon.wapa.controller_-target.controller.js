sap.ui.define([                                                                                                                                                                                                                                                
	"sap/ui/core/mvc/Controller",                                                                                                                                                                                                                                 
	"sap/ui/model/Filter",                                                                                                                                                                                                                                        
	"sap/ui/model/FilterOperator",                                                                                                                                                                                                                                
	"sap/ui/model/json/JSONModel",                                                                                                                                                                                                                                
	"sap/ui/export/library",                                                                                                                                                                                                                                      
	"sap/ui/export/Spreadsheet",                                                                                                                                                                                                                                  
	"sap/ui/core/Fragment",                                                                                                                                                                                                                                       
	"sap/ui/Device",                                                                                                                                                                                                                                              
	"sap/ui/model/Sorter",                                                                                                                                                                                                                                        
	"sap/ui/model/type/String"                                                                                                                                                                                                                                    
], function (Controller, Filter, FilterOperator, JSONModel, exportLibrary, Spreadsheet, Fragment, Device, Sorter, typeString) {                                                                                                                                
	"use strict";                                                                                                                                                                                                                                                 
	var EdmType = exportLibrary.EdmType;                                                                                                                                                                                                                          
	return Controller.extend("recon.ZRECON_DASHBOARD.controller.target", {                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Called when a controller is instantiated and its View controls (if available) are already created.                                                                                                                                                        
		 * Can be used to modify the View before it is displayed, to bind event handlers and do other one-time initialization.                                                                                                                                       
		 * @memberOf recon.ZRECON_DASHBOARD.view.target                                                                                                                                                                                                              
		 */                                                                                                                                                                                                                                                          
		onInit: function () {                                                                                                                                                                                                                                        
			var oRouter = this.getOwnerComponent().getRouter();                                                                                                                                                                                                         
			oRouter.getRoute("target").attachMatched(this._onRouteMatched, this);                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
			this._mViewSettingsDialogs = {};                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
			this._oMultiInput = new sap.m.MultiInput();                                                                                                                                                                                                                 
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Similar to onAfterRendering, but this hook is invoked before the controller's View is re-rendered                                                                                                                                                         
		 * (NOT before the first rendering! onInit() is used for that one!).                                                                                                                                                                                         
		 * @memberOf recon.ZRECON_DASHBOARD.view.target                                                                                                                                                                                                              
		 */                                                                                                                                                                                                                                                          
		//	onBeforeRendering: function() {                                                                                                                                                                                                                           
		//                                                                                                                                                                                                                                                           
		//	},                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Called when the View has been rendered (so its HTML is part of the document). Post-rendering manipulations of the HTML could be done here.                                                                                                                
		 * This hook is the same one that SAPUI5 controls get after being rendered.                                                                                                                                                                                  
		 * @memberOf recon.ZRECON_DASHBOARD.view.target                                                                                                                                                                                                              
		 */                                                                                                                                                                                                                                                          
		//	onAfterRendering: function() {                                                                                                                                                                                                                            
		//                                                                                                                                                                                                                                                           
		//	},                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Called when the Controller is destroyed. Use this one to free resources and finalize activities.                                                                                                                                                          
		 * @memberOf recon.ZRECON_DASHBOARD.view.target                                                                                                                                                                                                              
		 */                                                                                                                                                                                                                                                          
		//	onExit: function() {                                                                                                                                                                                                                                      
		//                                                                                                                                                                                                                                                           
		//	}                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
		onPageBack: function () {                                                                                                                                                                                                                                    
			this.getOwnerComponent().getRouter().navTo("TargetAnalytical", true);                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_onRouteMatched: function (oEvent) {                                                                                                                                                                                                                         
			var oWricef = decodeURIComponent(oEvent.getParameter("arguments").wricef);                                                                                                                                                                                  
			var oView = this.getView();                                                                                                                                                                                                                                 
			oView.setModel(this.getView().getModel("idocStat"));                                                                                                                                                                                                        
			oView.bindElement({                                                                                                                                                                                                                                         
				path: oWricef                                                                                                                                                                                                                                              
			});                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
			oView.byId("IDatefrom2").setDateValue(new Date(sap.ui.getCore().fromDate));                                                                                                                                                                                 
			oView.byId("IDateto2").setDateValue(new Date(sap.ui.getCore().toDate));                                                                                                                                                                                     
			this.getTabdetails();                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onTabSearch: function (oEvent) {                                                                                                                                                                                                                             
			var aTableSearchState = [];                                                                                                                                                                                                                                 
			var sQuery = oEvent.getParameter("query");                                                                                                                                                                                                                  
			//           if (oEvent.getParameters().refreshButtonPressed) {                                                                                                                                                                                             
			//             this.getView().byId("targetTab").getBinding("items").refresh();                                                                                                                                                                              
                                                                                                                                                                                                                                                               
			//           }                                                                                                                                                                                                                                              
			// else if(sQuery && sQuery.length > 0) {                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
			aTableSearchState = [new Filter({                                                                                                                                                                                                                           
				filters: [                                                                                                                                                                                                                                                 
					new Filter("Docnum", FilterOperator.Contains, sQuery),                                                                                                                                                                                                    
					new Filter("Credat", FilterOperator.Contains, sQuery),                                                                                                                                                                                                    
					new Filter("Logdat", FilterOperator.Contains, sQuery),                                                                                                                                                                                                    
					new Filter("Message", FilterOperator.Contains, sQuery)                                                                                                                                                                                                    
					// new Filter("target", FilterOperator.Contains, sQuery),                                                                                                                                                                                                 
					// new Filter("description", FilterOperator.Contains, sQuery)                                                                                                                                                                                             
				]                                                                                                                                                                                                                                                          
			})];                                                                                                                                                                                                                                                        
			var oTable = this.getView().byId("targetTab");                                                                                                                                                                                                              
			oTable.getBinding("items").filter(aTableSearchState, "Application");                                                                                                                                                                                        
			// }                                                                                                                                                                                                                                                        
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		getTabdetails: function () {                                                                                                                                                                                                                                 
			// var dateText = sap.ui.getCore().fromDate + " " + "To" + " " + sap.ui.getCore().toDate;                                                                                                                                                                   
			// this.getView().byId("headerDate").setText(dateText);                                                                                                                                                                                                     
			var DateFrom = this.getView().byId("IDatefrom2").getValue();                                                                                                                                                                                                
			if (!DateFrom) {                                                                                                                                                                                                                                            
				DateFrom = null;                                                                                                                                                                                                                                           
			} else {                                                                                                                                                                                                                                                    
				sap.ui.getCore().fromDate2 = DateFrom;                                                                                                                                                                                                                     
			}                                                                                                                                                                                                                                                           
			var DateTo = this.getView().byId("IDateto2").getValue();                                                                                                                                                                                                    
			if (!DateTo) {                                                                                                                                                                                                                                              
				DateTo = null;                                                                                                                                                                                                                                             
			} else {                                                                                                                                                                                                                                                    
				sap.ui.getCore().toDate2 = DateTo;                                                                                                                                                                                                                         
			}                                                                                                                                                                                                                                                           
			var oDevid = this.getView().byId("objHead").getNumberUnit();                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
			var oFilter1 = new Filter("Devid", FilterOperator.EQ, oDevid),                                                                                                                                                                                              
				oFilter2 = new Filter("Stdate", FilterOperator.EQ, sap.ui.getCore().fromDate2),                                                                                                                                                                            
				oFilter3 = new Filter("Endate", FilterOperator.EQ, sap.ui.getCore().toDate2),                                                                                                                                                                              
                                                                                                                                                                                                                                                               
				oFilter = new Filter({                                                                                                                                                                                                                                     
					filters: [oFilter1, oFilter2, oFilter3],                                                                                                                                                                                                                  
					and: true                                                                                                                                                                                                                                                 
				});                                                                                                                                                                                                                                                        
			// this.getView().byId("targetTab").getBinding("items").filter(oFilter);                                                                                                                                                                                    
			var that = this;                                                                                                                                                                                                                                            
			that.getView().setBusy(true);                                                                                                                                                                                                                               
			this.getOwnerComponent().getModel().read("/IdocDetailsSet", {                                                                                                                                                                                               
				filters: [oFilter],                                                                                                                                                                                                                                        
				success: function (oData, response) {                                                                                                                                                                                                                      
					var oJSONModel = new JSONModel();                                                                                                                                                                                                                         
					oJSONModel.setData(oData);                                                                                                                                                                                                                                
					sap.ui.getCore().setModel(oJSONModel);                                                                                                                                                                                                                    
					that.getView().setModel(oJSONModel, "idoc");                                                                                                                                                                                                              
					that.getView().setBusy(false);                                                                                                                                                                                                                            
					sap.ui.getCore().refresh = "X";                                                                                                                                                                                                                           
				},                                                                                                                                                                                                                                                         
				error: function (oError) {                                                                                                                                                                                                                                 
					that.getView().setBusy(false);                                                                                                                                                                                                                            
					sap.m.MessageToast.show("No Date For Given Selection");                                                                                                                                                                                                   
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		refreshTarget: function () {                                                                                                                                                                                                                                 
			this.getTabdetails();                                                                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		createColumnConfig: function () {                                                                                                                                                                                                                            
			return [{                                                                                                                                                                                                                                                   
				label: "IDOC",                                                                                                                                                                                                                                             
				property: "Docnum",                                                                                                                                                                                                                                        
				type: EdmType.Number,                                                                                                                                                                                                                                      
				scale: 0                                                                                                                                                                                                                                                   
			}, {                                                                                                                                                                                                                                                        
				label: "Created Date",                                                                                                                                                                                                                                     
				property: "Credat",                                                                                                                                                                                                                                        
				type: EdmType.String,                                                                                                                                                                                                                                      
				width: "10"                                                                                                                                                                                                                                                
			}, {                                                                                                                                                                                                                                                        
				label: "Log Date",                                                                                                                                                                                                                                         
				property: "Logdat",                                                                                                                                                                                                                                        
				type: EdmType.String,                                                                                                                                                                                                                                      
				width: "10"                                                                                                                                                                                                                                                
			}, {                                                                                                                                                                                                                                                        
				label: "Error Message",                                                                                                                                                                                                                                    
				property: "Message",                                                                                                                                                                                                                                       
				type: EdmType.String,                                                                                                                                                                                                                                      
				width: "100"                                                                                                                                                                                                                                               
			}];                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		downloadIdocs: function () {                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
			var aCols, aRpt, oSettings, oSheet;                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
			aCols = this.createColumnConfig();                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			aRpt = this.getView().getModel("idoc").getProperty("/results");                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
			oSettings = {                                                                                                                                                                                                                                               
				workbook: {                                                                                                                                                                                                                                                
					columns: aCols                                                                                                                                                                                                                                            
				},                                                                                                                                                                                                                                                         
				dataSource: aRpt                                                                                                                                                                                                                                           
			};                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			oSheet = new Spreadsheet(oSettings);                                                                                                                                                                                                                        
			oSheet.build()                                                                                                                                                                                                                                              
				.then(function () {                                                                                                                                                                                                                                        
					sap.m.MessageToast.show("Excel download has finished");                                                                                                                                                                                                   
				})                                                                                                                                                                                                                                                         
				.finally(oSheet.destroy);                                                                                                                                                                                                                                  
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		// SORT                                                                                                                                                                                                                                                      
		handleSortButtonPressed: function () {                                                                                                                                                                                                                       
			this.getViewSettingsDialog("recon.ZRECON_DASHBOARD.fragments.SortDialog")                                                                                                                                                                                   
				.then(function (oViewSettingsDialog) {                                                                                                                                                                                                                     
					oViewSettingsDialog.open();                                                                                                                                                                                                                               
				});                                                                                                                                                                                                                                                        
		},                                                                                                                                                                                                                                                           
		getViewSettingsDialog: function (sDialogFragmentName) {                                                                                                                                                                                                      
			var pDialog = this._mViewSettingsDialogs[sDialogFragmentName];                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
			if (!pDialog) {                                                                                                                                                                                                                                             
				pDialog = Fragment.load({                                                                                                                                                                                                                                  
					id: this.getView().getId(),                                                                                                                                                                                                                               
					name: sDialogFragmentName,                                                                                                                                                                                                                                
					controller: this                                                                                                                                                                                                                                          
				}).then(function (oDialog) {                                                                                                                                                                                                                               
					if (Device.system.desktop) {                                                                                                                                                                                                                              
						oDialog.addStyleClass("sapUiSizeCompact");                                                                                                                                                                                                               
					}                                                                                                                                                                                                                                                         
					return oDialog;                                                                                                                                                                                                                                           
				});                                                                                                                                                                                                                                                        
				this._mViewSettingsDialogs[sDialogFragmentName] = pDialog;                                                                                                                                                                                                 
			}                                                                                                                                                                                                                                                           
			return pDialog;                                                                                                                                                                                                                                             
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		handleSortDialogConfirm: function (oEvent) {                                                                                                                                                                                                                 
			var oTable = this.byId("targetTab"),                                                                                                                                                                                                                        
				mParams = oEvent.getParameters(),                                                                                                                                                                                                                          
				oBinding = oTable.getBinding("items"),                                                                                                                                                                                                                     
				sPath,                                                                                                                                                                                                                                                     
				bDescending,                                                                                                                                                                                                                                               
				aSorters = [];                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
			sPath = mParams.sortItem.getKey();                                                                                                                                                                                                                          
			bDescending = mParams.sortDescending;                                                                                                                                                                                                                       
			aSorters.push(new Sorter(sPath, bDescending));                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
			// apply the selected sort settings                                                                                                                                                                                                                         
			oBinding.sort(aSorters);                                                                                                                                                                                                                                    
			this.getView().byId("sort").setType("Attention");                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
		// resetSort : function(){                                                                                                                                                                                                                                   
		// 	this.getView().byId("sort").setType("Emphasized");                                                                                                                                                                                                       
		// },                                                                                                                                                                                                                                                        
		/// Filter	                                                                                                                                                                                                                                                  
		handleFilterButtonPressed: function (oEvent) {                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
			Fragment.load({                                                                                                                                                                                                                                             
				name: "recon.ZRECON_DASHBOARD.fragments.FilterDialog",                                                                                                                                                                                                     
				controller: this                                                                                                                                                                                                                                           
			}).then(function name(oFragment) {                                                                                                                                                                                                                          
				this._oValueHelpDialog = oFragment;                                                                                                                                                                                                                        
				this.getView().addDependent(this._oValueHelpDialog);                                                                                                                                                                                                       
				this._oValueHelpDialog.setRangeKeyFields([{                                                                                                                                                                                                                
					label: "Doc.Number",                                                                                                                                                                                                                                      
					key: "Docnum",                                                                                                                                                                                                                                            
					type: "string",                                                                                                                                                                                                                                           
					typeInstance: new typeString({}, {                                                                                                                                                                                                                        
						maxLength: 16                                                                                                                                                                                                                                            
					})                                                                                                                                                                                                                                                        
				}]);                                                                                                                                                                                                                                                       
				//set tokens back to previous state _oMultiInput is a global object                                                                                                                                                                                        
				this._oValueHelpDialog.setTokens(this._oMultiInput.getTokens());                                                                                                                                                                                           
				this._oValueHelpDialog.open();                                                                                                                                                                                                                             
			}.bind(this));                                                                                                                                                                                                                                              
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onValueHelpOkPress: function (oEvent) {                                                                                                                                                                                                                      
			var aTokens = oEvent.getParameter("tokens");                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
			this._oMultiInput.setTokens(aTokens);                                                                                                                                                                                                                       
			this._oValueHelpDialog.close();                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
			var selectedItemsArray = [],                                                                                                                                                                                                                                
				i;                                                                                                                                                                                                                                                         
			for (i = 0; i < aTokens.length; i++) {                                                                                                                                                                                                                      
				var operation = aTokens[i].getCustomData()[0].getProperty("value").operation;                                                                                                                                                                              
				var low = aTokens[i].getCustomData()[0].getProperty("value").value1;                                                                                                                                                                                       
				var high = aTokens[i].getCustomData()[0].getProperty("value").value2;                                                                                                                                                                                      
				//	selectedItem = selectedItem.substring(1);                                                                                                                                                                                                               
				//	selectedItemsText.push(selectedItem);                                                                                                                                                                                                                   
				selectedItemsArray.push(new Filter("Docnum", operation, low, high));                                                                                                                                                                                       
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			if (selectedItemsArray.length > 0) {                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
				var oFilter = new Filter({                                                                                                                                                                                                                                 
					filters: selectedItemsArray                                                                                                                                                                                                                               
				});                                                                                                                                                                                                                                                        
				this.getView().byId("targetTab").getBinding("items").filter([oFilter]);                                                                                                                                                                                    
				this.getView().byId("filter").setType("Attention");                                                                                                                                                                                                        
			} else {                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
				this.getTabdetails();                                                                                                                                                                                                                                      
				this.getView().byId("filter").setType("Emphasized");                                                                                                                                                                                                       
			}                                                                                                                                                                                                                                                           
			//this.selectedItemsDev = selectedItemsText;                                                                                                                                                                                                                
			//	this.getView().byId("idVizFrame").getDataset().getBinding("data").filter([oFilter]);                                                                                                                                                                     
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onValueHelpCancelPress: function () {                                                                                                                                                                                                                        
			this._oValueHelpDialog.close();                                                                                                                                                                                                                             
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onValueHelpAfterClose: function () {                                                                                                                                                                                                                         
			this._oValueHelpDialog.destroy();                                                                                                                                                                                                                           
		}                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
	});                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
});                                                                                                                                                                                                                                                            